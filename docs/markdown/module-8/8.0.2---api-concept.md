# 8.0.2 - API Concept

  https://gemini.google.com/u/1/app/5b5f3092ace62463 1. Key Conceptual API 
Endpoints Endpoint: List Published Articles Purpose : Retrieve a paginated and 
filterable list of published articles for public consumption. Path Pattern : 
GET /v1/articles Query Params / Filters / Options : lang (optional, string, 
e.g., it ): ISO language code for translatable fields; defaults to the primary 
reference language (English). tags (optional, string, comma-separated, e.g., 
history,nature ): Filter articles containing any of the specified tags. 
region_id (optional, BIGINT ): Filter articles associated with a specific 
regions.id . trail_id (optional, BIGINT ): Filter articles associated with a 
specific trails.id . town_id (optional, BIGINT ): Filter articles associated 
with a specific towns.id . sort_by (optional, string, default publication_date 
): Field to sort by (e.g., publication_date , title ). order (optional, string, 
default desc ): Sort order ( asc or desc ). page (optional, integer, default 1 
): For pagination. per_page (optional, integer, default 10 ): Items per page. 
Endpoint: Get Single Published Article by Slug Purpose : Retrieve the full 
details of a single published article, including its content, author 
information, featured image, and associated media gallery. Path Pattern : GET 
/v1/articles/{slug} Query Params / Filters / Options : lang (optional, string, 
e.g., it ): ISO language code for translatable fields; defaults to primary 
reference language (English). Endpoint: List Media Roles Purpose : Fetch a list 
of all active media roles defined in the system, primarily for use in content 
management interfaces. Path Pattern : GET /v1/media-roles Query Params / 
Filters / Options : lang (optional, string, e.g., it ): ISO language code for 
translatable fields ( default_display_name , default_description ); defaults to 
primary reference language (English). 2. Example JSON Responses GET 
/v1/articles?tags=history&lang=it&per_page=1 JSON { "pagination" : { 
"current_page" : 1 , "per_page" : 1 , "total_items" : 25 , // Example total 
"total_pages" : 25 }, "data" : [ { "id" : 101 , "slug" : 
"storia-antica-del-cammino" , "title" : "Storia Antica del Cammino" , // 
Italian, as lang=it "excerpt" : "Un breve riassunto della storia antica..." , 
// Italian "publication_date" : "2025-04-10T10:00:00Z" , "author" : { "id" : 
"uuid-author-1" , "public_display_name" : "Andrea Rossi" , "avatar_url" : 
"https://storage.example.com/avatars/uuid-author-1/thumb.webp" // Constructed 
URL }, "featured_image" : { "media_id" : "uuid-media-featured-1" , "alt_text" : 
"Mappa storica antica" , // Italian alt text for featured image "variants" : { 
// From media.image_variants_json "thumbnail" : 
"/media/uuid-media-featured-1/thumb.webp" , "large" : 
"/media/uuid-media-featured-1/large.jpg" } }, "tags" : [ "history" , "culture" 
], "translations" : [ // Other available translations for core fields { "lang" 
: "en" , "title" : "Ancient History of the Path" , "excerpt" : "A brief summary 
of ancient history..." } ], "_links" : { "self" : { "href" : 
"/v1/articles/storia-antica-del-cammino" } } } ] } GET 
/v1/articles/storia-antica-del-cammino?lang=it JSON { "id" : 101 , "slug" : 
"storia-antica-del-cammino" , "title" : "Storia Antica del Cammino" , // 
Italian "body_content" : "<p>Contenuto completo dell'articolo in 
italiano...</p>" , // Italian "excerpt" : "Un breve riassunto della storia 
antica..." , // Italian "publication_date" : "2025-04-10T10:00:00Z" , "author" 
: { "id" : "uuid-author-1" , "public_display_name" : "Andrea Rossi" , 
"avatar_url" : "https://storage.example.com/avatars/uuid-author-1/thumb.webp" 
}, "featured_image" : { "media_id" : "uuid-media-featured-1" , "alt_text" : 
"Mappa storica antica" , // Italian "variants" : { "thumbnail" : 
"/media/uuid-media-featured-1/thumb.webp" , "large" : 
"/media/uuid-media-featured-1/large.jpg" } }, "tags" : [ "history" , "culture" 
], "associated_entities" : { "trail_id" : 5 , "region_id" : 2 }, "gallery" : [ 
// From article_media_details_view { "media_id" : "uuid-media-gallery-1" , 
"role_code" : "gallery_image" , "role_name" : "Immagine Galleria" , // Italian 
"display_order" : 1 , "caption" : "Vista del sentiero antico." , // Italian 
(from override or media default) "alt_text" : "Sentiero antico al tramonto." , 
// Italian (from override or media default) "variants" : { "thumbnail" : 
"/media/uuid-media-gallery-1/thumb.webp" , "large" : 
"/media/uuid-media-gallery-1/large.jpg" }, "translations_caption" : [ // 
Example if caption_override had other translations { "lang" : "en" , "text" : 
"View of the ancient path." } ] } ], "translations" : [ // Other available 
translations for core article fields { "lang" : "en" , "title" : "Ancient 
History of the Path" , "excerpt" : "..." , "body_content" : "<p>Full article 
content in English...</p>" } ] } GET /v1/media-roles?lang=it JSON [ { 
"role_code" : "gallery_image" , "name" : "Immagine Galleria" , // Italian 
"description" : "Immagine da utilizzare in una galleria di contenuti." , // 
Italian "icon_identifier" : "image_aspect_ratio" , "translations" : [ // Other 
available translations { "lang" : "en" , "name" : "Gallery Image" , 
"description" : "Image for use in a content gallery." } ] }, { "role_code" : 
"featured_image" , "name" : "Immagine in Evidenza" , // Italian "description" : 
"Immagine rappresentativa principale." , // Italian "icon_identifier" : "star" 
, "translations" : [ { "lang" : "en" , "name" : "Featured Image" , 
"description" : "Primary representative image." } ] } ] 3. Database-Support 
Analysis For each conceptual endpoint: GET /v1/articles Indexes : The 
public.published_articles_view uses underlying indexes on 
articles.article_status , articles.deleted_at , articles.publication_date , 
articles.title . Filtering by tags ( TEXT[] ) on public.articles will 
effectively use idx_articles_tags (GIN). Filtering by region_id , trail_id , 
town_id will use idx_articles_associated_region_id , 
idx_articles_associated_trail_id , idx_articles_associated_town_id 
respectively. Current indexes seem largely sufficient for the view and direct 
queries. Join Complexity : The public.published_articles_view already handles 
joins to profiles and media (for featured image). Fetching translations 
dynamically if lang is provided would require an additional join or lookup to 
public.translations per article if not handled by a database function. 
Recommendation : A database function get_articles_list(lang_code TEXT, filters 
JSONB, sort_options JSONB, page INT, per_page INT) would be ideal to 
encapsulate the view logic, dynamic translation handling, filtering, and 
pagination, returning a structured JSON response. Performance Gotchas : RLS on 
articles , profiles , media will be invoked. Policies should be optimized. GIN 
index on tags is good for tag filtering. Multiple comma-separated tags (e.g. 
tags=history,nature meaning articles with EITHER history OR nature) can be 
handled with tags && ARRAY['history','nature'] . If it means articles with ALL 
tags, then tags @> ARRAY['history','nature'] . The query needs to be 
constructed carefully. Missing Data? : No obvious missing fields for a list 
view based on the published_articles_view structure. GET /v1/articles/{slug} 
Indexes : idx_articles_slug (or the unique constraint index on articles.slug ) 
is crucial and exists. This endpoint would also leverage 
public.published_articles_view (for base article data) and potentially 
public.article_media_details_view (for the gallery). Indexes supporting these 
views are relevant here. Join Complexity : Fetching the main article data can 
use public.published_articles_view (filtered by slug). Fetching the gallery 
would query public.article_media_details_view (filtered by article_id ). 
Dynamic translation for article fields and gallery media caption/alt overrides 
would add lookups/joins to public.translations . Recommendation : A database 
function get_article_by_slug(p_slug TEXT, p_lang_code TEXT) is highly 
recommended to assemble the complete article object with its translated fields 
and resolved gallery. This shifts complexity to the database for optimized 
retrieval. Performance Gotchas : RLS on all involved tables and views. 
Efficiently joining and translating multiple gallery items needs care. The 
article_media_details_view helps, but dynamic translation per item is a 
consideration. Missing Data? : The schema seems to cover the data for a 
detailed article view. GET /v1/media-roles Indexes : Queries on 
public.media_roles_master would use the PK on role_code and 
idx_media_roles_master_is_active . Sufficient. Join Complexity : Simple select 
from media_roles_master . Dynamic translation for default_display_name and 
default_description would involve lookups/joins to public.translations . 
Recommendation : A simple view or direct query is fine. A database function 
could handle the translation if direct translation in the main fields is 
desired per lang param. Performance Gotchas : Minimal; table is small. RLS is 
simple. Missing Data? : No. 4. Immediate Schema Tweaks (if any) Based on this 
API conceptualization for Module 8: ðŸŸ¢ Optional future/Optimization : Database 
Functions for Complex Objects : Strongly reinforce the recommendation from 
Module 1's API spec. For endpoints like GET /v1/articles/{slug} and even GET 
/v1/articles that require dynamic translation and assembling data from multiple 
sources (base article, author, featured image, gallery, translations for all 
text fields), PostgreSQL functions callable via RPC (e.g., for Supabase) are 
highly recommended. They would encapsulate the logic of joining, applying 
translations based on the lang parameter, and formatting the JSON, leading to 
cleaner API gateway logic and potentially better performance. The provided 
views ( published_articles_view , article_media_details_view ) serve as 
excellent building blocks for such functions. Source Language Metadata for 
Articles : If it's important for the API to expose what language an article was 
originally authored in (if not the platform's primary reference language), a 
column like original_language_code TEXT NULL REFERENCES 
public.languages_master(language_code) could be added to public.articles . This 
is a ðŸŸ¢ Optional future consideration depending on editorial workflow 
requirements. For now, the assumption is the main columns hold the primary 
reference language (English), and specific workflow handles ingestion. 
Dedicated Translation Fetching Endpoints : Consider if general-purpose 
endpoints to fetch all translations for a given entity ID and field might be 
useful for administrative UIs, e.g., GET 
/translations?table_identifier=articles&row_foreign_key=101&column_identifier=ti
tle . This is more of an API design pattern than a schema tweak. No ðŸ”´ Must-fix 
or ðŸŸ  Nice-to-have schema adjustments are identified solely from this API 
conceptualization exercise for Module 8 that were not already covered or 
implied by the V2.1 design of the tables and views themselves. The current 
schema, supplemented by the proposed views and strong recommendation for 
database functions for read APIs, provides a solid foundation. 
