# 4.1.1 API Contract

  https://gemini.google.com/u/1/app/5c36af70115d07fa Okay, all files have been 
received. I will now proceed with the analysis and generation of the API 
contract and supporting documentation. ### OpenAPI 3.1 Spec YAML ``` openapi: 
3.1.0 info: title: Via di Francesco Pilgrimage Platform API version: v1.0 
description: |- API for the Via di Francesco Pilgrimage Platform. This V1 
provides core read endpoints and essential write endpoints for managing 
platform data including user profiles, media, trails, waypoints, and user 
interactions. All text fields that are translatable will be returned in the 
language specified by the `lang` query parameter, falling back to the primary 
reference language (English per [cite: 670, 776]) if the translation is not 
available or `lang` is not specified. contact: name: Via di Francesco Platform 
Team url: https://example.com/contact # Placeholder servers: - url: 
https://api.viadifrancesco.example.com/v1 # Placeholder description: Production 
Server - url: http://localhost:8000/rest/v1 # Placeholder for Supabase local 
PostgREST description: Development Server (PostgREST) tags: - name: User & 
Content Infrastructure description: User profiles, roles, languages, media, and 
translations management. [cite: 703, 1715] - name: Core Trail Hierarchy 
description: Management of trails, routes, and segments. [cite: 716] - name: 
Geographical Context description: Management of regions, provinces, and towns. 
[cite: 727] - name: Waypoints description: Points of Interest (POIs), 
categories, tags, and related waypoint details. [cite: 735] - name: Waypoint 
Master Data description: Management of master data related to waypoints like 
categories, tags, and content statuses. [cite: 1, 1834] - name: Dynamic 
Conditions description: Management of trail warnings and dynamic conditions. 
[cite: 748] - name: User Interaction description: User-generated content like 
votes, tips, and reviews. [cite: 754] - name: Curated Itineraries description: 
Management of curated pilgrimage itineraries. [cite: 758] - name: Platform 
Content description: Management of general platform content like articles. 
[cite: 765] components: schemas: # Common Schemas ApiError: type: object 
description: Standard error object. [cite: 114] properties: code: type: string 
description: A machine-readable error code or PostgREST error code. [cite: 114] 
example: "PGRST116" # Example from Supabase/PostgREST [cite: 114] message: 
type: string description: A human-readable summary of the error. [cite: 114] 
example: "Invalid input." details: type: string description: More specific 
details about the error. [cite: 114] example: "Field 'email' must be a valid 
email address." hint: type: string description: Optional hint on how to resolve 
the error. [cite: 114] example: "Ensure the email format is correct." required: 
- code - message Pagination: type: object properties: total_items: type: 
integer description: Total number of items available. example: 150 items: type: 
array items: type: object # This will be replaced by specific resource schemas 
offset: type: integer description: The offset (number of items to skip) from 
the beginning of the collection. example: 0 limit: type: integer description: 
The maximum number of items to return. example: 20 # Module 1: User & Content 
Infrastructure Profile: description: User profile information. [cite: 917, 
1044] type: object properties: id: type: string format: uuid description: 
User's ID from auth.users table. [cite: 932, 934] readOnly: true username: 
type: string nullable: true description: Optional unique username. [cite: 940, 
943] full_name: type: string nullable: true description: User's full name. 
[cite: 944, 948] public_display_name: type: string nullable: true description: 
Name shown publicly. [cite: 949, 952] public_avatar_media_id: type: string 
format: uuid nullable: true description: ID of the media item for public 
avatar. [cite: 953, 956] public_bio: type: string nullable: true description: 
Short public biography. [cite: 958, 961] preferred_language_code: type: string 
description: User's preferred language code (e.g., 'en', 'it'). [cite: 962, 
965] default: "en" preferred_units_of_measure: type: string description: User's 
preference for units ('metric', 'imperial'). [cite: 967, 969] enum: ["metric", 
"imperial"] default: "metric" pilgrim_experience_level: type: string nullable: 
true description: Self-assessed pilgrim experience level. [cite: 973, 976] 
enum: [null, "novice_first_pilgrimage", "intermediate_few_pilgrimages", 
"experienced_many_pilgrimages", "long_distance_veteran"] 
pilgrimage_interests_tags: type: array items: type: string nullable: true 
description: Array of interest tags. [cite: 977, 980] 
is_profile_publicly_visible: type: boolean description: Master switch for 
public visibility of profile fields. [cite: 1000, 1003] default: false 
account_status: type: string description: Current status of the user's 
application account. [cite: 1008, 1010] enum: ["active", 
"pending_verification", "email_unconfirmed", "suspended_by_admin", 
"deactivated_by_user"] default: "active" readOnly: true roles: type: array 
items: type: string description: Array of role codes assigned to the user. 
These roles are synchronized from `public.profiles.roles` to the JWT. [cite: 
935, 939, 1716] example: ["pilgrim_user", "content_moderator"] public_avatar: # 
Populated if include=avatar_details $ref: '#/components/schemas/Media' 
nullable: true role_details: # Populated if include=role_details type: array 
items: $ref: '#/components/schemas/UserRoleMaster' nullable: true 
last_activity_at: type: string format: date-time nullable: true readOnly: true 
description: Timestamp of the last recorded user activity. [cite: 1018, 1021, 
1047] created_at: type: string format: date-time description: Timestamp of 
profile creation. [cite: 1022, 1025] readOnly: true updated_at: type: string 
format: date-time description: Timestamp of last profile update. [cite: 1026, 
1029] readOnly: true updated_by_profile_id: type: string format: uuid nullable: 
true description: Profile ID of admin who last updated this profile. [cite: 
1030, 1033] readOnly: true required: - id - roles - preferred_language_code - 
preferred_units_of_measure - is_profile_publicly_visible - account_status 
ProfileUpdate: description: Fields for updating a user profile. type: object 
properties: username: type: string nullable: true full_name: type: string 
nullable: true public_display_name: type: string nullable: true 
public_avatar_media_id: # User would select an existing media ID or trigger an 
upload then link type: string format: uuid nullable: true public_bio: type: 
string nullable: true preferred_language_code: type: string 
preferred_units_of_measure: type: string enum: ["metric", "imperial"] 
pilgrim_experience_level: type: string nullable: true enum: [null, 
"novice_first_pilgrimage", "intermediate_few_pilgrimages", 
"experienced_many_pilgrimages", "long_distance_veteran"] 
pilgrimage_interests_tags: type: array items: type: string nullable: true 
is_profile_publicly_visible: type: boolean UserRoleMaster: description: Defines 
an available user role. [cite: 1133, 1218] type: object properties: role_code: 
type: string description: Short, unique, machine-readable role code. [cite: 
1144, 1147, 1219] readOnly: true default_display_name: type: string 
description: Human-readable name in the primary reference language (English). 
Translatable. [cite: 1149, 1153, 1220] default_description: type: string 
nullable: true description: Detailed description of the role in the primary 
reference language. Translatable. [cite: 1155, 1159, 1221] icon_identifier: 
type: string nullable: true description: Optional identifier for a UI icon. 
[cite: 1161, 1165, 1222] is_role_active: type: boolean description: If true, 
the role is active and assignable. [cite: 1183, 1187] readOnly: true # 
translations: # Example from conceptual API[cite: 834], actual API would return 
translated fields directly based on lang # type: array # items: # type: object 
# properties: # lang: # type: string # default_display_name: # type: string # 
default_description: # type: string # nullable: true required: - role_code - 
default_display_name - is_role_active LanguageMaster: description: Defines a 
language supported by the platform. [cite: 1304, 1363] type: object properties: 
language_code: type: string description: ISO 639-1 code or IETF tag (e.g., 
'en', 'it'). [cite: 1314, 1317, 1365] readOnly: true display_name_native: type: 
string description: Name of the language in its native script. [cite: 1319, 
1322, 1366] display_name_en: type: string description: Common name of the 
language in English. [cite: 1323, 1327, 1367] icon_identifier: type: string 
nullable: true description: Optional identifier for a UI icon. [cite: 1328, 
1331, 1368] is_active_for_platform: type: boolean description: If true, 
language is actively supported. [cite: 1333, 1335, 1369] readOnly: true # 
Typically managed by admins display_order_ui: type: integer nullable: true 
description: Optional order for display in UI. [cite: 1340, 1342, 1372] 
required: - language_code - display_name_native - display_name_en - 
is_active_for_platform Media: description: Metadata for a media item. [cite: 
1550, 1662] type: object properties: id: type: string format: uuid description: 
Unique identifier for the media item. [cite: 1561, 1564] readOnly: true 
uploader_profile_id: type: string format: uuid nullable: true description: 
Profile ID of the user who uploaded this media. [cite: 1565, 1567] readOnly: 
true storage_bucket_name: type: string description: Supabase Storage bucket 
name. [cite: 1569, 1572] readOnly: true storage_object_path_original: type: 
string description: Full, unique path to the original object in its bucket. 
[cite: 1573, 1575] readOnly: true file_name_original: type: string description: 
Original filename as provided by the uploader. [cite: 1576, 1579] 
file_mime_type: type: string description: MIME type of the original file. 
[cite: 1580, 1583] file_size_bytes_original: type: integer format: int64 
nullable: true description: Size of the original uploaded file in bytes. [cite: 
1584, 1586] image_width_px_original: type: integer nullable: true description: 
For images, the original width in pixels. [cite: 1587, 1589] 
image_height_px_original: type: integer nullable: true description: For images, 
the original height in pixels. [cite: 1590, 1592] image_variants_json: type: 
object # JSONB in DB [cite: 1593, 1665, 1681] nullable: true description: |- 
JSON object storing relative paths for optimized image versions. Example: 
`{"thumb_s_webp": "variants/uuid_thumb_s.webp", "display_m_jpeg": 
"variants/uuid_display_m.jpg"}` [cite: 1597, 1681] additionalProperties: true 
default_alt_text: type: string nullable: true description: Default alternative 
text in the primary reference language (English). Translatable. [cite: 1598, 
1601, 1666] default_caption: type: string nullable: true description: Default 
caption in the primary reference language (English). Translatable. [cite: 1602, 
1606, 1667] attribution_text: type: string nullable: true description: Credit 
for the photographer/source. Potentially translatable. [cite: 1607, 1610] 
licence: type: string nullable: true description: Usage license associated with 
the media item. [cite: 1616, 1618] enum: [null, "all_rights_reserved", "cc_by", 
"cc_by_sa", "cc_by_nd", "cc_by_nc", "cc_by_nc_sa", "cc_by_nc_nd", 
"cc0_public_domain", "uploader_owns_contact_for_use", 
"official_permission_granted", "unknown_licence"] # from media_licence_enum 
[cite: 1654] media_asset_type: type: string description: General type of media 
asset. [cite: 1619, 1620] enum: ["image", "document_pdf", "audio_clip", 
"video_clip", "gpx_file", "other_file"] # from media_asset_type_enum [cite: 
1653] media_status: type: string description: Current workflow/visibility 
status of the media item. [cite: 1621, 1624] enum: ["processing_upload", 
"pending_review", "published_approved", "rejected_hidden", "archived", 
"error_uploading"] # from media_status_enum [cite: 1655] readOnly: true # 
Managed by specific endpoints or admin actions tags: type: array items: type: 
string nullable: true description: Array of keywords/tags for categorizing or 
searching media. [cite: 1625, 1627] uploader_profile: # Populated if 
include_uploader_profile=true [cite: 832] type: object nullable: true 
properties: id: type: string format: uuid public_display_name: type: string 
created_at: type: string format: date-time description: Timestamp of when this 
media record was created. [cite: 1639, 1640] readOnly: true updated_at: type: 
string format: date-time description: Timestamp of when this media record was 
last updated. [cite: 1641, 1643] readOnly: true required: - id - 
storage_bucket_name - storage_object_path_original - file_name_original - 
file_mime_type - media_asset_type - media_status # Module 4: Waypoint Master 
Data WaypointCategoryMaster: description: Defines a broad classification for 
waypoints. [cite: 350, 353, 403] type: object properties: id: type: integer 
description: Unique identifier for the waypoint category. [cite: 357, 358] 
readOnly: true code: type: string description: Short, stable, machine-readable 
code (e.g., 'accommodation_location'). [cite: 359, 360, 383] readOnly: true 
label: type: string description: Human-readable name for the category. 
Translatable. [cite: 361, 362, 384] description: type: string nullable: true 
description: Optional description of the category. Translatable. [cite: 363, 
385] icon_identifier: type: string nullable: true description: Name, class, or 
path for a UI icon. [cite: 364, 365, 386] requires_detail_table: type: string 
nullable: true description: Name of the specific detail table this category 
implies (e.g., 'accommodations'). [cite: 366, 367, 387] sort_order: type: 
integer description: Determines display order in UI. [cite: 368, 369, 388] 
is_active: type: boolean description: True if the category definition is 
active. [cite: 370, 390] readOnly: true # Typically managed by admins required: 
- id - code - label - sort_order - is_active TagMaster: description: Defines a 
curated descriptive tag. [cite: 461, 465, 514] type: object properties: id: 
type: integer description: Unique identifier for the tag. [cite: 469, 470] 
readOnly: true tag_code: type: string description: Short, stable, 
machine-readable code for the tag (e.g., 'franciscan_site'). [cite: 471, 472, 
494] readOnly: true label: type: string description: Human-readable name for 
the tag. Translatable. [cite: 473, 474, 495] description: type: string 
nullable: true description: Optional description of the tag. Translatable. 
[cite: 475, 496] tag_type: type: string nullable: true description: Optional 
type to group tags (e.g., 'amenity', 'poi_feature'). [cite: 476, 477, 497] 
icon_identifier: type: string nullable: true description: Optional UI icon 
identifier. [cite: 478, 479, 499] sort_order: type: integer description: 
Determines display order. [cite: 480, 481, 500] is_active: type: boolean 
description: True if the tag definition is active. [cite: 482, 501] readOnly: 
true # Typically managed by admins required: - id - tag_code - label - 
sort_order - is_active ContentStatusMaster: description: Defines a content 
lifecycle status. [cite: 571, 575, 600] type: object properties: id: type: 
integer description: Unique identifier for the content status. [cite: 578, 579] 
readOnly: true code: type: string description: Short, stable, machine-readable 
code (e.g., 'draft', 'published'). [cite: 580, 581, 602] readOnly: true label: 
type: string description: Human-readable name for the status. Translatable. 
[cite: 582, 583, 603] description: type: string nullable: true description: 
Optional description of the status. Translatable. [cite: 584, 604] 
is_publicly_visible: type: boolean description: Indicates if content with this 
status is generally visible to public users. [cite: 585, 605] sort_order: type: 
integer description: Determines display order. [cite: 586, 587, 606] is_active: 
type: boolean description: True if the status definition itself is active. 
[cite: 588, 589, 607] readOnly: true # Typically managed by admins required: - 
id - code - label - is_publicly_visible - sort_order - is_active # Module 4: 
Waypoints Waypoint: description: A geographically located point of interest 
(POI). [cite: 140, 143, 234] type: object properties: id: type: integer # 
BIGINT in DB [cite: 153] format: int64 description: Unique identifier for the 
waypoint. [cite: 153, 235] readOnly: true name: type: string description: 
Primary human-readable name of the waypoint. Translatable. [cite: 154, 155, 
236] slug: type: string nullable: true description: URL-friendly identifier. 
[cite: 156, 157, 237] alternate_names_primary_lang: type: array items: type: 
string nullable: true description: Array of other known names in the primary 
reference language (English). [cite: 158, 238] waypoint_primary_category_id: 
type: integer description: ID of the primary category from 
`waypoint_categories_master`. [cite: 160, 239] waypoint_subcategory_tag_ids: 
type: array items: type: integer nullable: true description: Array of tag IDs 
from `tags_master`. [cite: 162, 240] description: type: string nullable: true 
description: General, brief description of the waypoint. Translatable. [cite: 
163, 242] geom: # GeoJSON Point representation type: object description: 
GeoJSON Point geometry (PointZ, SRID 4326 WGS84). [cite: 164, 243, 282] 
properties: type: type: string enum: [Point] coordinates: type: array items: 
type: number format: double minItems: 2 # longitude, latitude maxItems: 3 # 
longitude, latitude, elevation required: - type - coordinates latitude: type: 
number format: double description: Latitude coordinate (WGS 84). Generated from 
geom. [cite: 166, 244] readOnly: true longitude: type: number format: double 
description: Longitude coordinate (WGS 84). Generated from geom. [cite: 167, 
245] readOnly: true elevation_meters: type: integer nullable: true description: 
Elevation in meters. Generated from geom's Z value. [cite: 168, 169, 246] 
readOnly: true town_id: type: integer nullable: true description: ID of the 
associated town from `towns` table. [cite: 170, 247] parent_waypoint_id: type: 
integer # BIGINT in DB [cite: 171] format: int64 nullable: true description: ID 
of the parent waypoint for hierarchical waypoints. [cite: 171, 172, 248] 
address_text: type: string nullable: true description: Textual street address. 
Translatable. [cite: 173, 249] primary_image_media_id: type: string format: 
uuid nullable: true description: ID of the primary representative image from 
`media` table. [cite: 174, 175, 250] primary_thumbnail_media_id: type: string 
format: uuid nullable: true description: ID of the primary thumbnail image from 
`media` table. [cite: 176, 251] content_visibility_status_id: type: integer 
description: ID of the content status from `content_statuses_master`. [cite: 
177, 178, 252] is_seasonal: type: boolean description: Indicates if 
availability is seasonal. [cite: 179, 253] default: false 
is_trail_access_point: type: boolean description: Flags common trail access 
points. [cite: 180, 254] default: false is_significant_trail_junction: type: 
boolean description: Flags major trail junctions. [cite: 181, 255] default: 
false is_franciscan_highlight_site: type: boolean description: Flags key 
Franciscan sites. [cite: 182, 256] default: false is_significant_pilgrim_poi: 
type: boolean description: Flags POIs of major significance to pilgrims. [cite: 
183, 257] default: false short_narrative_for_dynamic_lists: type: string 
maxLength: 250 nullable: true description: Brief descriptive snippet. 
Translatable. [cite: 184, 185, 258] waypoint_accessibility_notes: type: string 
nullable: true description: Specific accessibility notes. Translatable. [cite: 
186, 259] general_tags_text: type: array items: type: string nullable: true 
description: Array of general, free-text descriptive tags. [cite: 187, 261] 
primary_data_source_waypoint: type: string nullable: true description: 
Information on the source of this waypoint's data. [cite: 188, 262] 
quality_score: type: integer format: int32 # smallint in DB minimum: 0 maximum: 
100 nullable: true description: Internal score indicating data 
confidence/completeness (0-100). [cite: 189, 190, 263] # Audit fields 
created_at: type: string format: date-time readOnly: true description: 
Timestamp of record creation. [cite: 190, 264] created_by_profile_id: type: 
string format: uuid nullable: true readOnly: true # Set on creation 
description: Profile ID of the user who created the record. [cite: 191, 192] 
updated_at: type: string format: date-time readOnly: true description: 
Timestamp of last update. [cite: 193, 265] updated_by_profile_id: type: string 
format: uuid nullable: true readOnly: true # Set on update description: Profile 
ID of the user who last updated the record. [cite: 194, 195] deleted_at: type: 
string format: date-time nullable: true readOnly: true description: Timestamp 
for soft deletion. [cite: 196, 266] required: - name - 
waypoint_primary_category_id - geom - content_visibility_status_id - 
is_seasonal - is_trail_access_point - is_significant_trail_junction - 
is_franciscan_highlight_site - is_significant_pilgrim_poi WaypointCreate: 
description: Data for creating a new waypoint. type: object properties: name: 
type: string maxLength: 255 slug: type: string nullable: true pattern: 
"^[a-z0-9]+(?:-[a-z0-9]+)*$" maxLength: 100 alternate_names_primary_lang: type: 
array items: type: string nullable: true waypoint_primary_category_id: type: 
integer waypoint_subcategory_tag_ids: type: array items: type: integer 
nullable: true description: type: string nullable: true geom: type: object 
properties: type: type: string enum: [Point] coordinates: type: array items: 
type: number format: double minItems: 2 maxItems: 3 required: - type - 
coordinates town_id: type: integer nullable: true parent_waypoint_id: type: 
integer format: int64 nullable: true address_text: type: string nullable: true 
primary_image_media_id: type: string format: uuid nullable: true 
primary_thumbnail_media_id: type: string format: uuid nullable: true 
content_visibility_status_id: # Default is 'draft' [cite: 177] type: integer 
is_seasonal: type: boolean default: false is_trail_access_point: type: boolean 
default: false is_significant_trail_junction: type: boolean default: false 
is_franciscan_highlight_site: type: boolean default: false 
is_significant_pilgrim_poi: type: boolean default: false 
short_narrative_for_dynamic_lists: type: string maxLength: 250 nullable: true 
waypoint_accessibility_notes: type: string nullable: true general_tags_text: 
type: array items: type: string nullable: true required: - name - 
waypoint_primary_category_id - geom - content_visibility_status_id 
WaypointUpdate: description: Data for updating an existing waypoint. allOf: # 
Allows all fields from WaypointCreate to be optional - $ref: 
'#/components/schemas/WaypointCreate' # Placeholder Schemas for other modules 
(conceptual) Trail: type: object properties: id: { type: integer, readOnly: 
true } name: { type: string } description: { type: string, nullable: true } # 
... other conceptual fields based on Module 2 overview [cite: 717] created_at: 
{ type: string, format: date-time, readOnly: true } updated_at: { type: string, 
format: date-time, readOnly: true } required: [name] TrailCreate: type: object 
properties: name: { type: string } description: { type: string, nullable: true 
} required: [name] Region: type: object properties: id: { type: integer, 
readOnly: true } name: { type: string } # ... other conceptual fields based on 
Module 3 overview [cite: 728] required: [name] Town: type: object properties: 
id: { type: integer, readOnly: true } name: { type: string } # ... other 
conceptual fields based on Module 3 overview [cite: 728] required: [name] 
SegmentWarning: type: object properties: id: { type: integer, readOnly: true } 
title: { type: string } description: { type: string } segment_id: { type: 
integer } # Assuming linkage warning_type_id: { type: integer } severity_id: { 
type: integer } # ... other conceptual fields based on Module 5 overview [cite: 
749] created_at: { type: string, format: date-time, readOnly: true } 
updated_at: { type: string, format: date-time, readOnly: true } required: 
[title, description, segment_id, warning_type_id, severity_id] 
SegmentWarningCreate: type: object properties: title: { type: string } 
description: { type: string } segment_id: { type: integer } warning_type_id: { 
type: integer } severity_id: { type: integer } required: [title, description, 
segment_id, warning_type_id, severity_id] UserWaypointVote: # Conceptual based 
on Module 6 overview [cite: 755] type: object properties: waypoint_id: { type: 
integer } profile_id: { type: string, format: uuid } vote_type: { type: string, 
enum: ["up", "down"] } # from vote_type_enum [cite: 756] created_at: { type: 
string, format: date-time, readOnly: true } required: [waypoint_id, profile_id, 
vote_type] UserWaypointShortTip: # Conceptual based on Module 6 overview [cite: 
755] type: object properties: id: { type: integer, readOnly: true } 
waypoint_id: { type: integer } profile_id: { type: string, format: uuid } 
tip_text: { type: string } tip_category_id: { type: integer, nullable: true } 
moderation_status: { type: string, readOnly: true } # from 
content_moderation_status_enum [cite: 756] created_at: { type: string, format: 
date-time, readOnly: true } required: [waypoint_id, profile_id, tip_text] 
UserWaypointShortTipCreate: type: object properties: tip_text: { type: string } 
tip_category_id: { type: integer, nullable: true } required: [tip_text] 
AccommodationReview: # Conceptual based on Module 6 overview, new table [cite: 
686, 755] type: object properties: id: { type: integer, format: "int64", 
readOnly: true } # bigint in DB [cite: 686] accommodation_waypoint_id: { type: 
integer } # Assuming this links to waypoint.id of an accommodation [cite: 686] 
profile_id: { type: string, format: "uuid" } [cite: 686] rating: { type: 
integer, minimum: 1, maximum: 5 } review_title: { type: string, nullable: true 
} review_body: { type: string } language_code: { type: string } [cite: 686] 
moderation_status: { type: string, readOnly: true } # from 
content_moderation_status_enum [cite: 756] created_at: { type: string, format: 
"date-time", readOnly: true } required: [accommodation_waypoint_id, profile_id, 
rating, review_body, language_code] AccommodationReviewCreate: type: object 
properties: rating: { type: integer, minimum: 1, maximum: 5 } review_title: { 
type: string, nullable: true } review_body: { type: string } language_code: { 
type: string } required: [rating, review_body, language_code] CuratedItinerary: 
# Conceptual based on Module 7 overview [cite: 759] type: object properties: 
id: { type: integer, readOnly: true } name: { type: string } description: { 
type: string, nullable: true } # ... other fields created_at: { type: string, 
format: date-time, readOnly: true } required: [name] CuratedItineraryCreate: 
type: object properties: name: { type: string } description: { type: string, 
nullable: true } required: [name] Article: # Conceptual based on Module 8 
overview, new table [cite: 688, 766] type: object properties: id: { type: 
integer, format: "int64", readOnly: true } # bigint in DB [cite: 688] title: { 
type: string } body_content: { type: string } author_profile_id: { type: 
string, format: "uuid" } [cite: 688] featured_image_media_id: { type: string, 
format: "uuid", nullable: true } [cite: 688] # ... other fields like 
associated_trail_id, region_id, town_id, status_id [cite: 688, 771] created_at: 
{ type: string, format: "date-time", readOnly: true } required: [title, 
body_content, author_profile_id] ArticleCreate: type: object properties: title: 
{ type: string } body_content: { type: string } featured_image_media_id: { 
type: string, format: "uuid", nullable: true } required: [title, body_content] 
parameters: Lang: name: lang in: query description: |- The language code for 
translated content (e.g., `it`, `en`). Defaults to primary reference language 
(English) if not provided or translation unavailable. [cite: 4, 824] required: 
false schema: type: string example: "it" Offset: name: offset in: query 
description: Number of items to skip for pagination. required: false schema: 
type: integer minimum: 0 default: 0 Limit: name: limit in: query description: 
Maximum number of items to return for pagination. required: false schema: type: 
integer minimum: 1 maximum: 100 # Example maximum default: 20 SortBy: name: 
sort_by in: query description: Field to sort by (e.g., `name`, `created_at`). 
Specific to endpoint. required: false schema: type: string Order: name: order 
in: query description: Sort order. required: false schema: type: string enum: 
[asc, desc] default: asc Include: name: include in: query description: 
Comma-separated list of related resources to include (e.g., `role_details`, 
`avatar_details`). Specific to endpoint. [cite: 823] required: false schema: 
type: string securitySchemes: bearerAuth: # JWT Authentication [cite: 95, 107, 
868] type: http scheme: bearer bearerFormat: JWT description: "Supabase JWT 
token. Roles are embedded in the token (e.g., in `app_metadata.roles`) and used 
by RLS policies. [cite: 99, 100, 101]" security: - bearerAuth: [] # Applies JWT 
bearer auth globally by default. Public endpoints will have security overrides. 
paths: # Module 1: User & Content Infrastructure /profiles/me: get: tags: [User 
& Content Infrastructure] summary: Get current user's profile description: |- 
Retrieve detailed profile information for the currently authenticated user. 
[cite: 822] Requires `authenticated_user` role. [cite: 103] operationId: 
getCurrentUserProfile parameters: - $ref: '#/components/parameters/Lang' - 
$ref: '#/components/parameters/Include' # e.g. 
include=role_details,avatar_details [cite: 823] responses: '200': description: 
Successful retrieval of user profile. content: application/json: schema: $ref: 
'#/components/schemas/Profile' examples: italianProfile: value: id: 
"123e4567-e89b-12d3-a456-426614174000" username: "anna_pilgrim" full_name: 
"Anna Rossi" public_display_name: "Anna R." preferred_language_code: "it" 
roles: ["pilgrim_user"] # ... other fields as per schema example [cite: 833] 
'401': description: Unauthorized - Authentication token is missing or invalid. 
[cite: 118] content: application/json: schema: $ref: 
'#/components/schemas/ApiError' '403': description: Forbidden - User does not 
have permission. [cite: 118] content: application/json: schema: $ref: 
'#/components/schemas/ApiError' put: tags: [User & Content Infrastructure] 
summary: Update current user's profile description: |- Update mutable fields of 
the currently authenticated user's profile. Requires `authenticated_user` role. 
[cite: 103] operationId: updateCurrentUserProfile requestBody: required: true 
content: application/json: schema: $ref: '#/components/schemas/ProfileUpdate' 
responses: '200': description: Profile updated successfully. content: 
application/json: schema: $ref: '#/components/schemas/Profile' '400': 
description: Bad Request - Invalid input data. [cite: 117] content: 
application/json: schema: $ref: '#/components/schemas/ApiError' '401': 
description: Unauthorized. [cite: 118] content: application/json: schema: $ref: 
'#/components/schemas/ApiError' '403': description: Forbidden. [cite: 118] 
content: application/json: schema: $ref: '#/components/schemas/ApiError' 
/user_roles: get: tags: [User & Content Infrastructure] summary: List available 
user roles description: |- Retrieve a list of all active and system-defined 
user roles. [cite: 1253] Accessible by `anonymous` users. [cite: 103, 1253] 
operationId: listUserRoles security: [] # Public endpoint parameters: - $ref: 
'#/components/parameters/Lang' - name: is_role_active # Based on 
user_roles_master schema [cite: 1183] in: query required: false schema: type: 
boolean default: true responses: '200': description: A list of user roles. 
content: application/json: schema: type: array items: $ref: 
'#/components/schemas/UserRoleMaster' /languages: get: tags: [User & Content 
Infrastructure] summary: List available platform languages description: |- 
Fetch a list of languages supported by the platform. [cite: 825, 1400] 
Accessible by `anonymous` users. [cite: 103, 1400] operationId: listLanguages 
security: [] # Public endpoint parameters: - name: is_active_for_platform # 
Based on languages_master schema [cite: 1333] in: query required: false schema: 
type: boolean default: true - $ref: '#/components/parameters/SortBy' # e.g. 
display_order_ui [cite: 827, 1340] - $ref: '#/components/parameters/Order' 
responses: '200': description: A list of languages. content: application/json: 
schema: type: array items: $ref: '#/components/schemas/LanguageMaster' 
examples: languagesList: value: - language_code: "en" display_name_native: 
"English" display_name_en: "English" is_active_for_platform: true 
display_order_ui: 1 - language_code: "it" display_name_native: "Italiano" 
display_name_en: "Italian" is_active_for_platform: true display_order_ui: 2 # 
Based on example [cite: 838] /media: post: tags: [User & Content 
Infrastructure] summary: Upload a new media file description: |- Upload a new 
media file (e.g., image). The request should be multipart/form-data. The API 
will process the file, store it, generate variants (backend process [cite: 779, 
807, 1708]), and create a metadata record. Requires `authenticated_user` role. 
[cite: 103] (Specific roles like `accommodation_host` might be implied for 
certain contexts). operationId: uploadMedia requestBody: required: true 
content: multipart/form-data: schema: type: object properties: file: type: 
string format: binary description: The media file to upload. default_alt_text: 
type: string nullable: true description: Default alt text for the media. 
default_caption: type: string nullable: true description: Default caption for 
the media. licence: type: string enum: ["all_rights_reserved", "cc_by", 
"cc0_public_domain"] # Simplified nullable: true media_asset_type: # Usually 
inferred from file, but can be specified type: string enum: ["image", 
"document_pdf", "gpx_file"] # Simplified default: "image" tags: # 
Comma-separated string of tags type: string nullable: true responses: '201': 
description: Media uploaded and metadata record created successfully. content: 
application/json: schema: $ref: '#/components/schemas/Media' '400': 
description: Bad Request - Invalid file or metadata. [cite: 117] '401': 
description: Unauthorized. [cite: 118] '403': description: Forbidden. [cite: 
118] /media/{media_id}: get: tags: [User & Content Infrastructure] summary: Get 
media item details description: |- Retrieve comprehensive metadata for a 
specific media item. [cite: 829] Publicly accessible if media_status is 
'published_approved'. [cite: 1698] RLS handles this. operationId: 
getMediaItemDetails security: [] # Access controlled by RLS on media table 
parameters: - name: media_id in: path required: true description: UUID of the 
media item. [cite: 830] schema: type: string format: uuid - $ref: 
'#/components/parameters/Lang' # For translatable fields like alt text, caption 
[cite: 830] - name: include_uploader_profile in: query description: If true, 
includes basic public details of the uploader profile. [cite: 832] schema: 
type: boolean default: false responses: '200': description: Successful 
retrieval of media item details. content: application/json: schema: $ref: 
'#/components/schemas/Media' examples: mediaItemExample: value: id: 
"a1b2c3d4-e5f6-7890-1234-567890abcdef" file_name_original: "SanDamiano.jpg" 
file_mime_type: "image/jpeg" default_alt_text: "Chiesa di San Damiano" # 
Italian, assuming lang=it image_variants_json: { "thumb_s_webp": 
"variants/a1b2...thumb_s.webp" } # ... other fields [cite: 839] '404': 
description: Not Found - Media item does not exist or user lacks permission. 
[cite: 119] # Module 4: Waypoint Master Data /waypoint_categories: get: tags: 
[Waypoint Master Data] summary: List active waypoint categories description: |- 
Retrieve a list of all active waypoint categories. [cite: 2] Accessible by 
`anonymous` users (RLS filters for is_active=true). [cite: 60, 428] 
operationId: listWaypointCategories security: [] # Public endpoint, RLS filters 
by is_active parameters: - $ref: '#/components/parameters/Lang' # For 
translated label and description [cite: 3] - $ref: 
'#/components/parameters/SortBy' # e.g., sort_order, label [cite: 4] - $ref: 
'#/components/parameters/Order' # asc, desc [cite: 5] responses: '200': 
description: A list of active waypoint categories. content: application/json: 
schema: type: array items: $ref: '#/components/schemas/WaypointCategoryMaster' 
examples: categoriesExample: # Based on [cite: 8] value: - id: 1 code: 
"accommodation_location" label: "Alloggio" # Italian, assuming lang=it 
description: "Luoghi di soggiorno per pellegrini." icon_identifier: "icon-bed" 
sort_order: 10 is_active: true - id: 2 code: "attraction" label: "Attrazione" 
description: "Siti di interesse, inclusi religiosi, storici, naturali." 
icon_identifier: "icon-camera" sort_order: 20 is_active: true /tags: get: tags: 
[Waypoint Master Data] summary: List active tags description: |- Retrieve a 
list of all active tags, optionally filtered by type. [cite: 5] Accessible by 
`anonymous` users (RLS filters for is_active=true). [cite: 87, 541] 
operationId: listTags security: [] # Public endpoint, RLS filters by is_active 
parameters: - name: tag_type in: query description: Filters tags by their 
specified type code. [cite: 6, 476] required: false schema: type: string - 
$ref: '#/components/parameters/Lang' # For translated label and description 
[cite: 6] - $ref: '#/components/parameters/SortBy' # e.g., sort_order, label 
[cite: 7] - $ref: '#/components/parameters/Order' responses: '200': 
description: A list of active tags. content: application/json: schema: type: 
array items: $ref: '#/components/schemas/TagMaster' /content_statuses: get: 
tags: [Waypoint Master Data] summary: List active content statuses description: 
|- Retrieve a list of all active content status definitions. Accessible by 
`anonymous` users (RLS filters for is_active=true). [cite: 644] operationId: 
listContentStatuses security: [] # Public endpoint, RLS filters by is_active 
parameters: - $ref: '#/components/parameters/Lang' # For translated label and 
description - $ref: '#/components/parameters/SortBy' # e.g., sort_order [cite: 
586] - $ref: '#/components/parameters/Order' responses: '200': description: A 
list of active content statuses. content: application/json: schema: type: array 
items: $ref: '#/components/schemas/ContentStatusMaster' # Module 4: Waypoints 
/waypoints: get: tags: [Waypoints] summary: List waypoints description: |- 
Retrieve a list of waypoints, with filtering and pagination. Publicly 
accessible for published waypoints (RLS: content_visibility_status_id links to 
'published' and deleted_at IS NULL). [cite: 1892] operationId: listWaypoints 
security: [] # Access controlled by RLS parameters: - $ref: 
'#/components/parameters/Lang' - $ref: '#/components/parameters/Offset' - $ref: 
'#/components/parameters/Limit' - $ref: '#/components/parameters/SortBy' # e.g. 
name, created_at - $ref: '#/components/parameters/Order' - name: 
waypoint_primary_category_id in: query description: Filter by primary category 
ID. [cite: 160] schema: { type: integer } - name: town_id in: query 
description: Filter by town ID. [cite: 170] schema: { type: integer } - name: 
tags_include_any # Example for array field filtering in: query description: 
Comma-separated list of tag IDs to filter by (waypoint must have at least one). 
schema: { type: string } - name: is_seasonal in: query description: Filter by 
seasonal status. [cite: 179] schema: { type: boolean } # Add other relevant 
filter parameters based on Waypoint schema (e.g. is_franciscan_highlight_site 
[cite: 182]) responses: '200': description: A paginated list of waypoints. 
content: application/json: schema: allOf: - $ref: 
'#/components/schemas/Pagination' - type: object properties: items: type: array 
items: $ref: '#/components/schemas/Waypoint' '400': description: Bad Request - 
Invalid filter parameters. post: tags: [Waypoints] summary: Create a new 
waypoint description: |- Create a new waypoint. Requires role with content 
creation privileges (e.g., `regional_content_manager`, `admin`). [cite: 1894] 
The `created_by_profile_id` will be set to the authenticated user's ID. 
operationId: createWaypoint requestBody: required: true content: 
application/json: schema: $ref: '#/components/schemas/WaypointCreate' 
responses: '201': description: Waypoint created successfully. content: 
application/json: schema: $ref: '#/components/schemas/Waypoint' '400': 
description: Bad Request - Invalid input data. '401': description: 
Unauthorized. '403': description: Forbidden. /waypoints/{waypoint_id}: get: 
tags: [Waypoints] summary: Get waypoint by ID description: |- Retrieve a 
specific waypoint by its ID. Publicly accessible if published (RLS). [cite: 
1892] operationId: getWaypointById security: [] # Access controlled by RLS 
parameters: - name: waypoint_id in: path required: true description: ID of the 
waypoint to retrieve. schema: type: integer # BIGINT in DB [cite: 153] format: 
int64 - $ref: '#/components/parameters/Lang' # - $ref: 
'#/components/parameters/Include' # e.g. 
include=category_details,tags_details,primary_image_details responses: '200': 
description: Successful retrieval of waypoint details. content: 
application/json: schema: $ref: '#/components/schemas/Waypoint' '404': 
description: Not Found - Waypoint does not exist or user lacks permission. put: 
tags: [Waypoints] summary: Update a waypoint description: |- Update an existing 
waypoint. Requires role with content editing privileges (e.g., owner, 
`regional_content_manager`, `admin`). [cite: 1894] The `updated_by_profile_id` 
will be set to the authenticated user's ID. operationId: updateWaypoint 
parameters: - name: waypoint_id in: path required: true schema: type: integer 
format: int64 requestBody: required: true content: application/json: schema: 
$ref: '#/components/schemas/WaypointUpdate' responses: '200': description: 
Waypoint updated successfully. content: application/json: schema: $ref: 
'#/components/schemas/Waypoint' '400': description: Bad Request. '401': 
description: Unauthorized. '403': description: Forbidden. '404': description: 
Not Found. delete: tags: [Waypoints] summary: Delete a waypoint (soft delete) 
description: |- Soft delete a waypoint by setting its `deleted_at` timestamp. 
Requires role with content deletion privileges (e.g., owner, 
`regional_content_manager`, `admin`). [cite: 1894] operationId: deleteWaypoint 
parameters: - name: waypoint_id in: path required: true schema: type: integer 
format: int64 responses: '204': description: Waypoint soft deleted 
successfully. [cite: 116] '401': description: Unauthorized. '403': description: 
Forbidden. '404': description: Not Found. # Conceptual endpoints for other 
modules will follow a similar pattern # Module 2: Core Trail Hierarchy /trails: 
get: tags: [Core Trail Hierarchy] summary: List trails (Conceptual) 
description: Retrieve a list of trails. Publicly accessible for published 
trails. operationId: listTrails security: [] parameters: [$ref: 
'#/components/parameters/Lang', $ref: '#/components/parameters/Offset', $ref: 
'#/components/parameters/Limit'] responses: '200': { description: "A list of 
trails.", content: { application/json: { schema: { type: array, items: { $ref: 
'#/components/schemas/Trail' }}}}} post: tags: [Core Trail Hierarchy] summary: 
Create a trail (Conceptual) description: Create a new trail. Requires 
admin/manager role. operationId: createTrail requestBody: { required: true, 
content: { application/json: { schema: { $ref: 
'#/components/schemas/TrailCreate' }}}} responses: '201': { description: "Trail 
created.", content: { application/json: { schema: { $ref: 
'#/components/schemas/Trail' }}}} # Module 3: Geographical Context /regions: 
get: tags: [Geographical Context] summary: List regions (Conceptual) 
description: Retrieve a list of geographical regions. Publicly accessible. 
operationId: listRegions security: [] parameters: [$ref: 
'#/components/parameters/Lang', $ref: '#/components/parameters/Offset', $ref: 
'#/components/parameters/Limit'] responses: '200': { description: "A list of 
regions.", content: { application/json: { schema: { type: array, items: { $ref: 
'#/components/schemas/Region' }}}}} /towns: get: tags: [Geographical Context] 
summary: List towns (Conceptual) description: Retrieve a list of towns. 
Publicly accessible. operationId: listTowns security: [] parameters: [$ref: 
'#/components/parameters/Lang', $ref: '#/components/parameters/Offset', $ref: 
'#/components/parameters/Limit'] responses: '200': { description: "A list of 
towns.", content: { application/json: { schema: { type: array, items: { $ref: 
'#/components/schemas/Town' }}}}} # Module 5: Dynamic Conditions 
/segment_warnings: get: tags: [Dynamic Conditions] summary: List segment 
warnings (Conceptual) description: Retrieve a list of segment warnings. 
Publicly accessible for active warnings. operationId: listSegmentWarnings 
security: [] parameters: [$ref: '#/components/parameters/Lang', $ref: 
'#/components/parameters/Offset', $ref: '#/components/parameters/Limit'] 
responses: '200': { description: "A list of segment warnings.", content: { 
application/json: { schema: { type: array, items: { $ref: 
'#/components/schemas/SegmentWarning' }}}}} post: tags: [Dynamic Conditions] 
summary: Create a segment warning (Conceptual) description: Create a new 
segment warning. Requires regional_content_manager or admin role. [cite: 103] 
operationId: createSegmentWarning requestBody: { required: true, content: { 
application/json: { schema: { $ref: '#/components/schemas/SegmentWarningCreate' 
}}}} responses: '201': { description: "Segment warning created.", content: { 
application/json: { schema: { $ref: '#/components/schemas/SegmentWarning' }}}} 
# Module 6: User Interaction /waypoints/{waypoint_id}/votes: post: tags: [User 
Interaction] summary: Cast a vote for a waypoint (Conceptual) description: 
Allows an authenticated user to cast an up or down vote for a waypoint. 
Requires `authenticated_user` role. [cite: 103] operationId: castWaypointVote 
parameters: - name: waypoint_id in: path required: true schema: { type: 
integer, format: int64 } requestBody: required: true content: application/json: 
schema: type: object properties: vote_type: { type: string, enum: ["up", 
"down"] } required: [vote_type] responses: '201': { description: "Vote cast 
successfully.", content: { application/json: { schema: { $ref: 
'#/components/schemas/UserWaypointVote' }}}} '409': { description: "User has 
already voted or other conflict." } # Based on [cite: 119] 
/waypoints/{waypoint_id}/tips: get: tags: [User Interaction] summary: List 
short tips for a waypoint (Conceptual) description: Retrieve short tips for a 
specific waypoint. Publicly accessible for moderated tips. operationId: 
listWaypointShortTips security: [] parameters: - name: waypoint_id in: path 
required: true schema: { type: integer, format: int64 } - $ref: 
'#/components/parameters/Lang' - $ref: '#/components/parameters/Offset' - $ref: 
'#/components/parameters/Limit' responses: '200': { description: "A list of 
short tips.", content: { application/json: { schema: { type: array, items: { 
$ref: '#/components/schemas/UserWaypointShortTip' }}}}} post: tags: [User 
Interaction] summary: Add a short tip for a waypoint (Conceptual) description: 
Allows an authenticated user to add a short tip for a waypoint. Requires 
`authenticated_user` role. [cite: 103] operationId: createWaypointShortTip 
parameters: - name: waypoint_id in: path required: true schema: { type: 
integer, format: int64 } requestBody: required: true content: application/json: 
schema: $ref: '#/components/schemas/UserWaypointShortTipCreate' responses: 
'201': { description: "Tip added successfully, pending moderation.", content: { 
application/json: { schema: { $ref: '#/components/schemas/UserWaypointShortTip' 
}}}} /accommodations/{accommodation_waypoint_id}/reviews: get: tags: [User 
Interaction] summary: List reviews for an accommodation (Conceptual) 
description: Retrieve reviews for a specific accommodation. Publicly accessible 
for moderated reviews. operationId: listAccommodationReviews security: [] 
parameters: - name: accommodation_waypoint_id # Assuming accommodation is a 
type of waypoint [cite: 682] in: path required: true schema: { type: integer, 
format: int64 } - $ref: '#/components/parameters/Lang' - $ref: 
'#/components/parameters/Offset' - $ref: '#/components/parameters/Limit' 
responses: '200': { description: "A list of reviews.", content: { 
application/json: { schema: { type: array, items: { $ref: 
'#/components/schemas/AccommodationReview' }}}}} post: tags: [User Interaction] 
summary: Add a review for an accommodation (Conceptual) description: Allows an 
authenticated user to add a review for an accommodation. Requires 
`authenticated_user` role. [cite: 103] operationId: createAccommodationReview 
parameters: - name: accommodation_waypoint_id in: path required: true schema: { 
type: integer, format: int64 } requestBody: required: true content: 
application/json: schema: $ref: 
'#/components/schemas/AccommodationReviewCreate' responses: '201': { 
description: "Review added successfully, pending moderation.", content: { 
application/json: { schema: { $ref: '#/components/schemas/AccommodationReview' 
}}}} # Module 7: Curated Itineraries /curated_itineraries: get: tags: [Curated 
Itineraries] summary: List curated itineraries (Conceptual) description: 
Retrieve a list of curated itineraries. Publicly accessible for published ones. 
operationId: listCuratedItineraries security: [] parameters: [$ref: 
'#/components/parameters/Lang', $ref: '#/components/parameters/Offset', $ref: 
'#/components/parameters/Limit'] responses: '200': { description: "A list of 
curated itineraries.", content: { application/json: { schema: { type: array, 
items: { $ref: '#/components/schemas/CuratedItinerary' }}}}} post: tags: 
[Curated Itineraries] summary: Create a curated itinerary (Conceptual) 
description: Create a new curated itinerary. Requires admin role. operationId: 
createCuratedItinerary requestBody: { required: true, content: { 
application/json: { schema: { $ref: 
'#/components/schemas/CuratedItineraryCreate' }}}} responses: '201': { 
description: "Itinerary created.", content: { application/json: { schema: { 
$ref: '#/components/schemas/CuratedItinerary' }}}} # Module 8: Platform Content 
/articles: get: tags: [Platform Content] summary: List articles (Conceptual) 
description: Retrieve a list of articles. Publicly accessible for published 
ones. operationId: listArticles security: [] parameters: [$ref: 
'#/components/parameters/Lang', $ref: '#/components/parameters/Offset', $ref: 
'#/components/parameters/Limit'] responses: '200': { description: "A list of 
articles.", content: { application/json: { schema: { type: array, items: { 
$ref: '#/components/schemas/Article' }}}}} post: tags: [Platform Content] 
summary: Create an article (Conceptual) description: Create a new article. 
Requires admin/manager role. [cite: 103] operationId: createArticle 
requestBody: { required: true, content: { application/json: { schema: { $ref: 
'#/components/schemas/ArticleCreate' }}}} responses: '201': { description: 
"Article created.", content: { application/json: { schema: { $ref: 
'#/components/schemas/Article' }}}} ``` ### Quick-Start Examples 1. Get Current 
User's Profile (with Italian translation for role details) - `curl -X GET 
"https://api.viadifrancesco.example.com/v1/profiles/me?include=role_details&lang
=it" -H "Authorization: Bearer <YOUR_JWT_TOKEN>"` - Sample JSON Response: JSON 
``` { "id": "123e4567-e89b-12d3-a456-426614174000", "username": 
"pellegrino_verdi", "full_name": "Giuseppe Verdi", "public_display_name": "G. 
Verdi", "public_avatar_media_id": "a1b2c3d4-e5f6-7890-1234-567890abcdef", 
"public_bio": "Appassionato della Via di Francesco, in cammino verso la pace 
interiore.", "preferred_language_code": "it", "preferred_units_of_measure": 
"metric", "pilgrim_experience_level": "experienced_many_pilgrimages", 
"pilgrimage_interests_tags": ["spiritualità", "natura", "storia_francescana"], 
"is_profile_publicly_visible": true, "account_status": "active", "roles": 
["pilgrim_user", "regional_content_manager"], "public_avatar": null, // 
Assuming not requested or no avatar set "role_details": [ { "role_code": 
"pilgrim_user", "default_display_name": "Utente Pellegrino", // Translated 
[cite: 834] "icon_identifier": "person", "is_role_active": true }, { 
"role_code": "regional_content_manager", "default_display_name": "Manager 
Contenuti Regionali", // Translated "icon_identifier": "edit_location", 
"is_role_active": true } ], "last_activity_at": "2025-05-18T10:30:00Z", 
"created_at": "2023-03-15T09:00:00Z", "updated_at": "2025-05-17T14:20:00Z", 
"updated_by_profile_id": null } ``` 2. List Active Waypoint Categories (default 
language - English) - `curl -X GET 
"https://api.viadifrancesco.example.com/v1/waypoint_categories?sort_by=label"` 
- Sample JSON Response: JSON ``` [ { "id": 1, "code": "accommodation_location", 
"label": "Accommodation", "description": "Places to stay for pilgrims.", 
"icon_identifier": "icon-bed", "requires_detail_table": "accommodations", 
"sort_order": 10, "is_active": true }, { "id": 2, "code": "attraction", 
"label": "Attraction", // Default (English) [cite: 8] "description": "Sites of 
interest, including religious, historical, natural.", "icon_identifier": 
"icon-camera", "requires_detail_table": "attractions_details", "sort_order": 
20, "is_active": true }, { "id": 3, "code": "food_water_source", "label": "Food 
& Water Source", "description": "Locations to find food and drinkable water.", 
"icon_identifier": "icon-restaurant", "requires_detail_table": 
"food_water_sources_details", "sort_order": 15, "is_active": true } ] ``` 3. 
Create a New Waypoint (as a Content Manager) - curl -X POST 
"https://api.viadifrancesco.example.com/v1/waypoints?lang=it" -H 
"Authorization: Bearer <YOUR_JWT_TOKEN>" -H "Content-Type: application/json" -d 
'{ "name": "Fonte Sacra di San Francesco", "waypoint_primary_category_id": 4, 
"geom": { "type": "Point", "coordinates": [12.6789, 43.1234, 550] }, 
"content_visibility_status_id": 1, "description": "Antica fonte dove la 
tradizione vuole che San Francesco si sia fermato a bere.", "is_seasonal": 
false, "is_trail_access_point": true, "is_significant_trail_junction": false, 
"is_franciscan_highlight_site": true, "is_significant_pilgrim_poi": true, 
"town_id": 101 }' (Assuming waypoint_primary_category_id: 4 is "Water Source" 
and content_visibility_status_id: 1 is "Draft", town_id: 101 is "Assisi") - 
Sample JSON Response (201 Created): JSON ``` { "id": 578, "name": "Fonte Sacra 
di San Francesco", // Returned in Italian as per lang=it on request for 
translatable fields "slug": "fonte-sacra-di-san-francesco", // System generated 
slug "alternate_names_primary_lang": null, "waypoint_primary_category_id": 4, 
"waypoint_subcategory_tag_ids": null, "description": "Antica fonte dove la 
tradizione vuole che San Francesco si sia fermato a bere.", "geom": { "type": 
"Point", "coordinates": [12.6789, 43.1234, 550] }, "latitude": 43.1234, 
"longitude": 12.6789, "elevation_meters": 550, "town_id": 101, 
"parent_waypoint_id": null, "address_text": null, "primary_image_media_id": 
null, "primary_thumbnail_media_id": null, "content_visibility_status_id": 1, 
"is_seasonal": false, "is_trail_access_point": true, 
"is_significant_trail_junction": false, "is_franciscan_highlight_site": true, 
"is_significant_pilgrim_poi": true, "short_narrative_for_dynamic_lists": null, 
"waypoint_accessibility_notes": null, "general_tags_text": null, 
"primary_data_source_waypoint": null, "quality_score": null, "created_at": 
"2025-05-18T18:15:00Z", "created_by_profile_id": 
"regional_manager_profile_uuid", // Set by system "updated_at": 
"2025-05-18T18:15:00Z", "updated_by_profile_id": 
"regional_manager_profile_uuid", // Set by system "deleted_at": null } ``` ### 
Implementation Notes - SQL Views / Indexes: - Localized Views: The provided 
`v_waypoint_categories_localized` and `v_tags_localized` views are excellent 
for API performance when fetching translated master data labels and 
descriptions. The API should leverage these by querying the view and extracting 
the specific language from the `all_translations` JSONB field based on the 
`lang` parameter, or use the primary language fields directly. - Indexes on 
Translatable Fields in Master Tables: For `waypoint_categories_master` and 
`tags_master`, indexes on `label` (e.g., `idx_wc_master_label`, 
`idx_tags_master_label`) are recommended if sorting by translated label 
(fetched from the `translations` table or the view's primary label column) 
becomes frequent and needs to be performed at the DB level before 
language-specific extraction. - Indexes for `translations` table: The 
`idx_translations_lookup` on `(table_identifier, column_identifier, 
row_foreign_key, language_code, translation_status)` is crucial for efficient 
lookups. - Indexes for `waypoints` table: - `idx_waypoints_geom` (GIST) for 
spatial queries. - `idx_waypoints_content_visibility_status_id` for filtering 
by publication status. - `idx_waypoints_waypoint_primary_category_id` for 
filtering by category. - `idx_waypoints_town_id` for filtering by town. - 
`idx_waypoints_subcategory_tag_ids` (GIN) for filtering by tags. - 
`idx_waypoints_name_trgm` (GIN with `pg_trgm`) for text search on name. - 
Indexes for `profiles` table: `idx_profiles_roles` (GIN), 
`idx_profiles_account_status`, `idx_profiles_last_activity_at`. - Indexes for 
Audit FKs: All `created_by_profile_id` and `updated_by_profile_id` foreign key 
columns should be indexed. - Endpoints Likely to Need Pagination, Caching, or 
Materialized Views: - Pagination: - `GET /waypoints` - `GET /trails`, 
`/routes`, `/segments` (Conceptual) - `GET /articles` (Conceptual) - `GET 
/curated_itineraries` (Conceptual) - `GET /segment_warnings` (Conceptual) - 
`GET /waypoints/{waypoint_id}/tips` (Conceptual) - `GET 
/accommodations/{accommodation_waypoint_id}/reviews` (Conceptual) - All list 
endpoints for master data (`/languages`, `/user_roles`, `/waypoint_categories`, 
`/tags`, `/content_statuses`, `/regions`, `/towns`) should support pagination, 
although the total number of items might be small for some. - Caching 
(Application-level or CDN): - `GET /languages` - `GET /user_roles` - `GET 
/waypoint_categories` - `GET /tags` - `GET /content_statuses` - Responses for 
specific media items (`GET /media/{media_id}`) especially if they don't change 
often. - Published `GET /articles/{article_id}` (Conceptual) - Materialized 
Views (Potential DB-level optimization if views are complex and data doesn't 
change too frequently): - The existing `v_waypoint_categories_localized` and 
`v_tags_localized` are standard views. If performance becomes an issue due to 
joins with a very large `translations` table, they could be candidates for 
materialization with a defined refresh strategy. - Any complex aggregation 
views (e.g., `accommodations_capacity_summary_view` mentioned in ) might also 
be candidates. - Schema Feedback: - 🟢 Schema OK. The provided database 
specifications for Module 1 (User & Content Infrastructure) and Module 4 master 
tables (`waypoint_categories_master`, `tags_master`, `content_statuses_master`, 
and `waypoints`) appear robust, well-normalized, and production-ready for V1 
API needs. - The extensive use of foreign keys, clear data types, audit 
columns, `is_active` flags for master data lifecycle, and soft delete 
(`deleted_at`) patterns are good practices. - The strategy for translations 
using a central `translations` table and localized views is solid. - The 
definition of array foreign key integrity to be enforced by database triggers 
(e.g., for `waypoints.waypoint_subcategory_tag_ids` referencing `tags_master` ) 
is crucial and must be implemented. - RLS helper functions like 
`public.has_role(TEXT)` are essential for the security model and assumed to be 
implemented correctly. - The synchronization of `profiles.roles` to 
`auth.users.raw_app_meta_data.roles` via triggers for JWT inclusion is a key 
aspect of the authentication architecture. 
