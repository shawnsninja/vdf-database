# 4b.0.4 - API Contract - Attractions

  https://gemini.google.com/u/1/app/3ccfcacc8925c6f9 ### OpenAPI 3.1 Spec (for 
Module Attractions) YAML ``` openapi: 3.1.0 info: title: Via di Francesco - 
Module 4b: Attractions API version: "v1.0.0" description: API endpoints for 
managing and retrieving attraction details, including religious service 
schedules and related master data. Primary language for fields is English; 
other translations are provided in a 'translations' object. servers: - url: 
https://<YOUR_SUPABASE_PROJECT_REF>.supabase.co/rest/v1 description: Production 
Server (Replace with your actual Supabase project reference) tags: - name: 
Attractions description: Operations related to attraction details and their 
religious service schedules. - name: MasterDataAttractions description: 
Read-only access to master data related to attractions (e.g., types, 
amenities). components: securitySchemes: bearerAuth: type: http scheme: bearer 
bearerFormat: JWT description: Supabase JWT Access Token. apiKeyAuth: type: 
apiKey in: header name: apikey description: Supabase anonymous public key. 
parameters: WaypointIdPath: name: waypoint_id in: path required: true 
description: The unique identifier of the parent waypoint. schema: type: 
integer format: int64 ScheduleIdPath: name: schedule_id in: path required: true 
description: The unique identifier of the religious service schedule. schema: 
type: integer format: int64 TypeIdPath: # For master data by ID name: type_id 
in: path required: true description: The unique identifier of the master data 
type. schema: type: integer AmenityIdPath: # For master data by ID name: 
amenity_id in: path required: true description: The unique identifier of the 
visitor amenity. schema: type: integer LangQueryParam: name: lang in: query 
description: ISO 639-1 language code. If provided, the API may attempt to 
return the main field in this language if available, otherwise, it defaults to 
the primary reference language (English). The 'translations' object will 
contain other available translations. required: false schema: type: string 
pattern: '^[a-z]{2}(-[A-Z]{2})?$' example: "it" PageQueryParam: name: page in: 
query description: Page number for pagination. required: false schema: type: 
integer minimum: 1 default: 1 PageSizeQueryParam: name: page_size in: query 
description: Number of items per page. required: false schema: type: integer 
minimum: 1 maximum: 100 default: 20 schemas: ErrorResponse: type: object 
properties: message: type: string description: A human-readable summary of the 
error. details: type: string nullable: true description: More specific details. 
hint: type: string nullable: true description: Hint on how to solve it. code: 
type: string description: Error code slug. required: - message - code 
Pagination: type: object properties: total_items: type: integer description: 
Total number of items available. total_pages: type: integer description: Total 
number of pages. current_page: type: integer description: Current page number. 
page_size: type: integer description: Number of items per page. 
AttractionTypeMaster: title: AttractionTypeMaster description: Master list of 
attraction types (e.g., church, museum). type: object properties: id: type: 
integer readOnly: true code: type: string description: Unique, machine-readable 
code (e.g., 'church'). label: # Stores primary reference language (English) 
type: string description: Human-readable label in the primary reference 
language (English). translations: # language_code -> text (for label) type: 
object additionalProperties: type: string nullable: true description: 
Translations for the 'label' field. Example: {"it": "Chiesa"} description: # 
Stores primary reference language (English) type: string nullable: true 
description: Optional description in the primary reference language (English). 
description_translations: # language_code -> text (for description) type: 
object additionalProperties: type: string nullable: true description: 
Translations for the 'description' field. icon_identifier: type: string 
nullable: true description: Identifier for a UI icon. sort_order: type: integer 
default: 0 is_active: type: boolean default: true readOnly: true 
VisitorAmenityMaster: title: VisitorAmenityMaster description: Master list of 
on-site amenities for visitors. type: object properties: id: type: integer 
readOnly: true code: type: string label: type: string description: Label in 
primary reference language (English). translations: type: object 
additionalProperties: type: string nullable: true description: type: string 
nullable: true description: Description in primary reference language 
(English). description_translations: type: object additionalProperties: type: 
string nullable: true icon_identifier: type: string nullable: true is_active: 
type: boolean default: true readOnly: true ReligiousServiceTypeMaster: title: 
ReligiousServiceTypeMaster description: Master list of religious service types. 
type: object properties: id: type: integer readOnly: true code: type: string 
label: type: string description: Label in primary reference language (English). 
translations: type: object additionalProperties: type: string nullable: true 
description: type: string nullable: true description: Description in primary 
reference language (English). description_translations: type: object 
additionalProperties: type: string nullable: true icon_identifier: type: string 
nullable: true sort_order: type: integer default: 0 is_active: type: boolean 
default: true readOnly: true AttractionDetailBase: # Base for request bodies 
and part of response title: AttractionDetailBase description: Base schema for 
attraction details. Fields store primary reference language (English). type: 
object properties: attraction_type_id: type: integer description: FK to 
attraction_types_master.id. detailed_description: type: string nullable: true 
description: In-depth description in primary reference language (English). 
detailed_description_translations: type: object additionalProperties: { type: 
string } nullable: true description: Key-value pairs of language_code to 
translated detailed_description. historical_significance_notes: type: string 
nullable: true historical_significance_notes_translations: type: object 
additionalProperties: { type: string } nullable: true 
cultural_significance_notes: type: string nullable: true 
cultural_significance_notes_translations: type: object additionalProperties: { 
type: string } nullable: true spiritual_significance_notes: type: string 
nullable: true spiritual_significance_notes_translations: type: object 
additionalProperties: { type: string } nullable: true 
associated_historical_figures_text: # Array elements are in primary reference 
language (English) type: array items: { type: string } nullable: true # 
associated_historical_figures_text_translations would be complex (array of 
objects or similar) # and typically handled by specific translation UI/logic if 
each element needs translation. # For the API, providing the English array and 
letting clients handle element translation lookup if needed is simpler. 
key_historical_events_notes: type: string nullable: true 
key_historical_events_notes_translations: type: object additionalProperties: { 
type: string } nullable: true opening_hours_structured: type: object # Adheres 
to a centrally defined JSON schema nullable: true additionalProperties: true 
description: "Example: {\"monday\": [{\"opens\": \"09:00\", \"closes\": 
\"18:00\"}]}" opening_hours_text_notes: type: string nullable: true 
opening_hours_text_notes_translations: type: object additionalProperties: { 
type: string } nullable: true entry_fee_details: type: string nullable: true 
entry_fee_details_translations: type: object additionalProperties: { type: 
string } nullable: true guided_tours_info: type: string nullable: true 
guided_tours_info_translations: type: object additionalProperties: { type: 
string } nullable: true audio_guides_info: type: string nullable: true 
audio_guides_info_translations: type: object additionalProperties: { type: 
string } nullable: true photography_allowed_notes: type: string nullable: true 
photography_allowed_notes_translations: type: object additionalProperties: { 
type: string } nullable: true accessibility_details_specific: type: string 
nullable: true accessibility_details_specific_translations: type: object 
additionalProperties: { type: string } nullable: true visitor_amenity_ids: # 
Array of FKs to visitor_amenities_master type: array items: { type: integer } 
nullable: true opening_hours_last_verified_at: type: string format: date-time 
nullable: true data_last_verified_at: type: string format: date-time nullable: 
true AttractionDetailResponse: # For GET response, includes expanded objects 
title: AttractionDetailResponse allOf: - $ref: 
'#/components/schemas/AttractionDetailBase' - type: object properties: 
waypoint_id: type: integer format: int64 readOnly: true attraction_type: # 
Expanded from attraction_type_id for GET response $ref: 
'#/components/schemas/AttractionTypeMaster' visitor_amenities: # Expanded from 
visitor_amenity_ids for GET response type: array items: $ref: 
'#/components/schemas/VisitorAmenityMaster' media_gallery: type: array items: 
$ref: '#/components/schemas/AttractionDetailsMediaItemResponse' 
religious_services: # List of religious services for this attraction type: 
array items: $ref: '#/components/schemas/ReligiousServiceScheduleResponse' 
created_at: { type: string, format: date-time, readOnly: true } updated_at: { 
type: string, format: date-time, readOnly: true } created_by_profile_id: { 
type: string, format: uuid, readOnly: true, nullable: true } 
updated_by_profile_id: { type: string, format: uuid, readOnly: true, nullable: 
true } AttractionDetailUpdate: # Schema for PATCH request body (only updatable 
fields) title: AttractionDetailUpdate description: Fields for updating 
attraction details. All fields are optional for PATCH. type: object properties: 
attraction_type_id: { type: integer } detailed_description: { type: string, 
nullable: true } # For PATCH, translations would be updated separately if 
needed, or the main field update implies primary lang change 
historical_significance_notes: { type: string, nullable: true } 
opening_hours_structured: { type: object, nullable: true, additionalProperties: 
true } entry_fee_details: { type: string, nullable: true } visitor_amenity_ids: 
{ type: array, items: { type: integer }, nullable: true } 
opening_hours_last_verified_at: { type: string, format: "date-time", nullable: 
true } data_last_verified_at: { type: string, format: "date-time", nullable: 
true } ReligiousServiceScheduleBase: title: ReligiousServiceScheduleBase type: 
object properties: service_type_id: # FK to religious_service_types_master 
type: integer schedule_description_text: # Primary reference language (English) 
type: string schedule_description_text_translations: type: object 
additionalProperties: { type: string } nullable: true days_of_week: type: array 
items: type: string enum: [monday, tuesday, wednesday, thursday, friday, 
saturday, sunday] nullable: true time_of_day: # HH:MM:SS type: string format: 
time nullable: true language_code: # Primary language of the service itself, FK 
to languages_master type: string pattern: '^[a-z]{2}$' nullable: true 
language_notes: # Primary reference language (English) type: string nullable: 
true language_notes_translations: type: object additionalProperties: { type: 
string } nullable: true location_within_site_notes: # Primary reference 
language (English) type: string nullable: true 
location_within_site_notes_translations: type: object additionalProperties: { 
type: string } nullable: true seasonal_validity_notes: # Primary reference 
language (English) type: string nullable: true 
seasonal_validity_notes_translations: type: object additionalProperties: { 
type: string } nullable: true is_pilgrim_specific_service: type: boolean 
default: false service_notes: # Primary reference language (English) type: 
string nullable: true service_notes_translations: type: object 
additionalProperties: { type: string } nullable: true data_last_verified_at: 
type: string format: date-time nullable: true ReligiousServiceScheduleResponse: 
# For GET response title: ReligiousServiceScheduleResponse allOf: - $ref: 
'#/components/schemas/ReligiousServiceScheduleBase' - type: object properties: 
id: { type: integer, format: int64, readOnly: true } attraction_waypoint_id: { 
type: integer, format: int64, readOnly: true } service_type: # Expanded from 
service_type_id $ref: '#/components/schemas/ReligiousServiceTypeMaster' 
language: # Expanded from language_code if present type: object # Based on 
languages_master nullable: true properties: code: { type: string } name: { 
type: string } # Name in requested lang or primary native_name: { type: string 
} translations: { type: object, additionalProperties: { type: string }, 
nullable: true } # For language name itself created_at: { type: string, format: 
date-time, readOnly: true } updated_at: { type: string, format: date-time, 
readOnly: true } ReligiousServiceScheduleCreate: # For POST request body title: 
ReligiousServiceScheduleCreate allOf: - $ref: 
'#/components/schemas/ReligiousServiceScheduleBase' required: # Assuming these 
are minimal for creation - service_type_id - schedule_description_text 
PaginatedAttractionDetailsList: # This is not directly used for a single 
attraction's detail. Placeholder for if needed. type: object properties: data: 
type: array items: $ref: '#/components/schemas/AttractionDetailResponse' 
pagination: $ref: '#/components/schemas/Pagination' 
PaginatedReligiousServiceSchedulesList: type: object properties: data: type: 
array items: $ref: '#/components/schemas/ReligiousServiceScheduleResponse' 
pagination: $ref: '#/components/schemas/Pagination' AttractionDetailsMediaItem: 
# Base for create/update media link for an attraction type: object properties: 
media_id: { type: string, format: uuid, description: "ID of the media item from 
public.media" } media_role_code: { type: string, description: "Role of the 
media, FK to public.media_roles_master.code" } display_order: { type: integer, 
default: 0 } caption_override: { type: string, nullable: true, description: 
"Caption in primary reference language (English)." } 
caption_override_translations: { type: object, additionalProperties: {type: 
string}, nullable: true } alt_text_override: { type: string, nullable: true, 
description: "Alt text in primary reference language (English)." } 
alt_text_override_translations: { type: object, additionalProperties: {type: 
string}, nullable: true } required: - media_id - media_role_code 
AttractionDetailsMediaItemResponse: # For GET response of a media link allOf: - 
$ref: '#/components/schemas/AttractionDetailsMediaItem' - type: object 
properties: id: { type: integer, format: int64, readOnly: true, description: 
"ID of the attraction_details_media link record." } attraction_waypoint_id: { 
type: integer, format: int64, readOnly: true } media_item_summary: # Simplified 
summary of the linked media item from public.media type: object readOnly: true 
properties: file_name_original: { type: string } image_variants_json: { type: 
object, nullable: true } created_at: { type: string, format: "date-time", 
readOnly: true } updated_at: { type: string, format: "date-time", readOnly: 
true } security: - bearerAuth: [] - apiKeyAuth: [] paths: 
/waypoints/{waypoint_id}/attraction_details: get: tags: [Attractions] summary: 
Get attraction details for a waypoint description: | Retrieves specific 
attraction details for a given waypoint. The primary language for main text 
fields is English. Translations are provided in the 'translations' sibling 
object if available. The `lang` query parameter can be used to request a 
specific language; the backend may use this to populate main fields directly if 
a translation exists, or the client can parse the 'translations' object. # 
Optimized by `public.v_waypoint_attraction_details_localized` view. 
operationId: getAttractionDetails parameters: - $ref: 
'#/components/parameters/WaypointIdPath' - $ref: 
'#/components/parameters/LangQueryParam' responses: '200': description: 
Successful retrieval of attraction details. content: application/json: schema: 
$ref: '#/components/schemas/AttractionDetailResponse' '401': $ref: 
'#/components/responses/UnauthorizedError' '403': $ref: 
'#/components/responses/ForbiddenError' '404': $ref: 
'#/components/responses/NotFoundError' patch: tags: [Attractions] summary: 
Update attraction details for a waypoint (Exemplar Write) description: 
Partially updates attraction-specific details. Requires 
'regional_content_manager' or 'platform_admin' role. operationId: 
updateAttractionDetails parameters: - $ref: 
'#/components/parameters/WaypointIdPath' requestBody: required: true content: 
application/json: schema: $ref: '#/components/schemas/AttractionDetailUpdate' # 
Contains only updatable fields responses: '200': description: Attraction 
details updated successfully. Returns the full updated resource. content: 
application/json: schema: $ref: '#/components/schemas/AttractionDetailResponse' 
'400': $ref: '#/components/responses/BadRequestError' '401': $ref: 
'#/components/responses/UnauthorizedError' '403': $ref: 
'#/components/responses/ForbiddenError' '404': $ref: 
'#/components/responses/NotFoundError' '422': $ref: 
'#/components/responses/UnprocessableEntityError' 
/waypoints/{waypoint_id}/attraction_details/religious_service_schedules: get: 
tags: [Attractions] summary: List religious service schedules for an attraction 
description: Retrieves a list of religious service schedules associated with a 
specific attraction. operationId: listReligiousServiceSchedules parameters: - 
$ref: '#/components/parameters/WaypointIdPath' - $ref: 
'#/components/parameters/LangQueryParam' - $ref: 
'#/components/parameters/PageQueryParam' - $ref: 
'#/components/parameters/PageSizeQueryParam' responses: '200': description: A 
list of religious service schedules. content: application/json: schema: $ref: 
'#/components/schemas/PaginatedReligiousServiceSchedulesList' '401': $ref: 
'#/components/responses/UnauthorizedError' '403': $ref: 
'#/components/responses/ForbiddenError' '404': $ref: 
'#/components/responses/NotFoundError' post: tags: [Attractions] summary: 
Create a religious service schedule (Exemplar Write) description: Adds a new 
religious service schedule to an attraction. Requires 
'regional_content_manager' or 'platform_admin' role. operationId: 
createReligiousServiceSchedule parameters: - $ref: 
'#/components/parameters/WaypointIdPath' requestBody: required: true content: 
application/json: schema: $ref: 
'#/components/schemas/ReligiousServiceScheduleCreate' responses: '201': 
description: Religious service schedule created successfully. content: 
application/json: schema: $ref: 
'#/components/schemas/ReligiousServiceScheduleResponse' '400': $ref: 
'#/components/responses/BadRequestError' '401': $ref: 
'#/components/responses/UnauthorizedError' '403': $ref: 
'#/components/responses/ForbiddenError' '404': $ref: 
'#/components/responses/NotFoundError' # If waypoint/attraction_detail doesn't 
exist '422': $ref: '#/components/responses/UnprocessableEntityError' 
/waypoints/{waypoint_id}/attraction_details/religious_service_schedules/{schedul
e_id}: get: tags: [Attractions] summary: Get a specific religious service 
schedule operationId: getReligiousServiceScheduleById parameters: - $ref: 
'#/components/parameters/WaypointIdPath' - $ref: 
'#/components/parameters/ScheduleIdPath' - $ref: 
'#/components/parameters/LangQueryParam' responses: '200': description: Details 
of the religious service schedule. content: application/json: schema: $ref: 
'#/components/schemas/ReligiousServiceScheduleResponse' '404': $ref: 
'#/components/responses/NotFoundError' patch: tags: [Attractions] summary: 
Update a specific religious service schedule operationId: 
updateReligiousServiceSchedule parameters: - $ref: 
'#/components/parameters/WaypointIdPath' - $ref: 
'#/components/parameters/ScheduleIdPath' requestBody: required: true content: 
application/json: schema: # Similar to create, but all fields optional for 
PATCH $ref: '#/components/schemas/ReligiousServiceScheduleCreate' responses: 
'200': description: Religious service schedule updated successfully. content: 
application/json: schema: $ref: 
'#/components/schemas/ReligiousServiceScheduleResponse' '404': $ref: 
'#/components/responses/NotFoundError' delete: tags: [Attractions] summary: 
Delete a specific religious service schedule operationId: 
deleteReligiousServiceSchedule parameters: - $ref: 
'#/components/parameters/WaypointIdPath' - $ref: 
'#/components/parameters/ScheduleIdPath' responses: '204': description: 
Religious service schedule deleted successfully. '404': $ref: 
'#/components/responses/NotFoundError' # Master Data Endpoints for Attractions 
Module /master/attraction_types: get: tags: [MasterDataAttractions] summary: 
List attraction types operationId: listAttractionTypes parameters: - $ref: 
'#/components/parameters/LangQueryParam' - $ref: 
'#/components/parameters/PageQueryParam' - $ref: 
'#/components/parameters/PageSizeQueryParam' responses: '200': description: A 
list of attraction types. content: application/json: schema: type: object 
properties: data: type: array items: $ref: 
'#/components/schemas/AttractionTypeMaster' pagination: $ref: 
'#/components/schemas/Pagination' /master/attraction_types/{type_id}: get: 
tags: [MasterDataAttractions] summary: Get attraction type by ID operationId: 
getAttractionTypeById parameters: - $ref: '#/components/parameters/TypeIdPath' 
- $ref: '#/components/parameters/LangQueryParam' responses: '200': description: 
Details of the attraction type. content: application/json: schema: $ref: 
'#/components/schemas/AttractionTypeMaster' '404': $ref: 
'#/components/responses/NotFoundError' /master/visitor_amenities: get: tags: 
[MasterDataAttractions] summary: List visitor amenities operationId: 
listVisitorAmenities parameters: - $ref: 
'#/components/parameters/LangQueryParam' - $ref: 
'#/components/parameters/PageQueryParam' - $ref: 
'#/components/parameters/PageSizeQueryParam' responses: '200': description: A 
list of visitor amenities. content: application/json: schema: type: object 
properties: data: type: array items: $ref: 
'#/components/schemas/VisitorAmenityMaster' pagination: $ref: 
'#/components/schemas/Pagination' /master/visitor_amenities/{amenity_id}: get: 
tags: [MasterDataAttractions] summary: Get visitor amenity by ID operationId: 
getVisitorAmenityById parameters: - $ref: 
'#/components/parameters/AmenityIdPath' - $ref: 
'#/components/parameters/LangQueryParam' responses: '200': description: Details 
of the visitor amenity. content: application/json: schema: $ref: 
'#/components/schemas/VisitorAmenityMaster' '404': $ref: 
'#/components/responses/NotFoundError' /master/religious_service_types: get: 
tags: [MasterDataAttractions] summary: List religious service types 
operationId: listReligiousServiceTypes parameters: - $ref: 
'#/components/parameters/LangQueryParam' - $ref: 
'#/components/parameters/PageQueryParam' - $ref: 
'#/components/parameters/PageSizeQueryParam' responses: '200': description: A 
list of religious service types. content: application/json: schema: type: 
object properties: data: type: array items: $ref: 
'#/components/schemas/ReligiousServiceTypeMaster' pagination: $ref: 
'#/components/schemas/Pagination' /master/religious_service_types/{type_id}: 
get: tags: [MasterDataAttractions] summary: Get religious service type by ID 
operationId: getReligiousServiceTypeById parameters: - $ref: 
'#/components/parameters/TypeIdPath' - $ref: 
'#/components/parameters/LangQueryParam' responses: '200': description: Details 
of the religious service type. content: application/json: schema: $ref: 
'#/components/schemas/ReligiousServiceTypeMaster' '404': $ref: 
'#/components/responses/NotFoundError' ``` ### Quick-Start Examples 1. Get 
Attraction Details for a Waypoint (Italian) *Curl Request:* Bash ``` curl -X 
GET\ 
'https://<YOUR_SUPABASE_PROJECT_REF>.supabase.co/rest/v1/waypoints/101/attractio
n_details?lang=it'\ -H "apikey: <YOUR_SUPABASE_ANON_KEY>"\ -H "Authorization: 
Bearer <YOUR_USER_JWT>" ``` *Sample JSON Response:* JSON ``` { "waypoint_id": 
101, "attraction_type_id": 1, "detailed_description": "Una bellissima chiesa 
storica con affreschi notevoli...", // Main field shows Italian due to lang=it 
"detailed_description_translations": { // Other available translations "en": "A 
beautiful historic church with notable frescoes...", "de": "Eine wunderschöne 
historische Kirche mit bemerkenswerten Fresken..." }, 
"opening_hours_structured": { "default_hours": "09:00-17:00" }, 
"visitor_amenity_ids": [1, 3], "attraction_type": { "id": 1, "code": "church", 
"label": "Chiesa", // Italian label "translations": { "en": "Church", "de": 
"Kirche" }, "icon_identifier": "icon-church", "is_active": true }, 
"visitor_amenities": [ { "id": 1, "code": "toilets", "label": "Bagni", 
"translations": { "en": "Toilets" }, "is_active": true }, { "id": 3, "code": 
"gift_shop", "label": "Negozio di Souvenir", "translations": { "en": "Gift 
Shop" }, "is_active": true } ], "media_gallery": [], "religious_services": [], 
"created_at": "2024-01-10T10:00:00Z", "updated_at": "2024-05-15T14:30:00Z" } 
``` 2. List Religious Service Schedules for an Attraction (Paginated, default 
English) *Curl Request:* Bash ``` curl -X GET\ 
'https://<YOUR_SUPABASE_PROJECT_REF>.supabase.co/rest/v1/waypoints/101/attractio
n_details/religious_service_schedules?page=1&page_size=2'\ -H "apikey: 
<YOUR_SUPABASE_ANON_KEY>"\ -H "Authorization: Bearer <YOUR_USER_JWT>" ``` 
*Sample JSON Response:* JSON ``` { "data": [ { "id": 1, 
"attraction_waypoint_id": 101, "service_type_id": 1, 
"schedule_description_text": "Weekday Mass at 6:00 PM", // English 
"schedule_description_text_translations": {"it": "Messa feriale alle 18:00"}, 
"days_of_week": ["monday", "tuesday", "wednesday", "thursday", "friday"], 
"time_of_day": "18:00:00", "language_code": "it", "service_type": { "id": 1, 
"code": "mass", "label": "Mass", "translations": {"it": "Messa"}, "is_active": 
true } } ], "pagination": { "total_items": 1, "total_pages": 1, "current_page": 
1, "page_size": 2 } } ``` 3. Create a Religious Service Schedule for an 
Attraction (Exemplar Write) *Curl Request:* Bash ``` curl -X POST\ 
'https://<YOUR_SUPABASE_PROJECT_REF>.supabase.co/rest/v1/waypoints/101/attractio
n_details/religious_service_schedules'\ -H "apikey: <YOUR_SUPABASE_ANON_KEY>"\ 
-H "Authorization: Bearer <YOUR_ADMIN_OR_MANAGER_JWT>"\ -H "Content-Type: 
application/json"\ -H "Prefer: return=representation"\ -d '{ "service_type_id": 
2, "schedule_description_text": "Sunday Vespers at 5:00 PM", 
"schedule_description_text_translations": { "it": "Vespri domenicali alle 
17:00" }, "days_of_week": ["sunday"], "time_of_day": "17:00:00", 
"language_code": "la", "is_pilgrim_specific_service": false }' ``` *Sample JSON 
Response (showing the created resource):* JSON ``` { "id": 2, 
"attraction_waypoint_id": 101, "service_type_id": 2, 
"schedule_description_text": "Sunday Vespers at 5:00 PM", 
"schedule_description_text_translations": { "it": "Vespri domenicali alle 
17:00" }, "days_of_week": ["sunday"], "time_of_day": "17:00:00", 
"language_code": "la", "is_pilgrim_specific_service": false, "service_type": { 
"id": 2, "code": "vespers", "label": "Vespers", "translations": {"it": 
"Vespri"}, "is_active": true }, "created_at": "2025-05-18T19:30:00Z", 
"updated_at": "2025-05-18T19:30:00Z" // ... other fields } ``` ### 
Implementation Notes - 🟢 Schema OK. The database schemas for Module 4b 
Attractions (`attractions_details`, `religious_service_schedules`, 
`attraction_types_master`, `visitor_amenities_master`, 
`religious_service_types_master`, `attraction_details_media`), as detailed in 
the provided documents, are well-structured. They correctly store primary 
reference language text in base columns (e.g., `label`, `detailed_description`) 
without `_en` suffixes. This aligns with the updated API translation model. - 
Views for READ Efficiency: - The 
`public.v_waypoint_attraction_details_localized` view is crucial for 
efficiently implementing `GET /waypoints/{waypoint_id}/attraction_details`. It 
pre-joins data and aggregates translations from `public.translations`, allowing 
the backend to easily construct the API response with the primary language 
field and the `translations` object. - Backend logic will need to parse the 
`all_translations` JSONB from the view to populate the `translations` object 
for each specific field in the API response. - Indexes are Critical: - All 
Foreign Key columns require indexes. - GIN indexes on array columns (e.g., 
`attractions_details.visitor_amenity_ids`) and JSONB columns (e.g., 
`attractions_details.opening_hours_structured`) are important for query 
performance where applicable. - The `public.translations` table needs effective 
indexing on `(table_identifier, row_foreign_key, column_identifier, 
language_code)`. - Materialized Views: For high-traffic read scenarios, 
consider making `public.v_waypoint_attraction_details_localized` a Materialized 
View to improve response times, with an appropriate refresh strategy. - 
Translation Logic: The `lang` query parameter informs the backend which 
language to potentially prioritize for the main field in the response. The 
backend should fetch the primary reference language (English) content and all 
available translations (e.g., from the view's `all_translations` field) to 
construct the `field_name` + `translations` object structure. - Data Integrity: 
The database triggers ensuring that FKs point to `is_active: true` master 
records and validating array FK elements are fundamental for API data 
consistency. This refined approach for Module 4b Attractions should now align 
better with your data modeling and API presentation preferences for 
translatable content. 
