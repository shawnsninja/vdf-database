# 7.5 seasons_master

  
https://gemini.google.com/u/1/app/b76d14705d5101f9?is_sa=1&android-min-version=3
01356232&ios-min-version=322.0&campaign_id=bkws&utm_source=google&utm_medium=cpc
&utm_campaign=2024enUS_gemfeb&pt=9008&mt=8&ct=p-growth-sem-bkws 
https://gemini.google.com/u/1/app/42a77d08d7a45bcb * * * * * Production-Ready 
Specification: public.seasons_master Table Version: 2.1 (V2.1 Checklist REV 
05-18-25-A Applied) Date: May 18, 2025 1\. Purpose & Primary Use-Cases Stores 
the definitive list of seasons (e.g., Spring, Summer, Autumn, Winter) that can 
be associated with curated itineraries to indicate optimal times for 
undertaking them. This table supports translatable season names and 
descriptions, allows for consistent filtering and display, and can include 
icons. *Key User-Story Touchpoints:* - Pilgrim (Anna): Enables filtering of 
curated itineraries based on recommended seasons (A7). Helps in planning (A1, 
A2). - Platform Administrator (Admin Team) / Regional Content Manager (Sofia): 
Allows management of available seasons and assignment to itineraries (D2). 2\. 
Schema | Column | Data Type | Constraints | Description (Translatable fields 
marked) | | `id` | `integer` | Primary Key, Generated always as identity | 
Unique identifier for each season. | | `season_code` | `text` | Not Null, 
Unique, `CHECK (char_length(season_code) <= 50 AND season_code = 
upper(season_code) AND season_code ~ '^[A-Z_]+$')` | A stable, machine-readable 
code (e.g., "SPRING"). Max 50 chars. | | `name` | `text` | Not Null, Unique, 
`CHECK (char_length(name) <= 100)` | The display name of the season (Base 
language: English). (Translatable) Max 100 chars. | | `description` | `text` | 
Nullable | A short description of the season or relevant notes (Base language: 
English). (Translatable) | | `icon_identifier` | `text` | Nullable, `CHECK 
(icon_identifier IS NULL OR char_length(icon_identifier) <= 100)` | Optional 
identifier (e.g., CSS class, image name, SVG key) for an icon representing this 
season. | | `sort_order` | `integer` | Not Null, Default `0` | Optional integer 
to control the display order of seasons in UI lists/filters. | | `is_active` | 
`boolean` | Not Null, Default `true` | Whether the season is currently active 
and available for assignment/display. | | `created_at` | `timestamp with time 
zone` | Not Null, Default `now()` | Timestamp of record creation. | | 
`created_by_profile_id` | `uuid` | Foreign Key to `public.profiles(id)` ON 
DELETE SET NULL, Nullable | Profile ID of the user who created this record. | | 
`updated_at` | `timestamp with time zone` | Not Null, Default `now()` | 
Timestamp of last update (auto-updated by trigger). | | `updated_by_profile_id` 
| `uuid` | Foreign Key to `public.profiles(id)` ON DELETE SET NULL, Nullable | 
Profile ID of the user who last updated this record. | 3\. PostgreSQL DDL SQL 
``` CREATE TABLE public.seasons_master ( id INTEGER GENERATED ALWAYS AS 
IDENTITY PRIMARY KEY, season_code TEXT NOT NULL UNIQUE CHECK 
(char_length(season_code) <= 50 AND season_code = upper(season_code) AND 
season_code ~ '^[A-Z_]+$'), name TEXT NOT NULL UNIQUE CHECK (char_length(name) 
<= 100), -- Was name_en, (Translatable) description TEXT, -- Was 
description_en, (Translatable) icon_identifier TEXT CHECK (icon_identifier IS 
NULL OR char_length(icon_identifier) <= 100), -- Added sort_order INTEGER NOT 
NULL DEFAULT 0, is_active BOOLEAN NOT NULL DEFAULT true, created_at TIMESTAMPTZ 
NOT NULL DEFAULT now(), created_by_profile_id UUID REFERENCES 
public.profiles(id) ON DELETE SET NULL, updated_at TIMESTAMPTZ NOT NULL DEFAULT 
now(), updated_by_profile_id UUID REFERENCES public.profiles(id) ON DELETE SET 
NULL ); -- Indexes CREATE INDEX IF NOT EXISTS idx_seasons_master_is_active ON 
public.seasons_master(is_active); CREATE INDEX IF NOT EXISTS 
idx_seasons_master_sort_order ON public.seasons_master(sort_order); CREATE 
INDEX IF NOT EXISTS idx_seasons_master_created_by ON 
public.seasons_master(created_by_profile_id) WHERE created_by_profile_id IS NOT 
NULL; CREATE INDEX IF NOT EXISTS idx_seasons_master_updated_by ON 
public.seasons_master(updated_by_profile_id) WHERE updated_by_profile_id IS NOT 
NULL; -- Comments COMMENT ON TABLE public.seasons_master IS 'Master lookup 
table for seasons (e.g., Spring, Summer) to indicate optimal travel times for 
itineraries. Name and description are translatable. Version 2.1.'; COMMENT ON 
COLUMN public.seasons_master.id IS 'PK. Unique identifier for each season. 
Version 2.1.'; COMMENT ON COLUMN public.seasons_master.season_code IS 'A 
stable, machine-readable code for the season (e.g., "SPRING"). Uppercase, 
letters, underscores. Max 50 chars. Must be unique. Version 2.1.'; COMMENT ON 
COLUMN public.seasons_master.name IS 'The display name of the season (Base 
language: English). Translatable via public.translations. Max 100 chars. Must 
be unique. Version 2.1.'; COMMENT ON COLUMN public.seasons_master.description 
IS 'A short description of the season or relevant notes (Base language: 
English). Translatable via public.translations. Version 2.1.'; COMMENT ON 
COLUMN public.seasons_master.icon_identifier IS 'Optional identifier (e.g., CSS 
class, image name, SVG key) for an icon representing this season. Max 100 
chars. Version 2.1.'; COMMENT ON COLUMN public.seasons_master.sort_order IS 
'Optional integer to control the display order of seasons in UI lists/filters 
(e.g., Spring first). Lower numbers display first. Default 0. Version 2.1.'; 
COMMENT ON COLUMN public.seasons_master.is_active IS 'Whether the season is 
currently active and available for assignment/display. Default true. Version 
2.1.'; COMMENT ON COLUMN public.seasons_master.created_at IS 'Timestamp of 
record creation. Version 2.1.'; COMMENT ON COLUMN 
public.seasons_master.created_by_profile_id IS 'Profile ID of the user who 
created this record. FK to public.profiles.id. Version 2.1.'; COMMENT ON COLUMN 
public.seasons_master.updated_at IS 'Timestamp of last update (auto-updated by 
trigger). Version 2.1.'; COMMENT ON COLUMN 
public.seasons_master.updated_by_profile_id IS 'Profile ID of the user who last 
updated this record. FK to public.profiles.id. Version 2.1.'; -- Initial 
Population Example (adapt 'PUT_SYSTEM_USER_UUID_HERE' as needed) INSERT INTO 
public.seasons_master (season_code, name, description, icon_identifier, 
sort_order, created_by_profile_id, updated_by_profile_id) VALUES ('SPRING', 
'Spring', 'Typically March to May, pleasant temperatures and blooming flora.', 
'flower_icon', 10, 'PUT_SYSTEM_USER_UUID_HERE', 'PUT_SYSTEM_USER_UUID_HERE'), 
('SUMMER', 'Summer', 'June to August, can be hot, longer daylight hours.', 
'sun_icon', 20, 'PUT_SYSTEM_USER_UUID_HERE', 'PUT_SYSTEM_USER_UUID_HERE'), 
('AUTUMN', 'Autumn', 'September to November, cool weather and autumn colors.', 
'leaf_icon', 30, 'PUT_SYSTEM_USER_UUID_HERE', 'PUT_SYSTEM_USER_UUID_HERE'), 
('WINTER', 'Winter', 'December to February, colder, potential for snow, shorter 
days.', 'snowflake_icon', 40, 'PUT_SYSTEM_USER_UUID_HERE', 
'PUT_SYSTEM_USER_UUID_HERE'), ('YEAR_ROUND', 'Year-round', 'Suitable for travel 
throughout the year, though conditions may vary.', 'calendar_icon', 5, 
'PUT_SYSTEM_USER_UUID_HERE', 'PUT_SYSTEM_USER_UUID_HERE'); -- Seed 
corresponding English 'name' and 'description' into public.translations table. 
``` 4\. Triggers/Functions - Audit Metadata Trigger: SQL ``` -- Assuming 
public.set_master_table_audit_meta() is defined (see terrain_types_master 
example) CREATE TRIGGER trigger_seasons_master_audit_meta BEFORE INSERT OR 
UPDATE ON public.seasons_master FOR EACH ROW EXECUTE FUNCTION 
public.set_master_table_audit_meta(); ``` *Comment on Trigger*: Manages 
`created_at`, `updated_at`, `created_by_profile_id`, and 
`updated_by_profile_id` columns. - Orphaned Translation Cleanup Trigger: SQL 
``` CREATE OR REPLACE FUNCTION public.cleanup_seasons_master_translations() 
RETURNS TRIGGER AS $$ BEGIN DELETE FROM public.translations WHERE 
table_identifier = 'seasons_master' AND row_foreign_key = OLD.id::text; RETURN 
OLD; END; $$ LANGUAGE plpgsql SECURITY DEFINER; ALTER FUNCTION 
public.cleanup_seasons_master_translations() SET search_path = public; CREATE 
TRIGGER trigger_cleanup_seasons_master_translations AFTER DELETE ON 
public.seasons_master FOR EACH ROW EXECUTE FUNCTION 
public.cleanup_seasons_master_translations(); ``` *Comment on Trigger*: After a 
season is deleted, this trigger removes associated translations for `name` and 
`description` from `public.translations`. 5\. JSON Schema Mirror JSON ``` { 
"title": "seasons_master", "description": "Master lookup table for seasons 
(e.g., Spring, Summer) to indicate optimal travel times for itineraries. Name 
and description are translatable. Version 2.1.", "type": "object", 
"properties": { "id": { "type": "integer", "readOnly": true, "description": 
"PK. Unique identifier for each season. Version 2.1." }, "season_code": { 
"type": "string", "maxLength": 50, "pattern": "^[A-Z_]+$", "description": "A 
stable, machine-readable code for the season (e.g., \"SPRING\"). Uppercase, 
letters, underscores. Must be unique. Version 2.1." }, "name": { "type": 
"string", "maxLength": 100, "description": "The display name of the season 
(Base language: English). Translatable via public.translations. Max 100 chars. 
Must be unique. Version 2.1." }, "description": { "type": ["string", "null"], 
"description": "A short description of the season or relevant notes (Base 
language: English). Translatable via public.translations. Version 2.1." }, 
"icon_identifier": { "type": ["string", "null"], "maxLength": 100, 
"description": "Optional identifier (e.g., CSS class, image name, SVG key) for 
an icon representing this season. Max 100 chars. Version 2.1." }, "sort_order": 
{ "type": "integer", "default": 0, "description": "Optional integer to control 
the display order of seasons in UI lists/filters (e.g., Spring first). Lower 
numbers display first. Default 0. Version 2.1." }, "is_active": { "type": 
"boolean", "default": true, "description": "Whether the season is currently 
active and available for assignment/display. Default true. Version 2.1." }, 
"created_at": { "type": "string", "format": "date-time", "readOnly": true, 
"description": "Timestamp of record creation. Read-only. Version 2.1." }, 
"created_by_profile_id": { "type": ["string", "null"], "format": "uuid", 
"description": "Profile ID of the user who created this record. FK to 
public.profiles.id. Read-only. Version 2.1.", "readOnly": true }, "updated_at": 
{ "type": "string", "format": "date-time", "readOnly": true, "description": 
"Timestamp of last update (auto-updated by trigger). Read-only. Version 2.1." 
}, "updated_by_profile_id": { "type": ["string", "null"], "format": "uuid", 
"description": "Profile ID of the user who last updated this record. FK to 
public.profiles.id. Read-only. Version 2.1.", "readOnly": true } }, "required": 
[ "season_code", "name", "sort_order", "is_active", "created_at", "updated_at" 
], "primary_key": ["id"], "unique_constraints": [ {"columns": ["season_code"], 
"name": "seasons_master_season_code_key"}, {"columns": ["name"], "name": 
"seasons_master_name_key"} ] } ``` 6\. Relationships & Integrity - This table 
is a parent table. - Referenced by `curated_itinerary_to_season.season_id` (FK) 
with `ON DELETE RESTRICT`. - Audit FKs to `public.profiles(id)`. 7\. 
Multilingual Strategy - `name` and `description` store base language (English) 
text. - Translations managed in `public.translations`, linked by 
`table_identifier = 'seasons_master'`, `column_identifier = 'name'` or 
`'description'`, and `row_foreign_key = seasons_master.id::TEXT`. - An `AFTER 
DELETE` trigger handles orphan cleanup. 8\. Role-Based Workflow & RLS Notes - 
Workflow: `is_active` flag. Audit columns track changes. - RLS Policies: Admins 
have full CUD. Authenticated/Anonymous users have `SELECT` on active seasons. 
9\. ENUM vs Lookup Discussion - This table *is* the result of promoting a 
previous `text[]` field for seasons for better consistency, translatability, 
and manageability. 10\. UI/UX Enablement - `name` (translated), 
`icon_identifier` (if added), `sort_order` power UI filters and displays. 
`is_active` filters selection lists. 11\. Auditing & Lifecycle Management - 
Audit Columns: `created_at`, `updated_at`, `created_by_profile_id`, 
`updated_by_profile_id`. - Lifecycle: `is_active` flag. `ON DELETE RESTRICT` 
from junction table protects active seasons. 12\. Scalability & Future-Proofing 
- Small table, easily extensible. 13\. Seed Data - Initial seed data for 
`season_code`, `name` (base English), `icon_identifier`, `description`, 
`sort_order`, and audit FKs required. - Corresponding English `name` and 
`description` translations to be seeded into `public.translations`. (Example 
DDL includes seed data for the master table). 14\. Next-Action Checklist - 🔴 
Implement DDL: Create `public.seasons_master` with corrected 
`name`/`description` columns, new `icon_identifier` column, audit columns, 
indexes, and comments. - 🔴 Implement Audit Trigger: Apply 
`public.set_master_table_audit_meta` (or similar). - 🔴 Implement Orphaned 
Translation Cleanup Trigger. - 🔴 Populate Seed Data: Insert initial seasons 
into this table and their English names/descriptions into 
`public.translations`. - 🟠 Implement RLS Policies. - 🟠 Verify FK constraints 
in `curated_itinerary_to_season` point correctly to this table. - 🟢 Ensure 
Admin UI uses this table for season management and selection. * * * * * 
