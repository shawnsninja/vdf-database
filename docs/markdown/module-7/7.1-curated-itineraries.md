# 7.1 curated_itineraries

  
https://gemini.google.com/u/1/app/b76d14705d5101f9?is_sa=1&android-min-version=3
01356232&ios-min-version=322.0&campaign_id=bkws&utm_source=google&utm_medium=cpc
&utm_campaign=2024enUS_gemfeb&pt=9008&mt=8&ct=p-growth-sem-bkws 
https://gemini.google.com/u/1/app/a7603b60134369c2 
https://gemini.google.com/u/1/app/42a77d08d7a45bcb * * * * * ### 3\. Updated 
Production-Ready Specification * * * * * Production-Ready Specification: 
public.curated_itineraries Table Version: 3.1 (V2.1 Checklist REV 05-18-25-A 
Applied) Date: May 18, 2025 1\. Purpose & Primary Use-Cases Stores the metadata 
and summary information for pre-defined, editorially-managed pilgrimage 
itineraries. It defines the "what" and "why" of an itinerary (e.g., name, 
theme, suitability, overall statistics), serving as the central record for 
curated journey suggestions. *Key User-Story Touchpoints:* - Pilgrim (Anna): 
Enables Browse, filtering, and selecting pre-defined itineraries (A7). Provides 
overall context (description, difficulty, duration) before viewing daily 
segments (A2). Offers curated suggestions (A1). Supports displaying information 
in preferred language (A6). - Platform Administrator (Admin Team) / Regional 
Content Manager (Sofia): Allows creation, management, and featuring of 
itineraries (D2). Supports overall content management and quality control (D1). 
2\. Schema | Column | Data Type | Constraints | Description (Translatable 
fields marked) | | `id` | `bigint` | Primary Key, Generated always as identity 
| Unique identifier for each curated itinerary. | | `name` | `text` | Not Null, 
Unique (`trail_id`, `name`), `CHECK (char_length(name) <= 255)` | The 
human-readable name of the itinerary (Base language: English). (Translatable) 
Max 255 chars. | | `slug` | `text` | Not Null, Unique, `CHECK (slug ~ 
'^[a-z0-9]+(?:-[a-z0-9]+)*$' AND char_length(slug) <= 255)` | URL-friendly 
identifier. Auto-generated from name recommended. Max 255 chars. | | 
`itinerary_code` | `text` | Unique, `CHECK (itinerary_code IS NULL OR 
(itinerary_code ~ '^[A-Z0-9_-]+$' AND char_length(itinerary_code) <= 50))` | 
Optional short code for internal reference (e.g., "VDF_LVA_10D"). Max 50 chars. 
Unique when present. | | `primary_trail_id` | `bigint` | Foreign Key to 
`public.trails(id)` ON DELETE SET NULL, Nullable | The main trail this 
itinerary is primarily associated with. | | `based_on_primary_route_id` | 
`bigint` | Foreign Key to `public.routes(id)` ON DELETE SET NULL, Nullable | 
Optional: If this itinerary largely follows an existing official route. | | 
`short_description` | `text` | Nullable, `CHECK (char_length(short_description) 
<= 500)` | A brief summary of the itinerary (Base language: English). 
(Translatable) Max 500 chars. | | `long_description` | `text` | Nullable | 
Detailed description of the itinerary (Base language: English). (Translatable) 
| | `theme_or_focus` | `text` | Nullable, `CHECK (char_length(theme_or_focus) 
<= 255)` | Primary theme or focus (Base language: English). (Translatable) Max 
255 chars. | | `suitability_notes` | `text` | Nullable | Notes on who this 
itinerary is best suited for (Base language: English). (Translatable) | | 
`total_walking_days_approx` | `integer` | Nullable, `CHECK 
(total_walking_days_approx IS NULL OR total_walking_days_approx > 0)` | 
Approximate number of actual walking days. (Manual V1, calculated V2+). | | 
`total_nights_approx` | `integer` | Nullable, `CHECK (total_nights_approx IS 
NULL OR total_nights_approx >= 0)` | Approximate number of overnight stays 
required. (Manual V1, calculated V2+). | | `total_distance_km_approx` | `real` 
| Nullable, `CHECK (total_distance_km_approx IS NULL OR 
total_distance_km_approx > 0)` | Approximate total distance in kilometers. 
(Manual V1, calculated V2+). | | `overall_difficulty_level_id` | `integer` | 
Foreign Key to `public.trail_difficulty_levels_master(id)` ON DELETE SET NULL, 
Nullable | Overall difficulty assessment, linking to 
`trail_difficulty_levels_master`. | | `primary_start_location_text` | `text` | 
Nullable, `CHECK (char_length(primary_start_location_text) <= 255)` | 
Descriptive starting point (Base language: English). (Translatable) Max 255 
chars. | | `primary_end_location_text` | `text` | Nullable, `CHECK 
(char_length(primary_end_location_text) <= 255)` | Descriptive ending point 
(Base language: English). (Translatable) Max 255 chars. | | 
`start_waypoint_id_approx` | `bigint` | Foreign Key to `public.waypoints(id)` 
ON DELETE SET NULL, Nullable | Optional: Links to a specific waypoint for the 
approximate starting point. | | `end_waypoint_id_approx` | `bigint` | Foreign 
Key to `public.waypoints(id)` ON DELETE SET NULL, Nullable | Optional: Links to 
a specific waypoint for the approximate ending point. | | 
`banner_image_media_id` | `uuid` | Foreign Key to `public.media(id)` ON DELETE 
SET NULL, Nullable | A primary banner image for this itinerary. | | 
`map_overview_image_media_id` | `uuid` | Foreign Key to `public.media(id)` ON 
DELETE SET NULL, Nullable | A static map image overview of the itinerary's 
path. | | `created_by_profile_id` | `uuid` | Foreign Key to 
`public.profiles(id)` ON DELETE SET NULL, Nullable | Admin/curator who created 
this itinerary. | | `content_status_id` | `integer` | Foreign Key to 
`public.content_statuses_master(id)` ON DELETE RESTRICT, Not Null (*Default via 
application/trigger*) | Publication status, linking to 
`content_statuses_master`. | | `published_at` | `timestamp with time zone` | 
Nullable | Timestamp when the itinerary was first published. | | 
`is_featured_itinerary` | `boolean` | Not Null, Default `false` | Flag to 
highlight this itinerary. | | `version_notes` | `text` | Nullable | Notes about 
the current version or recent significant changes. | | 
`summary_stats_last_calculated_at` | `timestamp with time zone` | Nullable | If 
distance/days are calculated (V2+), when they were last updated. | | 
`data_last_verified_at` | `timestamp with time zone` | Nullable | When the 
overall itinerary content was last editorially reviewed. | | `created_at` | 
`timestamp with time zone` | Not Null, Default `now()` | Timestamp of creation. 
| | `updated_at` | `timestamp with time zone` | Not Null, Default `now()` | 
Timestamp of last update (auto-updated by trigger). | | `updated_by_profile_id` 
| `uuid` | Foreign Key to `public.profiles(id)` ON DELETE SET NULL, Nullable | 
Profile ID of user who last updated this record. | | `deleted_at` | `timestamp 
with time zone` | Nullable | For soft deletion. If set, the itinerary is 
considered deleted. | 3\. PostgreSQL DDL SQL ``` -- Ensure prerequisite tables: 
-- public.trails (PK: id BIGINT) -- public.routes (PK: id BIGINT) -- 
public.waypoints (PK: id BIGINT) -- public.media (PK: id UUID) -- 
public.profiles (PK: id UUID) -- public.trail_difficulty_levels_master (PK: id 
INTEGER) -- public.content_statuses_master (PK: id INTEGER) CREATE TABLE 
public.curated_itineraries ( id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY 
KEY, name TEXT NOT NULL CHECK (char_length(name) <= 255), -- (Translatable) 
slug TEXT NOT NULL UNIQUE CHECK (slug ~ '^[a-z0-9]+(?:-[a-z0-9]+)*$' AND 
char_length(slug) <= 255), itinerary_code TEXT UNIQUE CHECK (itinerary_code IS 
NULL OR (itinerary_code ~ '^[A-Z0-9_-]+$' AND char_length(itinerary_code) <= 
50)), primary_trail_id BIGINT REFERENCES public.trails(id) ON DELETE SET NULL, 
based_on_primary_route_id BIGINT REFERENCES public.routes(id) ON DELETE SET 
NULL, short_description TEXT CHECK (short_description IS NULL OR 
char_length(short_description) <= 500), -- (Translatable) long_description 
TEXT, -- (Translatable) theme_or_focus TEXT CHECK (theme_or_focus IS NULL OR 
char_length(theme_or_focus) <= 255), -- (Translatable) suitability_notes TEXT, 
-- (Translatable) total_walking_days_approx INTEGER CHECK 
(total_walking_days_approx IS NULL OR total_walking_days_approx > 0), 
total_nights_approx INTEGER CHECK (total_nights_approx IS NULL OR 
total_nights_approx >= 0), total_distance_km_approx REAL CHECK 
(total_distance_km_approx IS NULL OR total_distance_km_approx > 0), 
overall_difficulty_level_id INTEGER REFERENCES 
public.trail_difficulty_levels_master(id) ON DELETE SET NULL, 
primary_start_location_text TEXT CHECK (primary_start_location_text IS NULL OR 
char_length(primary_start_location_text) <= 255), -- (Translatable) 
primary_end_location_text TEXT CHECK (primary_end_location_text IS NULL OR 
char_length(primary_end_location_text) <= 255), -- (Translatable) 
start_waypoint_id_approx BIGINT REFERENCES public.waypoints(id) ON DELETE SET 
NULL, end_waypoint_id_approx BIGINT REFERENCES public.waypoints(id) ON DELETE 
SET NULL, banner_image_media_id UUID REFERENCES public.media(id) ON DELETE SET 
NULL, map_overview_image_media_id UUID REFERENCES public.media(id) ON DELETE 
SET NULL, created_by_profile_id UUID REFERENCES public.profiles(id) ON DELETE 
SET NULL, content_status_id INTEGER NOT NULL REFERENCES 
public.content_statuses_master(id) ON DELETE RESTRICT, -- Default for 'draft' 
status ID to be handled by application or trigger published_at TIMESTAMPTZ, 
is_featured_itinerary BOOLEAN NOT NULL DEFAULT FALSE, version_notes TEXT, 
summary_stats_last_calculated_at TIMESTAMPTZ, data_last_verified_at 
TIMESTAMPTZ, created_at TIMESTAMPTZ NOT NULL DEFAULT now(), updated_at 
TIMESTAMPTZ NOT NULL DEFAULT now(), updated_by_profile_id UUID REFERENCES 
public.profiles(id) ON DELETE SET NULL, deleted_at TIMESTAMPTZ, UNIQUE 
(trail_id, name) -- Ensures name is unique within a parent trail ); -- Indexes 
-- PK index on id is auto-created -- UNIQUE constraints on slug, itinerary_code 
(partial), and (trail_id, name) create indexes CREATE INDEX IF NOT EXISTS 
idx_curated_itineraries_primary_trail_id ON 
public.curated_itineraries(primary_trail_id); CREATE INDEX IF NOT EXISTS 
idx_curated_itineraries_based_on_primary_route_id ON 
public.curated_itineraries(based_on_primary_route_id); CREATE INDEX IF NOT 
EXISTS idx_curated_itineraries_start_waypoint_id ON 
public.curated_itineraries(start_waypoint_id_approx); CREATE INDEX IF NOT 
EXISTS idx_curated_itineraries_end_waypoint_id ON 
public.curated_itineraries(end_waypoint_id_approx); CREATE INDEX IF NOT EXISTS 
idx_curated_itineraries_created_by_profile_id ON 
public.curated_itineraries(created_by_profile_id); CREATE INDEX IF NOT EXISTS 
idx_curated_itineraries_updated_by_profile_id ON 
public.curated_itineraries(updated_by_profile_id); CREATE INDEX IF NOT EXISTS 
idx_curated_itineraries_difficulty_level_id ON 
public.curated_itineraries(overall_difficulty_level_id); CREATE INDEX IF NOT 
EXISTS idx_curated_itineraries_content_status_id ON 
public.curated_itineraries(content_status_id); CREATE INDEX IF NOT EXISTS 
idx_curated_itineraries_deleted_at ON public.curated_itineraries(deleted_at) 
WHERE deleted_at IS NULL; -- Comments COMMENT ON TABLE 
public.curated_itineraries IS 'Stores metadata and summary information for 
pre-defined, editorially-managed pilgrimage itineraries. Version 3.1.'; COMMENT 
ON COLUMN public.curated_itineraries.id IS 'PK. Unique identifier for each 
curated itinerary. Version 3.1.'; COMMENT ON COLUMN 
public.curated_itineraries.name IS 'The human-readable name of the itinerary 
(Base language: English). Translatable via public.translations. Max 255 chars. 
Unique within its parent trail. Version 3.1.'; COMMENT ON COLUMN 
public.curated_itineraries.slug IS 'URL-friendly identifier for the itinerary. 
Auto-generated from name recommended. Max 255 chars. Must be unique. Pattern: 
^[a-z0-9]+(?:-[a-z0-9]+)*$. Version 3.1.'; COMMENT ON COLUMN 
public.curated_itineraries.itinerary_code IS 'An optional short, unique code 
for internal reference (e.g., "VDF_LVA_10D"). Max 50 chars. Pattern: 
^[A-Z0-9_-]+$. Unique when present. Version 3.1.'; COMMENT ON COLUMN 
public.curated_itineraries.short_description IS 'A brief summary of the 
itinerary (Base language: English). Translatable via public.translations. Max 
500 chars. Version 3.1.'; COMMENT ON COLUMN 
public.curated_itineraries.long_description IS 'Detailed description of the 
itinerary, its theme, target audience, etc. (Base language: English). 
Translatable via public.translations. Version 3.1.'; COMMENT ON COLUMN 
public.curated_itineraries.theme_or_focus IS 'Primary theme or focus of this 
itinerary (Base language: English). Translatable via public.translations. Max 
255 chars. Version 3.1.'; COMMENT ON COLUMN 
public.curated_itineraries.suitability_notes IS 'Notes on who this itinerary is 
best suited for (Base language: English). Translatable via public.translations. 
Version 3.1.'; COMMENT ON COLUMN 
public.curated_itineraries.overall_difficulty_level_id IS 'Overall difficulty 
assessment, FK to trail_difficulty_levels_master.id. Version 3.1.'; COMMENT ON 
COLUMN public.curated_itineraries.primary_start_location_text IS 'Descriptive 
starting point (Base language: English). Translatable via public.translations. 
Max 255 chars. Version 3.1.'; COMMENT ON COLUMN 
public.curated_itineraries.primary_end_location_text IS 'Descriptive ending 
point (Base language: English). Translatable via public.translations. Max 255 
chars. Version 3.1.'; COMMENT ON COLUMN 
public.curated_itineraries.content_status_id IS 'Publication status, FK to 
content_statuses_master.id. Default corresponding to ''draft'' status to be 
handled by application logic or a trigger. Version 3.1.'; COMMENT ON COLUMN 
public.curated_itineraries.total_walking_days_approx IS 'Approximate number of 
actual walking days. (Manual V1, calculated V2+). Version 3.1.'; COMMENT ON 
COLUMN public.curated_itineraries.updated_at IS 'Timestamp of last update 
(auto-updated by trigger). Version 3.1.'; COMMENT ON COLUMN 
public.curated_itineraries.updated_by_profile_id IS 'Profile ID of the user who 
last updated this record. FK to public.profiles.id. Version 3.1.'; COMMENT ON 
COLUMN public.curated_itineraries.deleted_at IS 'For soft deletion. If set, the 
itinerary is considered deleted. Version 3.1.'; ``` 4\. Triggers/Functions - 
Audit Metadata Trigger: SQL ``` CREATE OR REPLACE FUNCTION 
public.set_curated_itinerary_audit_meta() RETURNS TRIGGER AS $$ BEGIN 
NEW.updated_at = NOW(); IF (TG_OP = 'INSERT') THEN -- For interactive inserts 
by app, auth.uid() will be used if available. -- For seeding/migrations, 
created_by_profile_id can be set explicitly in the INSERT statement. 
NEW.created_by_profile_id = COALESCE(NEW.created_by_profile_id, auth.uid()); 
NEW.updated_by_profile_id = COALESCE(NEW.updated_by_profile_id, auth.uid()); 
ELSIF (TG_OP = 'UPDATE') THEN -- Ensure created_at and created_by_profile_id 
are not changed on update. NEW.created_at = OLD.created_at; 
NEW.created_by_profile_id = OLD.created_by_profile_id; 
NEW.updated_by_profile_id = COALESCE(NEW.updated_by_profile_id, auth.uid()); 
END IF; RETURN NEW; END; $$ LANGUAGE plpgsql SECURITY DEFINER; -- It is crucial 
to set a safe search_path for SECURITY DEFINER functions ALTER FUNCTION 
public.set_curated_itinerary_audit_meta() SET search_path = public; CREATE 
TRIGGER trigger_set_curated_itinerary_audit_meta BEFORE INSERT OR UPDATE ON 
public.curated_itineraries FOR EACH ROW EXECUTE FUNCTION 
public.set_curated_itinerary_audit_meta(); ``` *Comment on Trigger*: Manages 
`created_at`, `updated_at`, `created_by_profile_id`, and 
`updated_by_profile_id` columns. `created_by_profile_id` is populated on insert 
(app should pass it or it uses `auth.uid()`). `updated_by_profile_id` is 
populated on insert and update. `created_at` and `created_by_profile_id` are 
preserved on update. - Orphaned Translation Cleanup Trigger: SQL ``` CREATE OR 
REPLACE FUNCTION public.cleanup_curated_itineraries_translations() RETURNS 
TRIGGER AS $$ BEGIN DELETE FROM public.translations WHERE table_identifier = 
'curated_itineraries' AND row_foreign_key = OLD.id::text; RETURN OLD; END; $$ 
LANGUAGE plpgsql SECURITY DEFINER; ALTER FUNCTION 
public.cleanup_curated_itineraries_translations() SET search_path = public; 
CREATE TRIGGER trigger_cleanup_curated_itineraries_translations AFTER DELETE ON 
public.curated_itineraries FOR EACH ROW EXECUTE FUNCTION 
public.cleanup_curated_itineraries_translations(); ``` *Comment on Trigger*: 
After an itinerary is deleted, this trigger removes any associated translations 
from `public.translations` for its translatable fields. 5\. JSON Schema Mirror 
JSON ``` { "title": "curated_itinerary", "description": "Stores metadata and 
summary information for a pre-defined, editorially-managed pilgrimage 
itinerary. Version 3.1.", "type": "object", "properties": { "id": { "type": 
"integer", "format": "int64", "readOnly": true, "description": "PK. Unique 
identifier for each curated itinerary. Version 3.1." }, "name": { "type": 
"string", "maxLength": 255, "description": "The human-readable name of the 
itinerary (Base language: English). Translatable via public.translations. Max 
255 chars. Unique within its parent trail. Version 3.1." }, "slug": { "type": 
"string", "maxLength": 255, "pattern": "^[a-z0-9]+(?:-[a-z0-9]+)*$", 
"description": "URL-friendly identifier for the itinerary. Auto-generated from 
name recommended. Max 255 chars. Must be unique. Version 3.1." }, 
"itinerary_code": { "type": ["string", "null"], "maxLength": 50, "pattern": 
"^[A-Z0-9_-]+$", "description": "An optional short, unique code for internal 
reference (e.g., \"VDF_LVA_10D\"). Max 50 chars. Unique when present. Version 
3.1." }, "primary_trail_id": { "type": ["integer", "null"], "format": "int64", 
"description": "The main trail this itinerary is primarily associated with. FK 
to public.trails.id. Version 3.1." }, "based_on_primary_route_id": { "type": 
["integer", "null"], "format": "int64", "description": "Optional: If this 
itinerary largely follows an existing official route. FK to public.routes.id. 
Version 3.1." }, "short_description": { "type": ["string", "null"], 
"maxLength": 500, "description": "A brief summary of the itinerary (Base 
language: English). Translatable via public.translations. Max 500 chars. 
Version 3.1." }, "long_description": { "type": ["string", "null"], 
"description": "Detailed description of the itinerary, its theme, target 
audience, and what to expect (Base language: English). Translatable via 
public.translations. Version 3.1." }, "theme_or_focus": { "type": ["string", 
"null"], "maxLength": 255, "description": "Primary theme or focus of this 
itinerary (Base language: English). Translatable via public.translations. Max 
255 chars. Version 3.1." }, "suitability_notes": { "type": ["string", "null"], 
"description": "Notes on who this itinerary is best suited for (Base language: 
English). Translatable via public.translations. Version 3.1." }, 
"total_walking_days_approx": { "type": ["integer", "null"], "minimum": 1, 
"description": "Approximate number of actual walking days. (Manual V1, 
calculated V2+). Version 3.1." }, "total_nights_approx": { "type": ["integer", 
"null"], "minimum": 0, "description": "Approximate number of overnight stays 
required. (Manual V1, calculated V2+). Version 3.1." }, 
"total_distance_km_approx": { "type": ["number", "null"], "format": "float", 
"exclusiveMinimum": 0, "description": "Approximate total distance in 
kilometers. (Manual V1, calculated V2+). Version 3.1." }, 
"overall_difficulty_level_id": { "type": ["integer", "null"], "description": 
"Overall difficulty assessment, FK to trail_difficulty_levels_master.id. 
Version 3.1." }, "primary_start_location_text": { "type": ["string", "null"], 
"maxLength": 255, "description": "Descriptive starting point of the itinerary 
(Base language: English). Translatable via public.translations. Max 255 chars. 
Version 3.1." }, "primary_end_location_text": { "type": ["string", "null"], 
"maxLength": 255, "description": "Descriptive ending point of the itinerary 
(Base language: English). Translatable via public.translations. Max 255 chars. 
Version 3.1." }, "start_waypoint_id_approx": { "type": ["integer", "null"], 
"format": "int64", "description": "Optional: Links to a specific waypoint for 
the approximate starting point. FK to public.waypoints.id. Version 3.1." }, 
"end_waypoint_id_approx": { "type": ["integer", "null"], "format": "int64", 
"description": "Optional: Links to a specific waypoint for the approximate 
ending point. FK to public.waypoints.id. Version 3.1." }, 
"banner_image_media_id": { "type": ["string", "null"], "format": "uuid", 
"description": "A primary banner image for this itinerary. FK to 
public.media.id. Version 3.1." }, "map_overview_image_media_id": { "type": 
["string", "null"], "format": "uuid", "description": "A static map image 
overview of the itinerary's path. FK to public.media.id. Version 3.1." }, 
"created_by_profile_id": { "type": ["string", "null"], "format": "uuid", 
"description": "Admin/curator who created this itinerary. FK to 
public.profiles.id. Read-only. Version 3.1.", "readOnly": true }, 
"content_status_id": { "type": "integer", "description": "Publication status, 
FK to content_statuses_master.id. Default should correspond to 'draft'. Version 
3.1." }, "published_at": { "type": ["string", "null"], "format": "date-time", 
"description": "Timestamp when the itinerary was first published. Version 3.1." 
}, "is_featured_itinerary": { "type": "boolean", "default": false, 
"description": "Flag to highlight this itinerary. Version 3.1." }, 
"version_notes": { "type": ["string", "null"], "description": "Notes about the 
current version or recent significant changes. Version 3.1." }, 
"summary_stats_last_calculated_at": { "type": ["string", "null"], "format": 
"date-time", "description": "If distance/days are calculated, when they were 
last updated. Version 3.1." }, "data_last_verified_at": { "type": ["string", 
"null"], "format": "date-time", "description": "When the overall itinerary 
content was last editorially reviewed. Version 3.1." }, "created_at": { "type": 
"string", "format": "date-time", "readOnly": true, "description": "Timestamp of 
creation. Read-only. Version 3.1." }, "updated_at": { "type": "string", 
"format": "date-time", "readOnly": true, "description": "Timestamp of last 
update. Read-only. Version 3.1." }, "updated_by_profile_id": { "type": 
["string", "null"], "format": "uuid", "description": "Profile ID of user who 
last updated this record. FK to public.profiles.id. Read-only. Version 3.1.", 
"readOnly": true }, "deleted_at": { "type": ["string", "null"], "format": 
"date-time", "readOnly": true, "description": "For soft deletion. If set, the 
itinerary is considered deleted. Read-only. Version 3.1." } }, "required": [ 
"name", "slug", "content_status_id", "is_featured_itinerary", "created_at", 
"updated_at" ], "primary_key": ["id"], "unique_constraints": [ {"columns": 
["slug"], "name": "curated_itineraries_slug_key"}, {"columns": 
["itinerary_code"], "name": "curated_itineraries_itinerary_code_key"}, 
{"columns": ["trail_id", "name"], "name": 
"curated_itineraries_trail_id_name_key"} ] } ``` 6\. Relationships & Integrity 
- Foreign Key Targets & `ON DELETE` Actions: - `primary_trail_id` -> 
`public.trails(id)`: `ON DELETE SET NULL`. - `based_on_primary_route_id` -> 
`public.routes(id)`: `ON DELETE SET NULL`. - `start_waypoint_id_approx` -> 
`public.waypoints(id)`: `ON DELETE SET NULL`. - `end_waypoint_id_approx` -> 
`public.waypoints(id)`: `ON DELETE SET NULL`. - `banner_image_media_id` -> 
`public.media(id)`: `ON DELETE SET NULL`. - `map_overview_image_media_id` -> 
`public.media(id)`: `ON DELETE SET NULL`. - `created_by_profile_id` -> 
`public.profiles(id)`: `ON DELETE SET NULL`. - `updated_by_profile_id` -> 
`public.profiles(id)`: `ON DELETE SET NULL`. - `overall_difficulty_level_id` -> 
`public.trail_difficulty_levels_master(id)`: `ON DELETE SET NULL`. - 
`content_status_id` -> `public.content_statuses_master(id)`: `ON DELETE 
RESTRICT`. - Junction Tables: Links to `itinerary_categories_master` (via 
`curated_itinerary_to_category`) and `seasons_master` (via 
`curated_itinerary_to_season`). These junction tables have `ON DELETE CASCADE` 
for `itinerary_id` and `ON DELETE RESTRICT` for `category_id`/`season_id`. - 
Unique Constraints: `slug` (globally), `itinerary_code` (globally, when not 
NULL), `(trail_id, name)` (name unique within a trail). - Mermaid ER Snippet: 
Code snippet ``` erDiagram curated_itineraries { bigint id PK text name text 
slug UK text itinerary_code "UK (if NOT NULL)" bigint primary_trail_id FK 
bigint based_on_primary_route_id FK integer overall_difficulty_level_id FK uuid 
banner_image_media_id FK uuid map_overview_image_media_id FK uuid 
created_by_profile_id FK integer content_status_id FK uuid 
updated_by_profile_id FK timestamptz deleted_at UNIQUE (trail_id, name) } 
trails { bigint id PK } routes { bigint id PK } waypoints { bigint id PK } 
media { uuid id PK } profiles { uuid id PK } trail_difficulty_levels_master { 
integer id PK } content_statuses_master { integer id PK } 
itinerary_categories_master { integer id PK } seasons_master { integer id PK } 
curated_itinerary_to_category { bigint itinerary_id PK FK; integer category_id 
PK FK } curated_itinerary_to_season { bigint itinerary_id PK FK; integer 
season_id PK FK } curated_itineraries }o--|| trails : "primary_trail_id (SET 
NULL)" curated_itineraries }o--|| routes : "based_on_primary_route_id (SET 
NULL)" curated_itineraries }o--|| waypoints : "start_waypoint_id_approx (SET 
NULL)" curated_itineraries }o--|| waypoints : "end_waypoint_id_approx (SET 
NULL)" curated_itineraries }o--|| media : "banner_image_media_id (SET NULL)" 
curated_itineraries }o--|| media : "map_overview_image_media_id (SET NULL)" 
curated_itineraries }o--|| profiles : "created_by_profile_id (SET NULL)" 
curated_itineraries }o--|| profiles : "updated_by_profile_id (SET NULL)" 
curated_itineraries }o--|| trail_difficulty_levels_master : "difficulty (SET 
NULL)" curated_itineraries }o--|| content_statuses_master : "status (RESTRICT)" 
curated_itineraries ||--o{ curated_itinerary_to_category : "has categories 
(CASCADE)" itinerary_categories_master ||--o{ curated_itinerary_to_category : 
"categorizes (RESTRICT)" curated_itineraries ||--o{ curated_itinerary_to_season 
: "has seasons (CASCADE)" seasons_master ||--o{ curated_itinerary_to_season : 
"applies to (RESTRICT)" ``` 7\. Multilingual Strategy - Translatable Fields: 
`name`, `short_description`, `long_description`, `theme_or_focus`, 
`suitability_notes`, `primary_start_location_text`, 
`primary_end_location_text`. These store the base language (English). - 
Translations are managed in `public.translations` table linked by 
`table_identifier = 'curated_itineraries'`, `column_identifier`, and 
`row_foreign_key = curated_itineraries.id::TEXT`. An `AFTER DELETE` trigger 
handles orphan cleanup. 8\. Role-Based Workflow & RLS Notes - Workflow Fields: 
`created_by_profile_id`, `content_status_id` (FK to `content_statuses_master`), 
`published_at`, `data_last_verified_at`. - RLS Policies (Conceptual): - Admins: 
Full CRUD using helper `public.is_claims_admin()` or similar. - Regional 
Content Managers: Update access for itineraries they created and are in 'DRAFT' 
status. - Authenticated/Anonymous Users: `SELECT` access for itineraries where 
`deleted_at IS NULL` and `content_status_id` corresponds to 'PUBLISHED'. 9\. 
ENUM vs Lookup Discussion - `overall_difficulty_level_id`: FK to 
`public.trail_difficulty_levels_master`. ✅ - `content_status_id`: FK to 
`public.content_statuses_master`. ✅ - Categories and Seasons are managed via 
junction tables to their respective master tables. ✅ 10\. UI/UX Enablement - 
Filters & Display: `name`, `slug`, `short_description`, `theme_or_focus`, 
`total_walking_days_approx`, `total_distance_km_approx`, 
`overall_difficulty_level_id` (joined), `content_status_id` (joined), 
`is_featured_itinerary`. Categories and Seasons via joins. - Performance: 
Indexes on FKs, `slug`, `content_status_id`. 11\. Auditing & Lifecycle 
Management - Audit Columns: `created_at`, `updated_at`, 
`created_by_profile_id`, `updated_by_profile_id`. - Soft Deletes: `deleted_at` 
timestamp. - Lifecycle: `content_status_id` manages publication states. 12\. 
Scalability & Future-Proofing - `id` as `bigint`. Soft deletion and audit 
columns present. - V2+ considerations for calculated summary statistics remain. 
13\. Seed Data - ⚪ N/A for `curated_itineraries` itself, as it's 
transactional/editorial content. Seed data required for FK targets like 
`trail_difficulty_levels_master` and `content_statuses_master`. 14\. 
Next-Action Checklist - 🔴 Implement DDL: Execute the updated `CREATE TABLE` 
DDL for `public.curated_itineraries`, ensuring correct FK types and all 
constraints. - 🔴 Implement Audit Trigger: Create and apply 
`public.set_curated_itinerary_audit_meta`. - 🔴 Implement Orphaned Translation 
Cleanup Trigger: Create and apply 
`public.cleanup_curated_itineraries_translations`. - 🟠 Default 
`content_status_id`: Implement logic (application or DB trigger) to set 
`content_status_id` to 'DRAFT' equivalent on new record creation. - 🟠 Slug 
Generation: Implement logic for `slug` generation (application or DB trigger). 
- 🟠 Implement RLS Policies: Define and test all RLS policies and helper 
functions. - 🟢 Data Migration: If applicable, migrate data from any old 
structures, populating new FKs and audit columns. - 🟢 Update Backend & UI: 
Refactor application logic and admin interfaces to use the new structure. - 🟢 
Documentation: Update all relevant documentation. 
