# 7.8 content_statuses_master

  https://gemini.google.com/u/1/app/a7603b60134369c2 
https://gemini.google.com/u/1/app/42a77d08d7a45bcb * * * * * Production-Ready 
Specification: public.content_statuses_master Table Version: 2.1 (V2.1 
Checklist REV 05-18-25-A Applied) Date: May 18, 2025 1\. Purpose & Primary 
Use-Cases Stores the definitive list of content publication statuses (e.g., 
Draft, Published, Archived) that can be assigned to various content entities 
like curated itineraries, waypoints, articles, etc. This provides a structured, 
translatable, and manageable way to control the content lifecycle. *Key 
User-Story Touchpoints:* - Platform Administrator (Admin Team) / Regional 
Content Manager (Sofia): Core to content management workflows (D1). - All Users 
(indirectly): Determines what content is visible. 2\. Schema | Column | Data 
Type | Constraints | Description (Translatable fields marked) | | `id` | 
`integer` | Primary Key, Generated always as identity | Unique identifier for 
each content status. | | `code` | `text` | Not Null, Unique, `CHECK 
(char_length(code) <= 50 AND code = upper(code) AND code ~ '^[A-Z_]+$')` | 
Stable, machine-readable code (e.g., "DRAFT"). Uppercase, letters, underscores. 
Max 50 chars. | | `name` | `text` | Not Null, Unique, `CHECK (char_length(name) 
<= 100)` | Display name in the base language (English). (Translatable) Max 100 
chars. | | `description` | `text` | Nullable | Short description of the status 
in the base language (English). (Translatable) | | `icon_identifier` | `text` | 
Nullable, `CHECK (icon_identifier IS NULL OR char_length(icon_identifier) <= 
100)` | Optional identifier for an icon representing this status. Max 100 
chars. | | `sort_order` | `integer` | Not Null, Default `0` | Optional integer 
for display order in UI lists/filters. | | `is_active` | `boolean` | Not Null, 
Default `true` | Whether the status type is currently active and available for 
assignment. | | `created_at` | `timestamp with time zone` | Not Null, Default 
`now()` | Timestamp of record creation. | | `created_by_profile_id` | `uuid` | 
Foreign Key to `public.profiles(id)` ON DELETE SET NULL, Nullable | Profile ID 
of the user who created this record. | | `updated_at` | `timestamp with time 
zone` | Not Null, Default `now()` | Timestamp of last update (auto-updated by 
trigger). | | `updated_by_profile_id` | `uuid` | Foreign Key to 
`public.profiles(id)` ON DELETE SET NULL, Nullable | Profile ID of the user who 
last updated this record. | 3\. PostgreSQL DDL SQL ``` CREATE TABLE 
public.content_statuses_master ( id INTEGER GENERATED ALWAYS AS IDENTITY 
PRIMARY KEY, code TEXT NOT NULL UNIQUE CHECK (char_length(code) <= 50 AND code 
= upper(code) AND code ~ '^[A-Z_]+$'), name TEXT NOT NULL UNIQUE CHECK 
(char_length(name) <= 100), -- (Translatable) description TEXT, -- 
(Translatable) icon_identifier TEXT CHECK (icon_identifier IS NULL OR 
char_length(icon_identifier) <= 100), -- Added sort_order INTEGER NOT NULL 
DEFAULT 0, -- Added is_active BOOLEAN NOT NULL DEFAULT true, created_at 
TIMESTAMPTZ NOT NULL DEFAULT now(), created_by_profile_id UUID REFERENCES 
public.profiles(id) ON DELETE SET NULL, updated_at TIMESTAMPTZ NOT NULL DEFAULT 
now(), updated_by_profile_id UUID REFERENCES public.profiles(id) ON DELETE SET 
NULL ); -- Indexes CREATE INDEX IF NOT EXISTS 
idx_content_statuses_master_is_active ON 
public.content_statuses_master(is_active); CREATE INDEX IF NOT EXISTS 
idx_content_statuses_master_sort_order ON 
public.content_statuses_master(sort_order); -- Added CREATE INDEX IF NOT EXISTS 
idx_content_statuses_master_created_by ON 
public.content_statuses_master(created_by_profile_id) WHERE 
created_by_profile_id IS NOT NULL; CREATE INDEX IF NOT EXISTS 
idx_content_statuses_master_updated_by ON 
public.content_statuses_master(updated_by_profile_id) WHERE 
updated_by_profile_id IS NOT NULL; -- Comments COMMENT ON TABLE 
public.content_statuses_master IS 'Master lookup table for content publication 
statuses (e.g., Draft, Published). Name and description are translatable. 
Version 2.1.'; COMMENT ON COLUMN public.content_statuses_master.id IS 'PK. 
Unique identifier for each content status. Version 2.1.'; COMMENT ON COLUMN 
public.content_statuses_master.code IS 'Stable, machine-readable code (e.g., 
"DRAFT"). Uppercase, letters, underscores. Max 50 chars. Must be unique. 
Version 2.1.'; COMMENT ON COLUMN public.content_statuses_master.name IS 
'Display name of the status (Base language: English). Translatable via 
public.translations. Max 100 chars. Must be unique. Version 2.1.'; COMMENT ON 
COLUMN public.content_statuses_master.description IS 'Short description of the 
status (Base language: English). Translatable via public.translations. Version 
2.1.'; COMMENT ON COLUMN public.content_statuses_master.icon_identifier IS 
'Optional identifier (e.g., CSS class, image name, SVG key) for an icon 
representing this status. Max 100 chars. Version 2.1.'; COMMENT ON COLUMN 
public.content_statuses_master.sort_order IS 'Optional integer for display 
order in UI lists/filters. Lower numbers display first. Default 0. Version 
2.1.'; COMMENT ON COLUMN public.content_statuses_master.is_active IS 'Whether 
the status type is currently active and available for assignment. Default true. 
Version 2.1.'; COMMENT ON COLUMN public.content_statuses_master.created_at IS 
'Timestamp of record creation. Version 2.1.'; COMMENT ON COLUMN 
public.content_statuses_master.created_by_profile_id IS 'Profile ID of the user 
who created this record. FK to public.profiles.id. Version 2.1.'; COMMENT ON 
COLUMN public.content_statuses_master.updated_at IS 'Timestamp of last update 
(auto-updated by trigger). Version 2.1.'; COMMENT ON COLUMN 
public.content_statuses_master.updated_by_profile_id IS 'Profile ID of the user 
who last updated this record. FK to public.profiles.id. Version 2.1.'; -- 
Initial Population Example (adapt 'PUT_SYSTEM_USER_UUID_HERE' as needed) INSERT 
INTO public.content_statuses_master (code, name, description, icon_identifier, 
sort_order, created_by_profile_id, updated_by_profile_id) VALUES ('DRAFT', 
'Draft', 'Content is in preparation and not publicly visible.', 
'status_draft_icon', 10, 'PUT_SYSTEM_USER_UUID_HERE', 
'PUT_SYSTEM_USER_UUID_HERE'), ('PENDING_REVIEW', 'Pending Review', 'Content is 
submitted and awaiting approval.', 'status_review_icon', 20, 
'PUT_SYSTEM_USER_UUID_HERE', 'PUT_SYSTEM_USER_UUID_HERE'), ('PUBLISHED', 
'Published', 'Content is live and publicly visible.', 'status_published_icon', 
30, 'PUT_SYSTEM_USER_UUID_HERE', 'PUT_SYSTEM_USER_UUID_HERE'), ('ARCHIVED', 
'Archived', 'Content is no longer current but kept for records, not publicly 
visible.', 'status_archived_icon', 40, 'PUT_SYSTEM_USER_UUID_HERE', 
'PUT_SYSTEM_USER_UUID_HERE'); -- Seed corresponding English 'name' and 
'description' into public.translations table. ``` 4\. Triggers/Functions - 
Audit Metadata Trigger: SQL ``` -- Assuming 
public.set_master_table_audit_meta() is defined (see terrain_types_master 
example) CREATE TRIGGER trigger_content_statuses_master_audit_meta BEFORE 
INSERT OR UPDATE ON public.content_statuses_master FOR EACH ROW EXECUTE 
FUNCTION public.set_master_table_audit_meta(); ``` *Comment on Trigger*: 
Manages `created_at`, `updated_at`, `created_by_profile_id`, and 
`updated_by_profile_id` columns. - Orphaned Translation Cleanup Trigger: SQL 
``` CREATE OR REPLACE FUNCTION 
public.cleanup_content_statuses_master_translations() RETURNS TRIGGER AS $$ 
BEGIN DELETE FROM public.translations WHERE table_identifier = 
'content_statuses_master' AND row_foreign_key = OLD.id::text; RETURN OLD; END; 
$$ LANGUAGE plpgsql SECURITY DEFINER; ALTER FUNCTION 
public.cleanup_content_statuses_master_translations() SET search_path = public; 
CREATE TRIGGER trigger_cleanup_content_statuses_master_translations AFTER 
DELETE ON public.content_statuses_master FOR EACH ROW EXECUTE FUNCTION 
public.cleanup_content_statuses_master_translations(); ``` *Comment on 
Trigger*: After a status is deleted, this trigger removes associated 
translations for its `name` and `description` from `public.translations`. 5\. 
JSON Schema Mirror JSON ``` { "title": "content_status_master", "description": 
"Master lookup table for content publication statuses. Name and description are 
translatable. Version 2.1.", "type": "object", "properties": { "id": { "type": 
"integer", "readOnly": true, "description": "PK. Unique identifier for each 
content status. Version 2.1." }, "code": { "type": "string", "maxLength": 50, 
"pattern": "^[A-Z_]+$", "description": "Stable, machine-readable code (e.g., 
\"DRAFT\"). Uppercase, letters, underscores. Max 50 chars. Must be unique. 
Version 2.1." }, "name": { "type": "string", "maxLength": 100, "description": 
"Display name of the status (Base language: English). Translatable via 
public.translations. Max 100 chars. Must be unique. Version 2.1." }, 
"description": { "type": ["string", "null"], "description": "Short description 
of the status (Base language: English). Translatable via public.translations. 
Version 2.1." }, "icon_identifier": { "type": ["string", "null"], "maxLength": 
100, "description": "Optional identifier (e.g., CSS class, image name, SVG key) 
for an icon representing this status. Max 100 chars. Version 2.1." }, 
"sort_order": { "type": "integer", "default": 0, "description": "Optional 
integer for display order in UI lists/filters. Lower numbers display first. 
Default 0. Version 2.1." }, "is_active": { "type": "boolean", "default": true, 
"description": "Whether the status type is currently active and available for 
assignment. Default true. Version 2.1." }, "created_at": { "type": "string", 
"format": "date-time", "readOnly": true, "description": "Timestamp of record 
creation. Read-only. Version 2.1." }, "created_by_profile_id": { "type": 
["string", "null"], "format": "uuid", "description": "Profile ID of the user 
who created this record. FK to public.profiles.id. Read-only. Version 2.1.", 
"readOnly": true }, "updated_at": { "type": "string", "format": "date-time", 
"readOnly": true, "description": "Timestamp of last update (auto-updated by 
trigger). Read-only. Version 2.1." }, "updated_by_profile_id": { "type": 
["string", "null"], "format": "uuid", "description": "Profile ID of the user 
who last updated this record. FK to public.profiles.id. Read-only. Version 
2.1.", "readOnly": true } }, "required": [ "code", "name", "sort_order", 
"is_active", "created_at", "updated_at" ], "primary_key": ["id"], 
"unique_constraints": [ {"columns": ["code"], "name": 
"content_statuses_master_code_key"}, {"columns": ["name"], "name": 
"content_statuses_master_name_key"} ] } ``` 6\. Relationships & Integrity - 
This is a parent table. - Referenced by FKs in content tables (e.g., 
`curated_itineraries.content_status_id`). - `ON DELETE` in referencing tables 
should generally be `RESTRICT`. - Audit FKs to `public.profiles(id)`. 7\. 
Multilingual Strategy - `name` and `description` store base language (English) 
text. - Translations managed in `public.translations` (linked by 
`table_identifier = 'content_statuses_master'`, `column_identifier`, 
`row_foreign_key = content_statuses_master.id::TEXT`). - `AFTER DELETE` trigger 
for orphan cleanup. 8\. Role-Based Workflow & RLS Notes - Workflow: `is_active` 
flag. Audit columns. - RLS Policies: Admins full CUD. Auth/Anon `SELECT` on 
active. 9\. ENUM vs Lookup Discussion - This table *is* the result of promoting 
a former `content_status_enum`. - Benefits: Translatability, metadata, 
manageability, integrity. 10\. UI/UX Enablement - `name` (translated), 
`icon_identifier` (if added), `sort_order` for UI. `is_active` for filters. 
`code` for logic. 11\. Auditing & Lifecycle Management - Audit Columns: 
`created_at`, `updated_at`, `created_by_profile_id`, `updated_by_profile_id`. - 
Lifecycle: `is_active` flag. `ON DELETE RESTRICT` on referencing tables 
protects statuses. 12\. Scalability & Future-Proofing - Small table, 
extensible. 13\. Seed Data - Initial seed data for codes, names, descriptions, 
icons, sort order, audit FKs. - Corresponding English translations in 
`public.translations`. (Example DDL includes master table seed). 14\. 
Next-Action Checklist - ðŸ”´ Implement DDL: Create 
`public.content_statuses_master` with `icon_identifier`, `sort_order`, audit 
columns, indexes, comments. - ðŸ”´ Implement Audit Trigger: Apply 
`public.set_master_table_audit_meta` (or similar). - ðŸ”´ Implement Orphaned 
Translation Cleanup Trigger. - ðŸ”´ Populate Seed Data: Insert initial statuses 
into this table and their English names/descriptions into 
`public.translations`. - ðŸŸ  Implement RLS Policies. - ðŸŸ  Update referencing 
tables (e.g., `curated_itineraries`) to use FK to this table, including data 
migration if needed. - ðŸŸ¢ Ensure Admin UI uses this table for status 
management. * * * * * 
