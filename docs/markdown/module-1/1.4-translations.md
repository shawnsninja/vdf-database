# 1.4 translations

  
https://gemini.google.com/u/1/app/2c4ea8fa457b0abd?is_sa=1&android-min-version=3
01356232&ios-min-version=322.0&campaign_id=bkws&utm_source=google&utm_medium=cpc
&utm_campaign=2024enUS_gemfeb&pt=9008&mt=8&ct=p-growth-sem-bkws 
https://gemini.google.com/u/1/app/fd47ede3d905a3f2 
https://gemini.google.com/u/1/app/4e4c57eff1c5afd3 
https://gemini.google.com/u/1/app/440838222ac514d7 Production-Ready 
Specification: public.translations Table Version: 2.1 (Checklist V2-05-17-B 
Applied) Date: 2025-05-17 1. Purpose & Primary Use-Cases Mission Statement: To 
store and manage all translated textual content for specified fields from 
various tables across the platform, enabling a multilingual user experience, 
with audit trails for content and row modifications. Key User-Story 
Touchpoints: â€¢ Pilgrim (Anna): Sees platform content in her preferred language. 
â€¢ Platform Administrator/Content Manager: Manages translated content and its 
lifecycle. â€¢ System/Developer: Application queries this table for translations; 
relies on audit fields. 2. Schema | column | data_type | constraints | 
description | | :---------------------------- | :------------------------ | 
:-------------------------------------------------------------------------------
----------------------------------- | 
:-------------------------------------------------------------------------------
--------------------------------------------------------------------------------
----------------------------------------- | | id | bigint | Primary Key, 
Generated always as identity | ðŸŸ¢ Unique identifier for the translation entry. 
| | table_identifier | text | Not Null, CHECK (`char_length(table_identifier)` 
> 0) | ðŸŸ¢ Name of the source table containing the original text (e.g., 
'user_roles_master'). | | column_identifier | text | Not Null, CHECK 
(`char_length(column_identifier)` > 0) | ðŸŸ¢ Name of the column in the source 
table being translated (e.g., 'default_display_name'). | | row_foreign_key | 
text | Not Null | ðŸŸ  PK value of the source record as text. Accommodates 
various PK types. Integrity via parent table triggers. | | language_code | text 
| Not Null, Foreign Key to `public.languages_master(language_code)` ON UPDATE 
CASCADE ON DELETE RESTRICT | ðŸŸ¢ The language of this translated text. | | 
translated_text | text | Not Null | ðŸŸ¢ The actual translated content. Can store 
JSON array for conceptual arrays. | | translation_status | text | Nullable, 
CHECK (`translation_status` IN ('draft', 'needs_review', 'published_live', 
'needs_update') OR `translation_status` IS NULL) | ðŸŸ  Workflow status of this 
translation. | | translated_by_profile_id | uuid | Nullable, Foreign Key to 
`public.profiles(id)` ON DELETE SET NULL | ðŸŸ¢ Profile ID of the user/agent who 
provided/last updated the `translated_text`. | | translation_last_updated_at | 
timestamp with time zone | Nullable | ðŸŸ¢ Timestamp when `translated_text` or 
`translation_status` was last modified by a translator/editor. | | created_at | 
timestamp with time zone | Not Null, Default `now()` | Timestamp of when this 
translation row was created. | | updated_at | timestamp with time zone | Not 
Null, Default `now()` | Timestamp of when this translation row was last updated 
(auto-updated by trigger). | | created_by_profile_id | uuid | Nullable, Foreign 
Key to `public.profiles(id)` ON DELETE SET NULL | Profile ID of the 
user/process that created this translation row. | | updated_by_profile_id | 
uuid | Nullable, Foreign Key to `public.profiles(id)` ON DELETE SET NULL | 
Profile ID of the user/process that last updated this translation row's 
metadata (distinct from content updates tracked by `translated_by_profile_id`). 
| 3. PostgreSQL DDL -- Table Definition CREATE TABLE public.translations ( id 
bigint NOT NULL GENERATED ALWAYS AS IDENTITY, table_identifier text NOT NULL 
CHECK (char_length(table_identifier) > 0), column_identifier text NOT NULL 
CHECK (char_length(column_identifier) > 0), row_foreign_key text NOT NULL, 
language_code text NOT NULL, translated_text text NOT NULL, translation_status 
text NULL, translated_by_profile_id uuid NULL, translation_last_updated_at 
timestamp with time zone NULL, created_at timestamp with time zone NOT NULL 
DEFAULT now(), updated_at timestamp with time zone NOT NULL DEFAULT now(), 
created_by_profile_id uuid NULL REFERENCES public.profiles(id) ON DELETE SET 
NULL, updated_by_profile_id uuid NULL REFERENCES public.profiles(id) ON DELETE 
SET NULL, CONSTRAINT translations_pkey PRIMARY KEY (id), CONSTRAINT 
translations_language_code_fkey FOREIGN KEY (language_code) REFERENCES 
public.languages_master (language_code) ON UPDATE CASCADE ON DELETE RESTRICT, 
CONSTRAINT translations_translated_by_profile_id_fkey FOREIGN KEY 
(translated_by_profile_id) REFERENCES public.profiles (id) ON DELETE SET NULL, 
CONSTRAINT uq_translation_entry UNIQUE (table_identifier, column_identifier, 
row_foreign_key, language_code), CONSTRAINT check_translation_status CHECK 
(translation_status IN ('draft', 'needs_review', 'published_live', 
'needs_update') OR translation_status IS NULL) ); -- Indexes CREATE INDEX 
idx_translations_lookup ON public.translations (table_identifier, 
column_identifier, row_foreign_key, language_code, translation_status); CREATE 
INDEX idx_translations_language_code ON public.translations (language_code); 
CREATE INDEX idx_translations_row_foreign_key ON public.translations 
(row_foreign_key); CREATE INDEX idx_translations_status_updated_at ON 
public.translations (translation_status, translation_last_updated_at) WHERE 
translation_status IS NOT NULL AND translation_last_updated_at IS NOT NULL; 
CREATE INDEX idx_translations_translated_by_profile_id ON public.translations 
(translated_by_profile_id) WHERE translated_by_profile_id IS NOT NULL; CREATE 
INDEX idx_translations_created_by_profile_id ON public.translations 
(created_by_profile_id) WHERE created_by_profile_id IS NOT NULL; CREATE INDEX 
idx_translations_updated_by_profile_id ON public.translations 
(updated_by_profile_id) WHERE updated_by_profile_id IS NOT NULL; -- Comments 
COMMENT ON TABLE public.translations IS 'Stores all translated textual content 
for specified fields from various tables, enabling multilingual support and 
audit trails. Version 2.1.'; COMMENT ON COLUMN 
public.translations.row_foreign_key IS 'Stores the PK of the source record as 
text. Integrity handled by parent table DELETE triggers.'; COMMENT ON COLUMN 
public.translations.translated_by_profile_id IS 'Profile ID of the user/agent 
who provided/last updated the translated_text content.'; COMMENT ON COLUMN 
public.translations.translation_last_updated_at IS 'Timestamp when 
translated_text or translation_status was last modified by a 
translator/editor.'; COMMENT ON COLUMN 
public.translations.created_by_profile_id IS 'Profile ID of the user/process 
that created this translation row. FK to profiles.id. ON DELETE SET NULL.'; 
COMMENT ON COLUMN public.translations.updated_by_profile_id IS 'Profile ID of 
the user/process that last updated this translation row metadata. FK to 
profiles.id. ON DELETE SET NULL.'; 4. Triggers/Functions -- Trigger for row 
updated_at timestamp CREATE TRIGGER handle_translations_updated_at BEFORE 
UPDATE ON public.translations FOR EACH ROW EXECUTE FUNCTION 
extensions.moddatetime('updated_at'); -- Or a custom public.handle_updated_at() 
-- Orphaned translation cleanup is handled by AFTER DELETE triggers on PARENT 
tables. 5. JSON Schema Mirror { "title": "translations", "description": "Stores 
translated content for fields from various tables, with audit trails. Version 
2.1.", "type": "object", "properties": { "id": { "type": "integer", "format": 
"int64", "description": "PK.", "readOnly": true }, "table_identifier": { 
"type": "string", "description": "Source table name." }, "column_identifier": { 
"type": "string", "description": "Source column name." }, "row_foreign_key": { 
"type": "string", "description": "Source record PK as text." }, 
"language_code": { "type": "string", "description": "FK to languages_master." 
}, "translated_text": { "type": "string", "description": "Translated content. 
Can be JSON array." }, "translation_status": { "type": ["string", "null"], 
"enum": ["draft", "needs_review", "published_live", "needs_update", null], 
"description": "Workflow status." }, "translated_by_profile_id": { "type": 
["string", "null"], "format": "uuid", "description": "Profile ID of 
translator/editor of content." }, "translation_last_updated_at": { "type": 
["string", "null"], "format": "date-time", "description": "Timestamp of last 
content/status change by translator." }, "created_at": { "type": "string", 
"format": "date-time", "description": "Row creation timestamp.", "readOnly": 
true }, "updated_at": { "type": "string", "format": "date-time", "description": 
"Row last update timestamp.", "readOnly": true }, "created_by_profile_id": { 
"type": ["string", "null"], "format": "uuid", "description": "Profile ID of row 
creator." }, "updated_by_profile_id": { "type": ["string", "null"], "format": 
"uuid", "description": "Profile ID of last row updater." } }, "required": [ 
"table_identifier", "column_identifier", "row_foreign_key", "language_code", 
"translated_text" ], "primary_key": ["id"], "unique_constraints": [ { 
"columns": ["table_identifier", "column_identifier", "row_foreign_key", 
"language_code"], "name": "uq_translation_entry" } ], "foreign_keys": [ 
{"columns": ["language_code"], "references_table": "public.languages_master", 
"references_columns": ["language_code"], "on_delete": "RESTRICT", "on_update": 
"CASCADE"}, {"columns": ["translated_by_profile_id"], "references_table": 
"public.profiles", "references_columns": ["id"], "on_delete": "SET NULL"}, 
{"columns": ["created_by_profile_id"], "references_table": "public.profiles", 
"references_columns": ["id"], "on_delete": "SET NULL"}, {"columns": 
["updated_by_profile_id"], "references_table": "public.profiles", 
"references_columns": ["id"], "on_delete": "SET NULL"} ] } 6. Relationships & 
Integrity Primary Key: `id` (bigint). `uq_translation_entry` ensures 
translation uniqueness per field/record/language. Foreign Keys: `language_code` 
(to `languages_master`), `translated_by_profile_id`, `created_by_profile_id`, 
`updated_by_profile_id` (to `profiles`). `row_foreign_key` integrity managed by 
parent table triggers. Mermaid ER Snippet: erDiagram languages_master { text 
language_code PK } profiles { uuid id PK } translations { bigint id PK text 
table_identifier text column_identifier text row_foreign_key text language_code 
FK uuid translated_by_profile_id FK uuid created_by_profile_id FK uuid 
updated_by_profile_id FK UQ "table_identifier, column_identifier, 
row_foreign_key, language_code" } translations }o--|| languages_master : 
"is_in_language" translations }o--o| profiles : "translated_by" translations 
}o--o| profiles : "row_created_by" translations }o--o| profiles : 
"row_updated_by" 7. Multilingual Strategy Central table for i18n. Application 
fetches based on user language, with fallback logic. 8. Role-Based Workflow & 
RLS Notes Key Fields: `translation_status`, `translated_by_profile_id`, 
`translation_last_updated_at`. RLS Policies: Public read for published/active. 
Admins manage all. Translator roles need specific policies. 9. ENUM vs Lookup 
Discussion `translation_status`: TEXT with CHECK constraint for V1. Future 
promotion to master table is an option. 10. UI/UX Enablement Provides 
translated content for UI. Admin interfaces use its columns for management. 
Indexes support query performance. 11. Auditing & Lifecycle Management Audit: 
`created_at`, `updated_at` (row). `created_by_profile_id`, 
`updated_by_profile_id` (row lifecycle). `translated_by_profile_id`, 
`translation_last_updated_at` (translation content lifecycle). Integrity: 
Orphan cleanup for `row_foreign_key` via parent table triggers is critical. 12. 
Scalability & Future-Proofing Can grow large. Indexing is vital. Partitioning 
is a V2+ option. 13. Seed Data âšª N/A - Translations are dynamic content, not 
seeded master data. 14. Next-Action Checklist â€¢ ðŸ”´ Create Table & Indexes: 
Execute DDL, including new audit columns and their indexes. â€¢ ðŸ”´ Implement 
`updated_at` Trigger (e.g., `extensions.moddatetime`). â€¢ ðŸ”´ Implement Orphaned 
Translation Cleanup Triggers: On **ALL** parent tables with translatable 
fields. â€¢ ðŸŸ  Define & Implement RLS Policies. â€¢ ðŸŸ¢ Document `column_identifier` 
conventions for all translatable entities. â€¢ ðŸŸ  Define Population Logic: For 
`created_by_profile_id`, `updated_by_profile_id` (if not by standard RLS/app 
context) and ensure `translated_by_profile_id` / `translation_last_updated_at` 
are correctly set by translation workflows. â€¢ ðŸŸ  Consider Full-Text Search on 
`translated_text` for V2+. â€¢ ðŸŸ¢ Review `translation_status` for promotion to a 
master table in future versions. 
