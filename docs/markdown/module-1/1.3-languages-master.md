# 1.3 languages_master

  
https://gemini.google.com/u/1/app/2c4ea8fa457b0abd?is_sa=1&android-min-version=3
01356232&ios-min-version=322.0&campaign_id=bkws&utm_source=google&utm_medium=cpc
&utm_campaign=2024enUS_gemfeb&pt=9008&mt=8&ct=p-growth-sem-bkws 
https://gemini.google.com/u/1/app/fd47ede3d905a3f2 
https://gemini.google.com/u/1/app/440838222ac514d7 Production-Ready 
Specification: public.languages_master Table Version: 2.1 (Checklist V2-05-17-B 
Applied) Date: 2025-05-17 1. Purpose & Primary Use-Cases Mission Statement: To 
define and manage all languages supported or planned for the pilgrimage 
platform, providing canonical language codes, display names, active status, 
identifying the primary reference language for content, and an optional UI icon 
identifier. Audit fields track creation and updates. Key User-Story 
Touchpoints: â€¢ Pilgrim (Anna): This table populates the language switcher UI, 
allowing her to select her `preferred_language_code`. â€¢ Platform Administrator: 
Manages language entries, including active status, primary language flag, UI 
icons, and changes are auditable. â€¢ System/Developer: Validates 
`profiles.preferred_language_code` and `translations.language_code` against 
this table. 2. Schema | column | data_type | constraints | description | | 
:---------------------------- | :------------------------ | 
:-------------------------------------------------------------------------------
----------------------------------- | 
:-------------------------------------------------------------------------------
--------------------------------------------------------------------------------
------------------------------------ | | language_code | text | Primary Key, 
Not Null, CHECK (`language_code` ~ '^[a-z]{2}(-[A-Z]{2})?$' AND 
char_length(`language_code`) >= 2 AND char_length(`language_code`) <= 5) | ðŸŸ¢ 
ISO 639-1 (2-letter, e.g., 'en', 'it') or IETF language tag (e.g., 'en-GB', 
'pt-BR'). Unique. Format and length enforced. | | display_name_native | text | 
Not Null | The name of the language in its own native script and language 
(e.g., "Italiano", "Deutsch"). | | display_name_en | text | Not Null | The 
common name of the language in English (e.g., "Italian", "German"). Used for 
consistent admin/developer reference. | | icon_identifier | text | Nullable | 
Optional identifier for a UI icon representing the language (e.g., a flag icon 
class name like 'flag-icon-it' or an SVG identifier). | | 
is_active_for_platform | boolean | Not Null, Default false | If true, this 
language is actively supported and available for users to select and for 
displaying translated content. | | is_primary_content_language | boolean | Not 
Null, Default false, Unique Partial Index `uq_one_primary_content_language` 
WHERE (`is_primary_content_language` = TRUE) | ðŸŸ  Flags the primary reference 
language (e.g., English). Content in this language is stored in main table 
columns. Only one language should have this true. | | display_order_ui | 
integer | Nullable, Unique (`uq_languages_master_display_order_ui`) | Optional 
order for displaying languages in a language switcher UI. Unique if set. | | 
created_at | timestamp with time zone | Not Null, Default `now()` | Timestamp 
of when this language record was created. | | updated_at | timestamp with time 
zone | Not Null, Default `now()` | Timestamp of when this language record was 
last updated (auto-updated by trigger). | | created_by_profile_id | uuid | 
Nullable, Foreign Key to `public.profiles(id)` ON DELETE SET NULL | Profile ID 
of the user who initially created this language entry. | | 
updated_by_profile_id | uuid | Nullable, Foreign Key to `public.profiles(id)` 
ON DELETE SET NULL | Profile ID of the user who last updated this language 
entry. | 3. PostgreSQL DDL -- Table Definition CREATE TABLE 
public.languages_master ( language_code text NOT NULL PRIMARY KEY, 
display_name_native text NOT NULL, display_name_en text NOT NULL, 
icon_identifier text NULL, is_active_for_platform boolean NOT NULL DEFAULT 
false, is_primary_content_language boolean NOT NULL DEFAULT false, 
display_order_ui integer NULL, created_at timestamp with time zone NOT NULL 
DEFAULT now(), updated_at timestamp with time zone NOT NULL DEFAULT now(), 
created_by_profile_id uuid NULL REFERENCES public.profiles(id) ON DELETE SET 
NULL, updated_by_profile_id uuid NULL REFERENCES public.profiles(id) ON DELETE 
SET NULL, CONSTRAINT check_language_code_format CHECK (language_code ~ 
'^[a-z]{2}(-[A-Z]{2})?$' AND char_length(language_code) >= 2 AND 
char_length(language_code) <= 5), CONSTRAINT 
uq_languages_master_display_order_ui UNIQUE (display_order_ui) ); -- Unique 
Partial Index to ensure only one language is the primary content language 
CREATE UNIQUE INDEX uq_one_primary_content_language ON public.languages_master 
(is_primary_content_language) WHERE (is_primary_content_language = TRUE); -- 
Index for UI ordering and active status CREATE INDEX 
idx_languages_master_active_order ON public.languages_master 
(is_active_for_platform, display_order_ui); -- Indexes for Audit FKs CREATE 
INDEX idx_languages_master_created_by_profile_id ON public.languages_master 
(created_by_profile_id) WHERE created_by_profile_id IS NOT NULL; CREATE INDEX 
idx_languages_master_updated_by_profile_id ON public.languages_master 
(updated_by_profile_id) WHERE updated_by_profile_id IS NOT NULL; -- Comments 
COMMENT ON TABLE public.languages_master IS 'Defines all languages supported or 
planned for the platform, including display names, active status, the primary 
reference language, and optional UI icon identifiers. Authoritative list for 
translations. Version 2.1.'; COMMENT ON COLUMN 
public.languages_master.language_code IS 'PK. ISO 639-1 (e.g., en, it) or IETF 
language tag (e.g., en-GB, pt-BR). Max length 5.'; COMMENT ON COLUMN 
public.languages_master.display_name_native IS 'The name of the language in its 
own native script and language (e.g., "Italiano", "Deutsch").'; COMMENT ON 
COLUMN public.languages_master.display_name_en IS 'The common name of the 
language in English (e.g., "Italian", "German"). For admin/developer 
reference.'; COMMENT ON COLUMN public.languages_master.icon_identifier IS 
'Optional identifier for a UI icon representing the language (e.g., a flag icon 
class name or an SVG identifier).'; COMMENT ON COLUMN 
public.languages_master.is_active_for_platform IS 'If true, language is 
actively supported and available for user selection and content display.'; 
COMMENT ON COLUMN public.languages_master.is_primary_content_language IS 'Flags 
the primary reference language. Content in this language is stored in main 
table columns. Only one can be true (enforced by partial unique index).'; 
COMMENT ON COLUMN public.languages_master.display_order_ui IS 'Optional unique 
order for displaying languages in UI selectors. Nullable, but unique if 
provided.'; COMMENT ON COLUMN public.languages_master.created_at IS 'Timestamp 
of when this language record was created.'; COMMENT ON COLUMN 
public.languages_master.updated_at IS 'Timestamp of when this language record 
was last updated (auto-updated by trigger).'; COMMENT ON COLUMN 
public.languages_master.created_by_profile_id IS 'Profile ID of the user who 
initially created this language entry. FK to profiles.id. ON DELETE SET NULL.'; 
COMMENT ON COLUMN public.languages_master.updated_by_profile_id IS 'Profile ID 
of the user who last updated this language entry. FK to profiles.id. ON DELETE 
SET NULL.'; 4. Triggers/Functions -- Trigger for updated_at timestamp CREATE 
TRIGGER handle_languages_master_updated_at BEFORE UPDATE ON 
public.languages_master FOR EACH ROW EXECUTE FUNCTION 
extensions.moddatetime('updated_at'); -- Using Supabase standard -- Note: The 
`public.handle_updated_at()` mentioned in Checklist II.5 should also set 
`updated_by_profile_id = auth.uid()` if a unified trigger is used. -- If using 
`extensions.moddatetime`, `updated_by_profile_id` needs to be set by 
application logic or a separate, more specific trigger if admins are editing 
directly via SQL or an interface that doesn't automatically pass the user ID. 
-- For master tables usually updated by migrations or superadmin, this might be 
less critical or handled during those specific operations. 5. JSON Schema 
Mirror { "title": "language_master", "description": "Defines all languages 
supported or planned for the platform, including their display names, active 
status, the designation of a primary reference language, optional UI icon 
identifiers, and audit fields. Version 2.1.", "type": "object", "properties": { 
"language_code": { "type": "string", "description": "Primary Key. ISO 639-1 
code or IETF tag (e.g., 'en', 'it', 'en-US'). Unique and follows pattern: 
2-letter base, optionally followed by hyphen and 2-letter region. Min length 2, 
Max length 5.", "pattern": "^[a-z]{2}(-[A-Z]{2})?$", "minLength": 2, 
"maxLength": 5 }, "display_name_native": { "type": "string", "description": 
"Name of the language in its own native script and language." }, 
"display_name_en": { "type": "string", "description": "Common name of the 
language in English. Used for consistent admin/developer reference." }, 
"icon_identifier": { "type": ["string", "null"], "description": "Optional 
identifier for a UI icon representing the language." }, 
"is_active_for_platform": { "type": "boolean", "default": false, "description": 
"If true, this language is actively supported for user selection and content 
display." }, "is_primary_content_language": { "type": "boolean", "default": 
false, "description": "Flags the primary reference language. Only one language 
should be true." }, "display_order_ui": { "type": ["integer", "null"], 
"description": "Optional order for displaying languages in UI. Must be unique 
if set." }, "created_at": { "type": "string", "format": "date-time", 
"description": "Timestamp of record creation.", "readOnly": true }, 
"updated_at": { "type": "string", "format": "date-time", "description": 
"Timestamp of last record update.", "readOnly": true }, 
"created_by_profile_id": { "type": ["string", "null"], "format": "uuid", 
"description": "Profile ID of the user who created the entry." }, 
"updated_by_profile_id": { "type": ["string", "null"], "format": "uuid", 
"description": "Profile ID of the user who last updated the entry." } }, 
"required": [ "language_code", "display_name_native", "display_name_en", 
"is_active_for_platform", "is_primary_content_language" ], "primary_key": 
["language_code"], "unique_constraints": [ {"columns": ["display_order_ui"], 
"name": "uq_languages_master_display_order_ui", "allow_null_results": true}, 
{"columns": ["is_primary_content_language"], "name": 
"uq_one_primary_content_language", "where_clause": "is_primary_content_language 
= TRUE"} ], "foreign_keys": [ {"columns": ["created_by_profile_id"], 
"references_table": "public.profiles", "references_columns": ["id"], 
"on_delete": "SET NULL"}, {"columns": ["updated_by_profile_id"], 
"references_table": "public.profiles", "references_columns": ["id"], 
"on_delete": "SET NULL"} ] } 6. Relationships & Integrity Primary Key: 
`language_code` (text). Foreign Keys: â€¢ `created_by_profile_id` references 
`public.profiles(id)`: ON DELETE SET NULL. â€¢ `updated_by_profile_id` references 
`public.profiles(id)`: ON DELETE SET NULL. Incoming Foreign Keys (from other 
tables): â€¢ `profiles.preferred_language_code` references 
`languages_master(language_code)`: ON UPDATE CASCADE ON DELETE RESTRICT. â€¢ 
`translations.language_code` references `languages_master(language_code)`: ON 
UPDATE CASCADE ON DELETE RESTRICT. â€¢ ðŸŸ¢ `ON DELETE RESTRICT` on incoming FKs is 
critical. Junction/Lookup Tables: This table *is* a lookup table. Mermaid ER 
Snippet: erDiagram profiles { uuid id PK } languages_master { text 
language_code PK text display_name_native text display_name_en text 
icon_identifier boolean is_active_for_platform boolean 
is_primary_content_language "Partial UK (TRUE)" integer display_order_ui UK 
uuid created_by_profile_id FK uuid updated_by_profile_id FK timestamp 
created_at timestamp updated_at } translations { text language_code FK } 
profiles }o--|| languages_master : "prefers language" translations }o--|| 
languages_master : "is in language" languages_master }o--o| profiles : 
"created_by (admin)" languages_master }o--o| profiles : "updated_by (admin)" 7. 
Multilingual Strategy ðŸŸ¢ This table is a cornerstone of the multilingual 
strategy. Its flags and codes drive UI and content retrieval. 8. Role-Based 
Workflow & RLS Notes Key Fields for Roles/Workflows: `is_active_for_platform`, 
`is_primary_content_language` (Managed by Admins). Recommended 
Row-Level-Security (RLS) Policies: â€¢ ðŸŸ¢ Policy 1: Allow public read access to 
all language definitions. ```sql CREATE POLICY "select_all_languages" ON 
public.languages_master FOR SELECT USING (true); ``` â€¢ ðŸŸ¢ Policy 2: Allow 
admins to manage (CRUD) language definitions. ```sql CREATE POLICY 
"admin_manage_all_languages" ON public.languages_master FOR ALL USING 
(public.has_role('admin_platform') OR public.has_role('admin_super')) -- 
Example roles WITH CHECK (public.has_role('admin_platform') OR 
public.has_role('admin_super')); ``` ðŸŸ  Caution: `ON DELETE RESTRICT` on 
incoming FKs prevents deletion if referenced. `is_active_for_platform = false` 
is preferred for retiring. 9. ENUM vs Lookup Discussion ðŸŸ¢ This table *is* a 
lookup table. Appropriate for its purpose. 10. UI/UX Enablement Columns 
powering UI: `language_code`, `display_name_native`, `icon_identifier`, 
`is_active_for_platform`, `display_order_ui`. Indexed Fields for UX 
Performance: PK, `uq_languages_master_display_order_ui`, 
`idx_languages_master_active_order`. 11. Auditing & Lifecycle Management Audit 
Columns: `created_at`, `updated_at` (auto-managed by trigger). 
`created_by_profile_id`, `updated_by_profile_id` added for admin change 
tracking. Lifecycle: Managed by `is_active_for_platform`. 12. Scalability & 
Future-Proofing Scalability: Table will remain small and performant. 
Future-Proofing: Structure is robust. 13. Seed Data (V1) | language_code | 
display_name_native | display_name_en | icon_identifier | 
is_active_for_platform | is_primary_content_language | display_order_ui | 
created_by_profile_id | updated_by_profile_id | | :------------ | 
:------------------ | :-------------- | :---------------- | 
:--------------------- | :-------------------------- | :--------------- | 
:-------------------- | :-------------------- | | 'en' | 'English' | 'English' 
| 'flag-icon-gb' | true | true | 1 | `[ADMIN_UUID]` | `[ADMIN_UUID]` | | 'it' | 
'Italiano' | 'Italian' | 'flag-icon-it' | true | false | 2 | `[ADMIN_UUID]` | 
`[ADMIN_UUID]` | | 'de' | 'Deutsch' | 'German' | 'flag-icon-de' | false | false 
| 3 | `[ADMIN_UUID]` | `[ADMIN_UUID]` | | 'nl' | 'Nederlands' | 'Dutch' | 
'flag-icon-nl' | false | false | 4 | `[ADMIN_UUID]` | `[ADMIN_UUID]` | | 'es' | 
'EspaÃ±ol' | 'Spanish' | 'flag-icon-es' | false | false | 5 | `[ADMIN_UUID]` | 
`[ADMIN_UUID]` | | 'fr' | 'FranÃ§ais' | 'French' | 'flag-icon-fr' | false | 
false | 6 | `[ADMIN_UUID]` | `[ADMIN_UUID]` | *(Note: `[ADMIN_UUID]` is a 
placeholder for the actual UUID of an admin/system user profile responsible for 
initial data seeding.)* 14. Next-Action Checklist â€¢ ðŸ”´ Create Table: Execute 
the `CREATE TABLE public.languages_master (...)` DDL with new audit columns. â€¢ 
ðŸ”´ Create Unique Partial Index `uq_one_primary_content_language`. â€¢ ðŸŸ¢ Create 
Additional Indexes `idx_languages_master_active_order`, and indexes for audit 
FKs. â€¢ ðŸ”´ Implement `updated_at` Trigger using `extensions.moddatetime`. â€¢ ðŸ”´ 
Pre-populate Seed Data: Insert initial V1 languages as defined in Section 13. â€¢ 
ðŸŸ¢ Define `icon_identifier` convention and source for assets. â€¢ ðŸŸ  Define how 
`created_by_profile_id` and `updated_by_profile_id` will be populated (e.g., 
application layer during admin operations, or manually during migrations for 
initial seed). 
