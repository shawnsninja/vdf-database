# 4.19 transport_stops_details

  
https://gemini.google.com/u/1/app/bf28f389cd093e55?is_sa=1&android-min-version=3
01356232&ios-min-version=322.0&campaign_id=bkws&utm_source=google&utm_medium=cpc
&utm_campaign=2024enUS_gemfeb&pt=9008&mt=8&ct=p-growth-sem-bkws 
https://gemini.google.com/u/1/app/b90970622259e225 * * * * * ### 3\. Updated 
Production-Ready Specification - `public.transport_stops_details` (V2.1) 
Version: 2.1 (Based on original V1.1, V2.1 Checklist REV 05-18-25-A applied) 
Date: May 18, 2025 1. Purpose & Primary Use-Cases The transport_stops_details 
table stores specific, detailed information for waypoints categorized as public 
transportation stops. It extends the generic waypoints entry to identify the 
stop type, operators, key lines/destinations, facilities, ticketing 
information, and provide crucial links to external official timetables. This 
supports pilgrims in planning journeys by finding detailed stop information, 
accessing timetables, identifying facilities, and understanding ticketing. 
Administrators curate and maintain this data. 2. Schema | column | data_type | 
constraints | description | | :------------------------------------- | 
:------------------------ | 
:-------------------------------------------------------------------------------
--------------------------------------------------------- | 
:-------------------------------------------------------------------------------
------------------------------------------------------------ | | waypoint_id | 
bigint | Primary Key, Foreign Key to waypoints(id) ON DELETE CASCADE | Links to 
the generic waypoints table. This is the PK. | | stop_type_id | integer | Not 
Null, Foreign Key to transport_stop_types_master(id) ON DELETE RESTRICT | The 
specific type of transport stop, linking to transport_stop_types_master. | | 
operator_names_text | text[] | Nullable | Array of main transport company names 
operating at this stop (free text). Elements are translatable. V2.1. | | 
operator_stop_code_primary | text | Nullable, CHECK (operator_stop_code_primary 
IS NULL OR (length(operator_stop_code_primary) > 0 AND 
length(operator_stop_code_primary) &lt;= 50)) | Official internal stop code 
used by the primary operator, if known. | | gtfs_stop_id | text | Nullable, 
Unique, CHECK (gtfs_stop_id IS NULL OR (length(gtfs_stop_id) > 0 AND 
length(gtfs_stop_id) &lt;= 100)) | General Transit Feed Specification (GTFS) 
stop_id, if available. Unique if populated. | | lines_or_routes_served_summary 
| text | Nullable | Human-readable summary of key lines, route numbers, or 
major destinations served. (Translatable via public.translations) | | 
specific_timetable_url | text | Nullable, CHECK (specific_timetable_url IS NULL 
OR (length(specific_timetable_url) &lt;= 2048 AND specific_timetable_url ~* 
'^https?://.+')) | Direct deep link to an online timetable page for this 
specific stop or a key line. | | general_operator_info_url | text | Nullable, 
CHECK (general_operator_info_url IS NULL OR (length(general_operator_info_url) 
&lt;= 2048 AND general_operator_info_url ~* '^https?://.+')) | Link to the 
general information/journey planner page of the primary operator. | | 
ticketing_information_notes | text | Nullable | Notes on where and how to buy 
tickets. (Translatable via public.translations) | | stop_facility_ids | 
integer[] | Nullable | Array of Foreign Keys to 
transport_stop_facilities_master(id), indicating available facilities. 
Validated by trigger. | | platform_track_bay_information_notes | text | 
Nullable | For larger stations, notes about typical platform/track/bay 
assignments. (Translatable via public.translations) | | 
frequency_of_service_general_notes | text | Nullable | General notes on service 
frequency. Specific times via operator URL. (Translatable via 
public.translations) | | is_major_interchange_node | boolean | Not Null, 
Default false | Flags if this stop is a significant interchange point. | | 
accessibility_notes_transport_stop | text | Nullable | Notes on the 
accessibility of the station/stop itself. (Translatable via 
public.translations) | | bicycle_transport_on_service_notes | text | Nullable | 
Information on bicycle transport conditions/fees. (Translatable via 
public.translations) | | notes_for_pilgrims_at_stop | text | Nullable | 
Specific advice or tips for pilgrims using this stop. (Translatable via 
public.translations) | | data_last_verified_at | timestamp with time zone | 
Nullable | Timestamp when details (especially URLs, operator info) were last 
editorially verified. | | created_at | timestamp with time zone | Not Null, 
Default now() | Timestamp of record creation. | | created_by_profile_id | uuid 
| Nullable, Foreign Key to profiles(id) ON DELETE SET NULL | Profile ID of the 
user who created this record. | | updated_at | timestamp with time zone | Not 
Null, Default now() | Timestamp of last update (auto-updated by trigger). | | 
updated_by_profile_id | uuid | Nullable, Foreign Key to profiles(id) ON DELETE 
SET NULL | Profile ID of the user who last updated this record. | | deleted_at 
| timestamp with time zone | Nullable | Timestamp for soft deletion (though 
usually cascaded from waypoints). | 3. PostgreSQL DDL SQL ``` -- Assumes master 
tables: -- public.waypoints (with id BIGINT PK, content_visibility_status_id FK 
to content_statuses_master) -- public.transport_stop_types_master (with id 
INTEGER PK, is_active BOOLEAN) -- public.transport_stop_facilities_master (with 
id INTEGER PK, is_active BOOLEAN) -- public.profiles (with id UUID PK) -- 
public.content_statuses_master (with id BIGINT PK, code TEXT UNIQUE) -- Assumes 
functions: -- public.set_current_timestamp_updated_at() OR 
extensions.moddatetime() -- public.cleanup_related_translations(TEXT, TEXT) -- 
public.has_role(TEXT) CREATE TABLE public.transport_stops_details ( waypoint_id 
BIGINT PRIMARY KEY, stop_type_id INTEGER NOT NULL, operator_names_text TEXT[] 
NULL, operator_stop_code_primary TEXT NULL CHECK (operator_stop_code_primary IS 
NULL OR (length(operator_stop_code_primary) > 0 AND 
length(operator_stop_code_primary) <= 50)), gtfs_stop_id TEXT NULL UNIQUE CHECK 
(gtfs_stop_id IS NULL OR (length(gtfs_stop_id) > 0 AND length(gtfs_stop_id) <= 
100)), lines_or_routes_served_summary TEXT NULL, specific_timetable_url TEXT 
NULL CHECK (specific_timetable_url IS NULL OR (length(specific_timetable_url) 
<= 2048 AND specific_timetable_url ~* '^https?://.+')), 
general_operator_info_url TEXT NULL CHECK (general_operator_info_url IS NULL OR 
(length(general_operator_info_url) <= 2048 AND general_operator_info_url ~* 
'^https?://.+')), ticketing_information_notes TEXT NULL, stop_facility_ids 
INTEGER[] NULL, platform_track_bay_information_notes TEXT NULL, 
frequency_of_service_general_notes TEXT NULL, is_major_interchange_node BOOLEAN 
NOT NULL DEFAULT FALSE, accessibility_notes_transport_stop TEXT NULL, 
bicycle_transport_on_service_notes TEXT NULL, notes_for_pilgrims_at_stop TEXT 
NULL, data_last_verified_at TIMESTAMPTZ NULL, created_at TIMESTAMPTZ NOT NULL 
DEFAULT now(), created_by_profile_id UUID NULL, updated_at TIMESTAMPTZ NOT NULL 
DEFAULT now(), updated_by_profile_id UUID NULL, deleted_at TIMESTAMPTZ NULL, 
CONSTRAINT fk_waypoint FOREIGN KEY(waypoint_id) REFERENCES public.waypoints(id) 
ON DELETE CASCADE, CONSTRAINT fk_stop_type FOREIGN KEY(stop_type_id) REFERENCES 
public.transport_stop_types_master(id) ON DELETE RESTRICT, CONSTRAINT 
fk_created_by_profile FOREIGN KEY(created_by_profile_id) REFERENCES 
public.profiles(id) ON DELETE SET NULL, CONSTRAINT fk_updated_by_profile 
FOREIGN KEY(updated_by_profile_id) REFERENCES public.profiles(id) ON DELETE SET 
NULL ); COMMENT ON TABLE public.transport_stops_details IS 'Specific details 
for public transport stops, extending waypoints. Version 2.1'; COMMENT ON 
COLUMN public.transport_stops_details.waypoint_id IS 'PK. Links to the generic 
waypoints table. ON DELETE CASCADE. V2.1'; COMMENT ON COLUMN 
public.transport_stops_details.stop_type_id IS 'FK to 
transport_stop_types_master.id. Specific type of transport stop. ON DELETE 
RESTRICT. V2.1'; COMMENT ON COLUMN 
public.transport_stops_details.operator_names_text IS 'Array of main transport 
company names (free text for V2.1). Elements are translatable. V2.1'; COMMENT 
ON COLUMN public.transport_stops_details.operator_stop_code_primary IS 
'Official internal stop code used by the primary operator. Max 50 chars. V2.1'; 
COMMENT ON COLUMN public.transport_stops_details.gtfs_stop_id IS 'General 
Transit Feed Specification (GTFS) stop_id. Unique if populated. Max 100 chars. 
V2.1'; COMMENT ON COLUMN 
public.transport_stops_details.lines_or_routes_served_summary IS 
'Human-readable summary of key lines/routes served. (Translatable via 
public.translations). V2.1'; COMMENT ON COLUMN 
public.transport_stops_details.specific_timetable_url IS 'Direct deep link to 
online timetable for this specific stop/line. Validated URL format. Max 2048 
chars. V2.1'; COMMENT ON COLUMN 
public.transport_stops_details.general_operator_info_url IS 'Link to general 
timetable/journey planner of primary operator. Validated URL format. Max 2048 
chars. V2.1'; COMMENT ON COLUMN 
public.transport_stops_details.ticketing_information_notes IS 'Notes on where 
and how to buy tickets. (Translatable via public.translations). V2.1'; COMMENT 
ON COLUMN public.transport_stops_details.stop_facility_ids IS 'Array of FKs to 
transport_stop_facilities_master.id. Available facilities. Validated by trigger 
(checks existence and is_active status). V2.1'; COMMENT ON COLUMN 
public.transport_stops_details.platform_track_bay_information_notes IS 'Notes 
on platform/track/bay assignments. (Translatable via public.translations). 
V2.1'; COMMENT ON COLUMN 
public.transport_stops_details.frequency_of_service_general_notes IS 'General 
notes on service frequency. (Translatable via public.translations). V2.1'; 
COMMENT ON COLUMN public.transport_stops_details.is_major_interchange_node IS 
'Flags if this stop is a significant interchange point. NOT NULL DEFAULT FALSE. 
V2.1'; COMMENT ON COLUMN 
public.transport_stops_details.accessibility_notes_transport_stop IS 'Notes on 
accessibility of the stop itself. (Translatable via public.translations). 
V2.1'; COMMENT ON COLUMN 
public.transport_stops_details.bicycle_transport_on_service_notes IS 
'Information on bicycle transport conditions/fees. (Translatable via 
public.translations). V2.1'; COMMENT ON COLUMN 
public.transport_stops_details.notes_for_pilgrims_at_stop IS 'Specific advice 
for pilgrims using this stop. (Translatable via public.translations). V2.1'; 
COMMENT ON COLUMN public.transport_stops_details.data_last_verified_at IS 
'Timestamp when details (especially URLs, operator info) were last editorially 
verified. V2.1'; COMMENT ON COLUMN public.transport_stops_details.created_at IS 
'Timestamp of record creation. NOT NULL DEFAULT now(). V2.1'; COMMENT ON COLUMN 
public.transport_stops_details.created_by_profile_id IS 'Profile ID of the user 
who created this record. FK to public.profiles(id) ON DELETE SET NULL. V2.1'; 
COMMENT ON COLUMN public.transport_stops_details.updated_at IS 'Timestamp of 
last update. Auto-updated by trigger. NOT NULL DEFAULT now(). V2.1'; COMMENT ON 
COLUMN public.transport_stops_details.updated_by_profile_id IS 'Profile ID of 
the user who last updated this record. FK to public.profiles(id) ON DELETE SET 
NULL. V2.1'; COMMENT ON COLUMN public.transport_stops_details.deleted_at IS 
'Timestamp for soft deletion (usually cascaded from waypoints). V2.1'; -- 
Indexes CREATE INDEX ix_transport_stops_details_stop_type_id ON 
public.transport_stops_details(stop_type_id); CREATE INDEX 
ix_transport_stops_details_gtfs_stop_id ON 
public.transport_stops_details(gtfs_stop_id) WHERE gtfs_stop_id IS NOT NULL; 
CREATE INDEX ix_transport_stops_details_facility_ids ON 
public.transport_stops_details USING GIN (stop_facility_ids) WHERE 
stop_facility_ids IS NOT NULL AND array_length(stop_facility_ids, 1) > 0; 
CREATE INDEX ix_transport_stops_details_deleted_at ON 
public.transport_stops_details(deleted_at) WHERE deleted_at IS NOT NULL; CREATE 
INDEX ix_transport_stops_details_created_by_profile_id ON 
public.transport_stops_details (created_by_profile_id) WHERE 
created_by_profile_id IS NOT NULL; CREATE INDEX 
ix_transport_stops_details_updated_by_profile_id ON 
public.transport_stops_details (updated_by_profile_id) WHERE 
updated_by_profile_id IS NOT NULL; -- Triggers CREATE TRIGGER 
trigger_transport_stops_details_set_updated_at BEFORE UPDATE ON 
public.transport_stops_details FOR EACH ROW EXECUTE FUNCTION 
public.set_current_timestamp_updated_at(); -- Or extensions.moddatetime() 
COMMENT ON TRIGGER trigger_transport_stops_details_set_updated_at ON 
public.transport_stops_details IS 'Trigger to automatically update updated_at 
timestamp on row modification. V2.1'; CREATE OR REPLACE FUNCTION 
public.check_transport_stop_facility_ids() RETURNS TRIGGER AS $$ DECLARE 
facility_id INTEGER; facility_record RECORD; -- Used to fetch is_active status 
BEGIN -- Only run the check if stop_facility_ids is actually being changed IF 
TG_OP = 'INSERT' OR (TG_OP = 'UPDATE' AND NEW.stop_facility_ids IS DISTINCT 
FROM OLD.stop_facility_ids) THEN IF NEW.stop_facility_ids IS NOT NULL AND 
array_length(NEW.stop_facility_ids, 1) > 0 THEN FOREACH facility_id IN ARRAY 
NEW.stop_facility_ids LOOP SELECT tsfm.is_active INTO facility_record FROM 
public.transport_stop_facilities_master tsfm WHERE tsfm.id = facility_id; IF 
NOT FOUND THEN RAISE EXCEPTION 'Invalid facility ID "%" in stop_facility_ids. 
It does not exist in transport_stop_facilities_master.', facility_id; END IF; 
IF facility_record.is_active IS NOT TRUE THEN -- Check if the fetched is_active 
status is true RAISE EXCEPTION 'Facility ID "%" in stop_facility_ids is not 
active in transport_stop_facilities_master.', facility_id; END IF; END LOOP; 
END IF; END IF; RETURN NEW; END; $$ LANGUAGE plpgsql SECURITY DEFINER SET 
search_path = public; -- Hardened search_path for SECURITY DEFINER COMMENT ON 
FUNCTION public.check_transport_stop_facility_ids() IS 'Ensures that all 
facility IDs in transport_stops_details.stop_facility_ids exist and are active 
in transport_stop_facilities_master. SECURITY DEFINER. V2.1.'; CREATE TRIGGER 
trigger_check_transport_stop_facility_ids BEFORE INSERT OR UPDATE OF 
stop_facility_ids ON public.transport_stops_details FOR EACH ROW EXECUTE 
FUNCTION public.check_transport_stop_facility_ids(); COMMENT ON TRIGGER 
trigger_check_transport_stop_facility_ids ON public.transport_stops_details IS 
'Before insert or update of stop_facility_ids, validates elements against 
transport_stop_facilities_master (existence and is_active status). V2.1.'; 
CREATE TRIGGER trigger_cleanup_transport_stops_details_translations AFTER 
DELETE ON public.transport_stops_details FOR EACH ROW EXECUTE FUNCTION 
public.cleanup_related_translations('transport_stops_details', 'waypoint_id'); 
COMMENT ON TRIGGER trigger_cleanup_transport_stops_details_translations ON 
public.transport_stops_details IS 'After deleting a transport_stops_details 
record, remove its associated entries from the translations table using 
waypoint_id as row_foreign_key. V2.1.'; ``` 4. JSON Schema Mirror JSON ``` { 
"title": "transport_stop_detail", "description": "Stores specific details for 
waypoints that are public transportation stops, focusing on operational info 
and links to authoritative schedules. Version 2.1", "type": "object", 
"properties": { "waypoint_id": { "type": "integer", "format": "int64", 
"description": "PK, FK to waypoints.id (BIGINT). ON DELETE CASCADE." }, 
"stop_type_id": { "type": "integer", "description": "FK to 
transport_stop_types_master.id. Specific type of transport stop. NOT NULL. ON 
DELETE RESTRICT." }, "operator_names_text": { "type": ["array", "null"], 
"items": { "type": "string" }, "description": "Array of main transport company 
names (free text for V2.1). Elements are translatable." }, 
"operator_stop_code_primary": { "type": ["string", "null"], "maxLength": 50, 
"pattern": "^(?!\s*$).+", "description": "Official internal stop code used by 
the primary operator. Must not be empty if not NULL." }, "gtfs_stop_id": { 
"type": ["string", "null"], "maxLength": 100, "pattern": "^(?!\s*$).+", 
"description": "GTFS stop_id, unique if populated. Must not be empty if not 
NULL." }, "lines_or_routes_served_summary": { "type": ["string", "null"], 
"description": "Human-readable summary of key lines/routes served. 
(Translatable via public.translations)." }, "specific_timetable_url": { "type": 
["string", "null"], "format": "url", "maxLength": 2048, "pattern": 
"^https?://.+", "description": "Direct deep link to online timetable for this 
stop/line. Validated URL." }, "general_operator_info_url": { "type": ["string", 
"null"], "format": "url", "maxLength": 2048, "pattern": "^https?://.+", 
"description": "Link to general timetable/journey planner of primary operator. 
Validated URL." }, "ticketing_information_notes": { "type": ["string", "null"], 
"description": "Notes on where and how to buy tickets. (Translatable via 
public.translations)." }, "stop_facility_ids": { "type": ["array", "null"], 
"items": { "type": "integer" }, "description": "Array of FKs to 
transport_stop_facilities_master.id. Available facilities. Validated by trigger 
(checks existence and is_active status)." }, 
"platform_track_bay_information_notes": { "type": ["string", "null"], 
"description": "Notes on platform/track/bay assignments. (Translatable via 
public.translations)." }, "frequency_of_service_general_notes": { "type": 
["string", "null"], "description": "General notes on service frequency. 
(Translatable via public.translations)." }, "is_major_interchange_node": { 
"type": "boolean", "default": false, "description": "Flags if this stop is a 
significant interchange point. NOT NULL." }, 
"accessibility_notes_transport_stop": { "type": ["string", "null"], 
"description": "Notes on accessibility of the stop. (Translatable via 
public.translations)." }, "bicycle_transport_on_service_notes": { "type": 
["string", "null"], "description": "Info on bicycle transport. (Translatable 
via public.translations)." }, "notes_for_pilgrims_at_stop": { "type": 
["string", "null"], "description": "Specific advice for pilgrims at this stop. 
(Translatable via public.translations)." }, "data_last_verified_at": { "type": 
["string", "null"], "format": "date-time", "description": "Timestamp when 
details (URLs, operator info) were last editorially verified." }, "created_at": 
{ "type": "string", "format": "date-time", "description": "Timestamp of record 
creation. NOT NULL DEFAULT now().", "readOnly": true }, 
"created_by_profile_id": { "type": ["string", "null"], "format": "uuid", 
"description": "Profile ID of the user who created this record. FK to 
public.profiles(id) ON DELETE SET NULL." }, "updated_at": { "type": "string", 
"format": "date-time", "description": "Timestamp of last update. Auto-updated 
by trigger. NOT NULL DEFAULT now().", "readOnly": true }, 
"updated_by_profile_id": { "type": ["string", "null"], "format": "uuid", 
"description": "Profile ID of the user who last updated this record. FK to 
public.profiles(id) ON DELETE SET NULL." }, "deleted_at": { "type": ["string", 
"null"], "format": "date-time", "description": "Timestamp for soft deletion 
(usually cascaded from waypoints).", "readOnly": true } }, "required": 
["waypoint_id", "stop_type_id", "is_major_interchange_node", "created_at", 
"updated_at"], "primary_key": ["waypoint_id"], "unique_constraints": [ 
{"columns": ["gtfs_stop_id"], "name": 
"transport_stops_details_gtfs_stop_id_key", "allow_null_results": true} ], 
"foreign_keys": [ {"columns": ["waypoint_id"], "references_table": 
"public.waypoints", "references_columns": ["id"], "on_delete": "CASCADE"}, 
{"columns": ["stop_type_id"], "references_table": 
"public.transport_stop_types_master", "references_columns": ["id"], 
"on_delete": "RESTRICT"}, {"columns": ["created_by_profile_id"], 
"references_table": "public.profiles", "references_columns": ["id"], 
"on_delete": "SET NULL"}, {"columns": ["updated_by_profile_id"], 
"references_table": "public.profiles", "references_columns": ["id"], 
"on_delete": "SET NULL"} ] } ``` 5. Relationships & Integrity - Primary Key: 
`waypoint_id` (BIGINT). - Foreign Keys: - `waypoint_id` references 
`public.waypoints(id)` ON DELETE CASCADE. - `stop_type_id` references 
`public.transport_stop_types_master(id)` ON DELETE RESTRICT. - 
`created_by_profile_id` references `public.profiles(id)` ON DELETE SET NULL. - 
`updated_by_profile_id` references `public.profiles(id)` ON DELETE SET NULL. - 
Array Foreign Keys: `stop_facility_ids` (integer[]) contains IDs referencing 
`transport_stop_facilities_master(id)`. Integrity (existence and `is_active` 
status) is enforced by the `trigger_check_transport_stop_facility_ids` database 
trigger. - Unique Constraints: `gtfs_stop_id` (nullable unique). 6. 
Multilingual Strategy - Directly Translatable Fields: `operator_names_text` 
(elements), `lines_or_routes_served_summary`, `ticketing_information_notes`, 
`platform_track_bay_information_notes`, `frequency_of_service_general_notes`, 
`accessibility_notes_transport_stop`, `bicycle_transport_on_service_notes`, 
`notes_for_pilgrims_at_stop`. These store their primary language (English) 
content directly in this table; translations are managed in 
`public.translations`. - Via Master Tables: `stop_type_id` (label from 
`transport_stop_types_master`) and `stop_facility_ids` (labels from 
`transport_stop_facilities_master`) provide translatable content through their 
linked master tables. - Orphan Cleanup: An `AFTER DELETE` trigger 
(`trigger_cleanup_transport_stops_details_translations`) ensures associated 
translations are removed. 7. Role-Based Workflow & RLS Notes - Content 
Management: Typically managed by Regional Content Managers or Platform 
Administrators. - RLS Policies: - 🟢 Public users can read details for 
waypoints that are published (e.g., `content_statuses_master.code = 
'published_live'`) and not soft-deleted, via a join to `waypoints` and 
`content_statuses_master`. SQL ``` CREATE POLICY 
"select_published_transport_stop_details" ON public.transport_stops_details FOR 
SELECT USING ( EXISTS ( SELECT 1 FROM public.waypoints w JOIN 
public.content_statuses_master csm ON w.content_visibility_status_id = csm.id 
WHERE w.id = transport_stops_details.waypoint_id AND w.deleted_at IS NULL AND 
csm.code = 'published_live' -- Standard V2.1 published code ) ); ``` - 🟢 
Authorized roles (e.g., `admin_platform`, `regional_content_manager`) can 
manage all aspects of `transport_stops_details` records linked to non-deleted 
waypoints. `waypoint_id` cannot be changed on update. SQL ``` CREATE POLICY 
"manage_transport_stop_details_for_authorized_roles" ON 
public.transport_stops_details FOR ALL USING ( 
(public.has_role('admin_platform') OR 
public.has_role('regional_content_manager')) AND EXISTS (SELECT 1 FROM 
public.waypoints w WHERE w.id = transport_stops_details.waypoint_id AND 
w.deleted_at IS NULL) ) WITH CHECK ( (public.has_role('admin_platform') OR 
public.has_role('regional_content_manager')) AND EXISTS (SELECT 1 FROM 
public.waypoints w WHERE w.id = transport_stops_details.waypoint_id AND 
w.deleted_at IS NULL) AND (TG_OP = 'INSERT' OR waypoint_id IS NOT DISTINCT FROM 
OLD.waypoint_id) ); ``` - RLS relies on helper functions 
`public.has_role(TEXT)` and assumes `waypoints.content_visibility_status_id` 
correctly links to a `content_statuses_master` table with a `code` column. 8. 
ENUM vs Lookup Discussion 🟢 stop_type_id correctly references 
transport_stop_types_master (promoted from an ENUM). 🟢 stop_facility_ids 
correctly references transport_stop_facilities_master (promoted from an ENUM 
array). Reason: Provides richer data, translatability, UI support (icons, 
descriptions), and maintainability for these classifications. 9. UI/UX 
Enablement - Icons & Filters: `stop_type_id` and `stop_facility_ids` (via their 
master tables) drive UI icons and filtering capabilities. - Key Information 
Display: Crucial fields for pilgrim planning include `operator_names_text`, 
`lines_or_routes_served_summary`, URLs, and notes on ticketing and frequency. - 
Important Flags: `is_major_interchange_node` highlights key transfer points. 
10. Auditing & Lifecycle Management - Standard Audit Columns: `created_at`, 
`updated_at` (auto-updated), `created_by_profile_id`, `updated_by_profile_id`. 
- Specific Audit: `data_last_verified_at` for tracking freshness of operational 
data. - Soft Delete: `deleted_at` field for soft deletion, typically mirroring 
the parent `waypoints` record's state. - Triggers: `updated_at` auto-update 
trigger. Array FK validation trigger for `stop_facility_ids`. Orphaned 
translations cleanup trigger. 11. Scalability & Future-Proofing - Structure: 
1:1 relationship with `waypoints`. Scalability depends on the `waypoints` 
table. - GTFS ID: Inclusion of `gtfs_stop_id` allows for future integration 
with GTFS data. - Operator Management: `operator_names_text` is free text for 
V2.1; future enhancement could link to a `transport_operators_master` table. 
12. Next-Action Checklist - 🔴 Master Tables: Ensure `public.waypoints`, 
`public.transport_stop_types_master` (with `is_active`), 
`public.transport_stop_facilities_master` (with `is_active`), 
`public.profiles`, and `public.content_statuses_master` tables are created and 
populated as prerequisites. - 🔴 Helper Functions: Ensure 
`public.set_current_timestamp_updated_at()` (or `extensions.moddatetime`), 
`public.cleanup_related_translations(TEXT, TEXT)`, and `public.has_role(TEXT)` 
functions are defined and operational. - 🔴 Create Table: Execute the DDL for 
`public.transport_stops_details` (Version 2.1). - 🔴 Create Indexes: Apply all 
defined indexes, including for audit FKs. Rename indexes for consistency (e.g., 
`ix_transport_stops_details_stop_type_id`). - 🔴 Apply Triggers: - 
`trigger_transport_stops_details_set_updated_at`. - 
`trigger_check_transport_stop_facility_ids` (after defining 
`public.check_transport_stop_facility_ids()`). - 
`trigger_cleanup_transport_stops_details_translations`. - 🔴 Array FK 
Integrity: Thoroughly test the `check_transport_stop_facility_ids()` trigger, 
ensuring it correctly uses the `is_active` flag from 
`transport_stop_facilities_master`. - 🟠 URL Validation: Confirm database-level 
URL regex CHECK constraints are effective. - 🟠 RLS Policies: Review, adapt 
(especially role names and `content_statuses_master` usage), and apply the RLS 
policies. - 🟢 Data Migration: Plan data migration if upgrading from a previous 
schema version (e.g., from ENUMs to FKs for `stop_type_id` and 
`stop_facility_ids`). - 🟢 Documentation: Update any user-facing or technical 
documentation regarding transport stop details. * * * * * 
