# 4.17 transport_stop_types_master

  
https://gemini.google.com/u/1/app/bf28f389cd093e55?is_sa=1&android-min-version=3
01356232&ios-min-version=322.0&campaign_id=bkws&utm_source=google&utm_medium=cpc
&utm_campaign=2024enUS_gemfeb&pt=9008&mt=8&ct=p-growth-sem-bkws 
https://gemini.google.com/u/1/app/980a7af1dc7f079a 
https://gemini.google.com/u/1/app/b90970622259e225 * * * * * ### 3\. Updated 
Production-Ready Specification - `public.transport_stop_types_master` (V2.1) 
Version: 2.1 (Based on original V1.2, V2.1 Checklist REV 05-18-25-A applied) 
Date: May 18, 2025 1. Purpose & Primary Use-Cases The 
transport_stop_types_master table defines the various types of public 
transportation stops (e.g., "Main Train Station," "Regional Bus Stop," "Ferry 
Terminal"). Its purpose is to provide a standardized, translatable 
classification that drives UI elements (map icons, filter options), helps users 
understand the nature of a transport stop, and ensures data consistency. Key 
user-story touchpoints include pilgrims identifying transport types when 
planning, filtering map views, and administrators categorizing waypoints. The 
system uses it for displaying icons and populating filters. 2. Schema | column 
| data_type | constraints | description | | :---------------------- | 
:------------------------ | 
:-------------------------------------------------------------------------------
----------------------------------- | 
:-------------------------------------------------------------------------------
-------------------------------------------------------- | | id | integer | 
Primary Key (Generated always as identity) | Unique identifier for the 
transport stop type. | | code | text | Unique, Not Null, CHECK (length(code) > 
0 AND length(code) &lt;= 50 AND code ~ '^[a-z0-9_]+$') | Short, stable, 
machine-readable code (e.g., 'train_station_main', 'bus_stop_regional'). 
Snake_case. | | label | text | Not Null, CHECK (length(label) > 0 AND 
length(label) &lt;= 100) | Human-readable name in the primary reference 
language (English) for UI display and as a base for translation. (Translatable) 
| | description | text | Nullable | Optional description in the primary 
reference language (English) of the transport stop type, providing more 
context. (Translatable) | | icon_identifier | text | Nullable, CHECK 
(icon_identifier IS NULL OR length(icon_identifier) &lt;= 100) | Name, class, 
or path for a UI icon associated with this stop type. | | sort_order | integer 
| Not Null, Default 0 | Determines the display order in UI lists or filters. 
Lower numbers appear first. | | is_active | boolean | Not Null, Default true | 
If true, this transport stop type is active and can be used/displayed. | | 
created_at | timestamp with time zone | Not Null, Default now() | Timestamp of 
record creation. | | updated_at | timestamp with time zone | Not Null, Default 
now() | Timestamp of last update (auto-updated by trigger). | | 
created_by_profile_id | uuid | Nullable, Foreign Key to profiles(id) ON DELETE 
SET NULL | Profile ID of the user who created the record. | | 
updated_by_profile_id | uuid | Nullable, Foreign Key to profiles(id) ON DELETE 
SET NULL | Profile ID of the user who last updated the record. | 3. PostgreSQL 
DDL SQL ``` -- Assumes public.profiles table exists -- Assumes a suitable 
updated_at trigger function exists (e.g., 
public.set_current_timestamp_updated_at() or extensions.moddatetime()) -- 
Assumes public.cleanup_related_translations(TEXT, TEXT) function exists -- 
Assumes public.has_role(TEXT) function exists CREATE TABLE 
public.transport_stop_types_master ( id INTEGER GENERATED ALWAYS AS IDENTITY 
PRIMARY KEY, code TEXT UNIQUE NOT NULL CHECK (length(code) > 0 AND length(code) 
<= 50 AND code ~ '^[a-z0-9_]+$'), label TEXT NOT NULL CHECK (length(label) > 0 
AND length(label) <= 100), description TEXT NULL, icon_identifier TEXT NULL 
CHECK (icon_identifier IS NULL OR length(icon_identifier) <= 100), sort_order 
INTEGER NOT NULL DEFAULT 0, is_active BOOLEAN NOT NULL DEFAULT true, created_at 
TIMESTAMPTZ NOT NULL DEFAULT now(), updated_at TIMESTAMPTZ NOT NULL DEFAULT 
now(), created_by_profile_id UUID NULL REFERENCES public.profiles(id) ON DELETE 
SET NULL, updated_by_profile_id UUID NULL REFERENCES public.profiles(id) ON 
DELETE SET NULL ); COMMENT ON TABLE public.transport_stop_types_master IS 
'Master list of public transport stop types (e.g., train station, bus stop). 
`label` and `description` are primary language (English) and translatable. 
Version 2.1'; COMMENT ON COLUMN public.transport_stop_types_master.id IS 'PK. 
Unique identifier for the transport stop type. V2.1'; COMMENT ON COLUMN 
public.transport_stop_types_master.code IS 'Short, stable, machine-readable 
code (snake_case). Max 50 chars. UNIQUE. V2.1'; COMMENT ON COLUMN 
public.transport_stop_types_master.label IS 'Human-readable name in primary 
language (English) for UI and translation base. Max 100 chars. (Translatable 
via public.translations). V2.1'; COMMENT ON COLUMN 
public.transport_stop_types_master.description IS 'Optional description in 
primary language (English) of the stop type. (Translatable via 
public.translations). V2.1'; COMMENT ON COLUMN 
public.transport_stop_types_master.icon_identifier IS 'Name, class, or path for 
a UI icon. Max 100 chars. V2.1'; COMMENT ON COLUMN 
public.transport_stop_types_master.sort_order IS 'Determines the display order 
in UI lists or filters. NOT NULL DEFAULT 0. V2.1'; COMMENT ON COLUMN 
public.transport_stop_types_master.is_active IS 'If true, this transport stop 
type is active and can be used/displayed. NOT NULL DEFAULT TRUE. V2.1'; COMMENT 
ON COLUMN public.transport_stop_types_master.created_at IS 'Timestamp of record 
creation. NOT NULL DEFAULT now(). V2.1'; COMMENT ON COLUMN 
public.transport_stop_types_master.updated_at IS 'Timestamp of last update. 
Auto-updated by trigger. NOT NULL DEFAULT now(). V2.1'; COMMENT ON COLUMN 
public.transport_stop_types_master.created_by_profile_id IS 'Profile ID of the 
user who created the record. FK to public.profiles(id) ON DELETE SET NULL. 
V2.1'; COMMENT ON COLUMN 
public.transport_stop_types_master.updated_by_profile_id IS 'Profile ID of the 
user who last updated the record. FK to public.profiles(id) ON DELETE SET NULL. 
V2.1'; -- Indexes CREATE INDEX 
ix_transport_stop_types_master_created_by_profile_id ON 
public.transport_stop_types_master (created_by_profile_id) WHERE 
created_by_profile_id IS NOT NULL; CREATE INDEX 
ix_transport_stop_types_master_updated_by_profile_id ON 
public.transport_stop_types_master (updated_by_profile_id) WHERE 
updated_by_profile_id IS NOT NULL; CREATE INDEX 
ix_transport_stop_types_master_active_sort ON 
public.transport_stop_types_master (is_active, sort_order); -- Trigger for 
updated_at CREATE TRIGGER trigger_transport_stop_types_master_set_updated_at 
BEFORE UPDATE ON public.transport_stop_types_master FOR EACH ROW EXECUTE 
FUNCTION public.set_current_timestamp_updated_at(); -- Or 
extensions.moddatetime() COMMENT ON TRIGGER 
trigger_transport_stop_types_master_set_updated_at ON 
public.transport_stop_types_master IS 'Trigger to automatically update 
updated_at timestamp on row modification. V2.1'; -- Trigger for orphan 
translation cleanup CREATE TRIGGER 
trigger_cleanup_transport_stop_types_master_translations AFTER DELETE ON 
public.transport_stop_types_master FOR EACH ROW EXECUTE FUNCTION 
public.cleanup_related_translations('transport_stop_types_master', 'id'); 
COMMENT ON TRIGGER trigger_cleanup_transport_stop_types_master_translations ON 
public.transport_stop_types_master IS 'After deleting a transport stop type, 
remove its associated entries from the translations table using its ID. V2.1.'; 
``` 4. JSON Schema Mirror JSON ``` { "title": "transport_stop_type_master", 
"description": "Master list of public transport stop types. `label` and 
`description` are primary language (English) and translatable. Version 2.1", 
"type": "object", "properties": { "id": { "type": "integer", "description": 
"PK. Unique identifier for the transport stop type.", "readOnly": true }, 
"code": { "type": "string", "description": "Short, stable, machine-readable 
code (snake_case). Max 50 chars. UNIQUE.", "pattern": "^[a-z0-9_]+$", 
"maxLength": 50 }, "label": { "type": "string", "description": "Human-readable 
name in primary language (English) for UI and translation base. Max 100 chars. 
(Translatable via public.translations).", "maxLength": 100 }, "description": { 
"type": ["string", "null"], "description": "Optional description in primary 
language (English) of the stop type. (Translatable via public.translations)." 
}, "icon_identifier": { "type": ["string", "null"], "maxLength": 100, 
"description": "Name, class, or path for a UI icon." }, "sort_order": { "type": 
"integer", "default": 0, "description": "Determines display order in UI lists 
or filters. NOT NULL." }, "is_active": { "type": "boolean", "default": true, 
"description": "If true, this transport stop type is active and can be 
used/displayed. NOT NULL." }, "created_at": { "type": "string", "format": 
"date-time", "description": "Timestamp of record creation. NOT NULL DEFAULT 
now().", "readOnly": true }, "updated_at": { "type": "string", "format": 
"date-time", "description": "Timestamp of last update. Auto-updated by trigger. 
NOT NULL DEFAULT now().", "readOnly": true }, "created_by_profile_id": { 
"type": ["string", "null"], "format": "uuid", "description": "Profile ID of the 
user who created the record. FK to public.profiles(id) ON DELETE SET NULL." }, 
"updated_by_profile_id": { "type": ["string", "null"], "format": "uuid", 
"description": "Profile ID of the user who last updated the record. FK to 
public.profiles(id) ON DELETE SET NULL." } }, "required": [ "code", "label", 
"sort_order", "is_active", "created_at", "updated_at" ], "primary_key": ["id"], 
"unique_constraints": [ {"columns": ["code"], "name": 
"transport_stop_types_master_code_key"} ], "foreign_keys": [ {"columns": 
["created_by_profile_id"], "references_table": "public.profiles", 
"references_columns": ["id"], "on_delete": "SET NULL"}, {"columns": 
["updated_by_profile_id"], "references_table": "public.profiles", 
"references_columns": ["id"], "on_delete": "SET NULL"} ] } ``` 5. Relationships 
& Integrity - Primary Key: `id` (INTEGER, Generated always as identity). - 
Unique Constraint: `code` must be unique. - Foreign Key References FROM other 
tables: `transport_stops_details.stop_type_id` will reference 
`transport_stop_types_master.id` (ON DELETE RESTRICT). - Foreign Key References 
TO other tables: `created_by_profile_id` and `updated_by_profile_id` reference 
`public.profiles(id)` ON DELETE SET NULL. 6. Multilingual Strategy - 
Translatable Fields: `label` and `description` store their primary reference 
language (English) text directly. These fields are designated for translation 
via the `public.translations` table. - Stable Identifier: The `code` field is a 
stable, machine-readable identifier and is not translated. - Orphan Cleanup: An 
`AFTER DELETE` trigger 
(`trigger_cleanup_transport_stop_types_master_translations`) ensures associated 
translations are removed from `public.translations` when a record is deleted. 
7. Role-Based Workflow & RLS Notes - Content Management: This table is 
typically managed by Platform Administrators. - Lifecycle: The `is_active` flag 
controls whether a type is available for use. - RLS Policies: - 🟢 Public users 
can read active transport stop types. SQL ``` CREATE POLICY 
"select_active_transport_stop_types" ON public.transport_stop_types_master FOR 
SELECT USING (is_active = true); ``` - 🟢 Platform Administrators (identified 
by `public.has_role('admin_platform')`) can manage all transport stop types. 
SQL ``` CREATE POLICY "manage_transport_stop_types_for_admins" ON 
public.transport_stop_types_master FOR ALL USING 
(public.has_role('admin_platform')) -- Ensure 'admin_platform' is a defined 
role WITH CHECK (public.has_role('admin_platform')); ``` - Deletion of types in 
use will be restricted by the `ON DELETE RESTRICT` constraint from 
`transport_stops_details.stop_type_id`. Deactivating (`is_active = false`) is 
the preferred method for retiring types. 8. ENUM vs Lookup Discussion 🟢 
Decision: This table (transport_stop_types_master) correctly serves as a lookup 
table, replacing a previous ENUM approach. Reason: Provides richer data 
(translatable names/descriptions, icons, sort order), flexibility, 
maintainability, and auditability, superior to a hardcoded ENUM. 9. UI/UX 
Enablement - Display: `label` (translated) for names, `icon_identifier` for 
icons. - Ordering: `sort_order` ensures consistent presentation in UI elements. 
- Filtering: `is_active` and `code` can be used for filtering in admin 
interfaces or by the system. 10. Auditing & Lifecycle Management - Standard 
Audit Columns: `created_at`, `updated_at` (auto-updated), 
`created_by_profile_id`, `updated_by_profile_id`. - Lifecycle: Managed by the 
`is_active` boolean flag. Records are not typically hard-deleted if referenced. 
11. Scalability & Future-Proofing - Lookup Table: Structure is inherently 
scalable for a manageable list of types. - Audit Fields: Provide history of 
changes. - The number of distinct stop types is expected to be relatively 
small. 12. Seed Data (V1) - Seed data should be inserted with `is_active = 
true` and `created_by_profile_id` and `updated_by_profile_id` set to a valid 
admin/system user's UUID. <!-- end list --> SQL ``` -- Example structure for 
seed data INSERT statements: INSERT INTO public.transport_stop_types_master 
(code, label, icon_identifier, sort_order, is_active, created_by_profile_id, 
updated_by_profile_id) VALUES ('train_station_main', 'Main Train Station', 
'icon-train-main', 10, true, '[ADMIN_UUID_PLACEHOLDER]', 
'[ADMIN_UUID_PLACEHOLDER]'), ('train_station_local', 'Local Train Station', 
'icon-train-local', 20, true, '[ADMIN_UUID_PLACEHOLDER]', 
'[ADMIN_UUID_PLACEHOLDER]'), ('train_halt_unmanned_platform', 'Train 
Halt/Platform (Unmanned)', 'icon-train-halt', 30, true, 
'[ADMIN_UUID_PLACEHOLDER]', '[ADMIN_UUID_PLACEHOLDER]'), 
('bus_station_terminal', 'Bus Station/Terminal', 'icon-bus-station', 40, true, 
'[ADMIN_UUID_PLACEHOLDER]', '[ADMIN_UUID_PLACEHOLDER]'), 
('bus_stop_urban_line', 'Urban Bus Stop', 'icon-bus-stop-urban', 50, true, 
'[ADMIN_UUID_PLACEHOLDER]', '[ADMIN_UUID_PLACEHOLDER]'), 
('bus_stop_regional_intercity_line', 'Regional/Intercity Bus Stop', 
'icon-bus-stop-regional', 60, true, '[ADMIN_UUID_PLACEHOLDER]', 
'[ADMIN_UUID_PLACEHOLDER]'), ('tram_stop', 'Tram Stop', 'icon-tram', 70, true, 
'[ADMIN_UUID_PLACEHOLDER]', '[ADMIN_UUID_PLACEHOLDER]'), 
('metro_subway_station', 'Metro/Subway Station', 'icon-metro', 80, true, 
'[ADMIN_UUID_PLACEHOLDER]', '[ADMIN_UUID_PLACEHOLDER]'), 
('funicular_station_bottom', 'Funicular Station (Bottom)', 'icon-funicular', 
90, true, '[ADMIN_UUID_PLACEHOLDER]', '[ADMIN_UUID_PLACEHOLDER]'), 
('funicular_station_top', 'Funicular Station (Top)', 'icon-funicular', 91, 
true, '[ADMIN_UUID_PLACEHOLDER]', '[ADMIN_UUID_PLACEHOLDER]'), 
('cable_car_station_bottom', 'Cable Car Station (Bottom)', 'icon-cable-car', 
100, true, '[ADMIN_UUID_PLACEHOLDER]', '[ADMIN_UUID_PLACEHOLDER]'), 
('cable_car_station_top', 'Cable Car Station (Top)', 'icon-cable-car', 101, 
true, '[ADMIN_UUID_PLACEHOLDER]', '[ADMIN_UUID_PLACEHOLDER]'), 
('ferry_terminal_port', 'Ferry Terminal/Port', 'icon-ferry', 110, true, 
'[ADMIN_UUID_PLACEHOLDER]', '[ADMIN_UUID_PLACEHOLDER]'), 
('airport_shuttle_stop_designated', 'Airport Shuttle Stop (Designated)', 
'icon-airport-shuttle', 120, true, '[ADMIN_UUID_PLACEHOLDER]', 
'[ADMIN_UUID_PLACEHOLDER]'), ('shared_taxi_rank_official', 'Shared Taxi Rank 
(Official)', 'icon-shared-taxi', 130, true, '[ADMIN_UUID_PLACEHOLDER]', 
'[ADMIN_UUID_PLACEHOLDER]'), ('park_and_ride_facility_stop', 'Park and Ride 
Facility Stop', 'icon-park-ride', 140, true, '[ADMIN_UUID_PLACEHOLDER]', 
'[ADMIN_UUID_PLACEHOLDER]'), ('other_public_transport_hub', 'Other Public 
Transport Hub', 'icon-transport-other', 900, true, '[ADMIN_UUID_PLACEHOLDER]', 
'[ADMIN_UUID_PLACEHOLDER]'); ``` *(Note: `[ADMIN_UUID_PLACEHOLDER]` must be 
replaced with an actual admin user's UUID during seeding).* 13. Next-Action 
Checklist - 🔴 Helper Functions: Ensure 
`public.set_current_timestamp_updated_at()` (or `extensions.moddatetime`), 
`public.cleanup_related_translations(TEXT, TEXT)`, and `public.has_role(TEXT)` 
functions are defined and operational. - 🔴 Create Table: Execute the DDL for 
`public.transport_stop_types_master` (Version 2.1), including the `is_active` 
column. - 🔴 Create Indexes: Apply all defined indexes 
(`ix_transport_stop_types_master_created_by_profile_id`, 
`ix_transport_stop_types_master_updated_by_profile_id`, 
`ix_transport_stop_types_master_active_sort`). - 🔴 Apply Triggers: - 
`trigger_transport_stop_types_master_set_updated_at`. - 
`trigger_cleanup_transport_stop_types_master_translations`. - 🔴 RLS Policies: 
Review, adapt (especially role names like `admin_platform`), and apply the RLS 
policies. - 🔴 Initial Population: Insert seed data as defined, populating 
`is_active` and `created_by_profile_id`/`updated_by_profile_id` correctly. - 🟢 
Iconography: Document `icon_identifier` conventions and ensure assets are 
available. - 🟢 Translation Entries: Plan for populating `public.translations` 
for the `label` and `description` fields. * * * * * 
