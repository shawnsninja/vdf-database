# 5.3 warning_severities_master

  
https://gemini.google.com/u/1/app/f406710aca31cc25?is_sa=1&android-min-version=3
01356232&ios-min-version=322.0&campaign_id=bkws&utm_source=google&utm_medium=cpc
&utm_campaign=2024enUS_gemfeb&pt=9008&mt=8&ct=p-growth-sem-bkws 
https://gemini.google.com/u/1/app/e9ad14765a46eb05 
https://gemini.google.com/u/1/app/951c86a3d09aaadb ### 3\. Updated 
Production-Ready Specification Target Table Name: 
public.warning_severities_master Version: 2.1 (Checklist REV 05-18-25-A 
Applied) Date: May 18, 2025 1. Purpose & Primary Use-Cases - Mission Statement: 
Defines the standardized levels of seriousness for segment warnings, providing 
clear, translatable, visually distinct, sortable, and lifecycle-managed 
categories to inform pilgrims of the potential impact of an issue. Audit trails 
track administrative changes. - Key User-Story Touchpoints: - Pilgrim (Anna): 
Sees the translated warning severity (e.g., "High Hazard") and its associated 
color-coding. - Regional Content Manager (Sofia): Selects an *active* warning 
severity from a predefined, ordered list. - Platform Administrator (Admin 
Team): Manages warning severities, including codes, names, UI colors, sort 
order, active status, and audits changes. 2. Schema | Column | Data Type | 
Constraints | Description | | :------------------------ | :------------ | 
:-------------------------------------------------------------------------------
-------------------------- | 
:-------------------------------------------------------------------------------
--------------------------------------------------------- | | id | integer | 
Primary Key, Generated always as identity | Unique identifier for the warning 
severity. | | code | text | Not Null, Unique, CHECK (length(code) <= 100 AND 
code ~ '^[a-z0-9_]+$') | Short, unique, machine-readable code (e.g., 
'critical_closed'). Max 100 chars. | | display_name | text | Not Null, CHECK 
(length(display_name) <= 255) | Default display name in the primary reference 
language (English). (Translatable via public.translations). Max 255 chars. | | 
description | text | Nullable | Optional longer description (English). 
(Translatable via public.translations). | | ui_color_hex | text | Nullable, 
CHECK (ui_color_hex ~* '^#[0-9A-Fa-f]{6}$' OR ui_color_hex IS NULL) | 
Hexadecimal color code (e.g., '#FF0000') for UI elements. | | sort_order | 
integer | Not Null, Default 0 | Defines display/priority order in UIs. | | 
is_active | boolean | Not Null, Default true | If true, severity is active and 
selectable. Set to false to retire. | | notes | text | Nullable | Internal 
administrative notes. | | created_at | timestamptz | Not Null, Default now() | 
Timestamp of record creation. | | updated_at | timestamptz | Not Null, Default 
now() | Timestamp of last record update (auto-updated). | | 
created_by_profile_id | uuid | Nullable, Foreign Key to public.profiles(id) ON 
DELETE SET NULL | Profile ID of the admin who created the record. | | 
updated_by_profile_id | uuid | Nullable, Foreign Key to public.profiles(id) ON 
DELETE SET NULL | Profile ID of the admin who last updated the record. | 3. 
PostgreSQL DDL SQL ``` CREATE TABLE public.warning_severities_master ( id 
integer GENERATED ALWAYS AS IDENTITY PRIMARY KEY, code text NOT NULL UNIQUE 
CHECK (length(code) <= 100 AND code ~ '^[a-z0-9_]+$'), display_name text NOT 
NULL CHECK (length(display_name) <= 255), description text NULL, ui_color_hex 
text NULL CHECK (ui_color_hex ~* '^#[0-9A-Fa-f]{6}$' OR ui_color_hex IS NULL), 
sort_order integer NOT NULL DEFAULT 0, is_active boolean NOT NULL DEFAULT true, 
notes text NULL, created_at timestamptz NOT NULL DEFAULT now(), updated_at 
timestamptz NOT NULL DEFAULT now(), created_by_profile_id UUID REFERENCES 
public.profiles(id) ON DELETE SET NULL, updated_by_profile_id UUID REFERENCES 
public.profiles(id) ON DELETE SET NULL ); COMMENT ON TABLE 
public.warning_severities_master IS 'Master list of predefined warning 
severities (e.g., Low, Medium, High, Critical), including active status, sort 
order, and audit fields. Replaces segment_warning_severity_enum. Version 2.1.'; 
COMMENT ON COLUMN public.warning_severities_master.code IS 'PK (Informal). 
Short, unique, machine-readable code for the severity (e.g., ''high_hazard''). 
Recommended: snake_case, lowercase.'; COMMENT ON COLUMN 
public.warning_severities_master.display_name IS 'Default display name in the 
primary reference language (English). (Translatable via public.translations).'; 
COMMENT ON COLUMN public.warning_severities_master.description IS 'Optional 
longer description in the primary reference language (English). (Translatable 
via public.translations).'; COMMENT ON COLUMN 
public.warning_severities_master.ui_color_hex IS 'Hexadecimal color code (e.g., 
''#FF0000'') for UI elements associated with this severity.'; COMMENT ON COLUMN 
public.warning_severities_master.sort_order IS 'Defines the order for display 
or prioritization (e.g., 0 for lowest, 100 for highest).'; COMMENT ON COLUMN 
public.warning_severities_master.is_active IS 'Indicates if the severity level 
is active and available for selection (default true). Set to false to retire a 
severity level.'; COMMENT ON COLUMN public.warning_severities_master.notes IS 
'Internal administrative notes about this warning severity.'; COMMENT ON COLUMN 
public.warning_severities_master.created_at IS 'Timestamp of when this warning 
severity record was created.'; COMMENT ON COLUMN 
public.warning_severities_master.updated_at IS 'Timestamp of when this warning 
severity record was last updated (auto-updated by trigger).'; COMMENT ON COLUMN 
public.warning_severities_master.created_by_profile_id IS 'Profile ID of the 
administrator who created this warning severity. FK to public.profiles(id).'; 
COMMENT ON COLUMN public.warning_severities_master.updated_by_profile_id IS 
'Profile ID of the administrator who last updated this warning severity. FK to 
public.profiles(id).'; -- Indexes CREATE INDEX 
ix_warning_severities_master_active_sort_order ON 
public.warning_severities_master (is_active, sort_order); CREATE INDEX 
ix_warning_severities_master_created_by_profile_id ON 
public.warning_severities_master (created_by_profile_id) WHERE 
created_by_profile_id IS NOT NULL; CREATE INDEX 
ix_warning_severities_master_updated_by_profile_id ON 
public.warning_severities_master (updated_by_profile_id) WHERE 
updated_by_profile_id IS NOT NULL; ``` 4. Triggers/Functions - `updated_at` 
Trigger: SQL ``` -- Assumes public.set_current_timestamp_updated_at() function 
is created globally. CREATE TRIGGER set_warning_severities_master_updated_at 
BEFORE UPDATE ON public.warning_severities_master FOR EACH ROW EXECUTE FUNCTION 
public.set_current_timestamp_updated_at(); ``` - Orphaned Translation Cleanup 
Trigger Function (Conceptual definition, to be created globally): SQL ``` -- 
CREATE OR REPLACE FUNCTION public.cleanup_related_translations() ... ``` 
*(Actual attachment in Next-Action Checklist)* 5. JSON Schema Mirror JSON ``` { 
"title": "warning_severity_master", "description": "Defines a level of severity 
for segment warnings, with code, display name, UI color, sort order, active 
status, and audit fields. Version 2.1.", "type": "object", "properties": { 
"id": { "type": "integer", "description": "PK. Unique identifier.", "readOnly": 
true }, "code": { "type": "string", "description": "Unique machine-readable 
code (snake_case).", "maxLength": 100, "pattern": "^[a-z0-9_]+$" }, 
"display_name": { "type": "string", "description": "Default display name 
(English). Translatable.", "maxLength": 255 }, "description": { "type": 
["string", "null"], "description": "Optional description (English). 
Translatable." }, "ui_color_hex": { "type": ["string", "null"], "description": 
"Hex color code for UI.", "pattern": "^#[0-9A-Fa-f]{6}$" }, "sort_order": { 
"type": "integer", "description": "UI display order.", "default": 0 }, 
"is_active": { "type": "boolean", "description": "True if active and 
selectable.", "default": true }, "notes": { "type": ["string", "null"], 
"description": "Internal admin notes." }, "created_at": { "type": "string", 
"format": "date-time", "description": "Creation timestamp.", "readOnly": true 
}, "updated_at": { "type": "string", "format": "date-time", "description": 
"Last update timestamp.", "readOnly": true }, "created_by_profile_id": { 
"type": ["string", "null"], "format": "uuid", "description": "Profile ID of 
creator." }, "updated_by_profile_id": { "type": ["string", "null"], "format": 
"uuid", "description": "Profile ID of last updater." } }, "required": [ "code", 
"display_name", "sort_order", "is_active" ] } ``` 6. Relationships & Integrity 
- This is a master data table. - Referenced by 
`segment_warnings.warning_severity_id` (FK). - `ON DELETE RESTRICT` is 
appropriate for FKs from `segment_warnings` pointing to this table. An active 
severity in use should not be deletable. Use `is_active = false` to retire. - 
Foreign keys `created_by_profile_id` and `updated_by_profile_id` reference 
`public.profiles(id) ON DELETE SET NULL`. 7. Multilingual Strategy - 
Translatable Fields: `display_name`, `description`. These store the primary 
reference language text (English). - Translation Mechanism: Uses the central 
`public.translations` table. An `AFTER DELETE` trigger on 
`public.warning_severities_master` is needed for cleanup. 8. Role-Based 
Workflow & RLS Notes - Management: Primarily by Platform Administrators. - RLS 
Policies: - ðŸŸ¢ Authenticated users can read active warning severities: SQL ``` 
CREATE POLICY "select_active_warning_severities_for_authenticated" ON 
public.warning_severities_master FOR SELECT TO authenticated USING (is_active = 
true); ``` - ðŸŸ¢ Platform Administrators have full control: SQL ``` CREATE 
POLICY "admin_all_access_on_warning_severities_master" ON 
public.warning_severities_master FOR ALL USING 
(public.has_role_on_profile(auth.uid(), 'admin_platform')) -- Example admin 
role WITH CHECK (public.has_role_on_profile(auth.uid(), 'admin_platform')); ``` 
*(Assumes `public.has_role_on_profile(UUID, TEXT)` helper function exists)* 9. 
ENUM vs Lookup Discussion - ðŸŸ¢ This table correctly replaces 
`segment_warning_severity_enum`. Benefits include extensibility, i18n, data 
management, and richer UI/UX. 10. UI/UX Enablement - Admin UI: Dropdowns 
populated by `display_name` (translated), filtered by `is_active = true`, 
ordered by `sort_order`. - Pilgrim UI: `display_name` (translated) and 
`ui_color_hex` represent severity. - Performance: Small table, standard 
indexing is sufficient. 11. Auditing & Lifecycle Management - Audit Columns: 
`created_at`, `updated_at`, `created_by_profile_id`, `updated_by_profile_id`. - 
Lifecycle: Managed by `is_active` flag. 12. Scalability & Future-Proofing - 
Scalability: Table expected to remain small. - Future-Proofing: Structure 
allows adding new attributes easily. `is_active` flag and audit columns enhance 
maintainability. 13. Seed Data (V1 Example) SQL ``` INSERT INTO 
public.warning_severities_master (code, display_name, description, 
ui_color_hex, sort_order, is_active, created_by_profile_id, 
updated_by_profile_id) VALUES ('info_minor', 'Information / Minor 
Inconvenience', 'General information or a minor issue that pilgrims should be 
aware of but is unlikely to significantly impact their walk.', '#3498DB', 10, 
true, '[ADMIN_PROFILE_UUID]', '[ADMIN_PROFILE_UUID]'), ('caution_advised', 
'Caution Advised', 'A potential hazard or moderate difficulty exists. Pilgrims 
should proceed with caution and be prepared.', '#F1C40F', 20, true, 
'[ADMIN_PROFILE_UUID]', '[ADMIN_PROFILE_UUID]'), ('hazard_significant', 
'Significant Hazard / Consider Alternative', 'A significant hazard is present. 
Experienced and well-equipped pilgrims might proceed with extreme caution, 
others should consider alternatives.', '#E67E22', 30, true, 
'[ADMIN_PROFILE_UUID]', '[ADMIN_PROFILE_UUID]'), ('critical_path_impassable', 
'Critical - Path Impassable / Closed', 'The path is closed, impassable, or 
extremely dangerous. Do not proceed. Seek alternatives.', '#C0392B', 40, true, 
'[ADMIN_PROFILE_UUID]', '[ADMIN_PROFILE_UUID]'), 
('historical_severity_retired', 'Old Severity Level (Retired)', 'A previously 
used severity level, now retired and not for new selection.', '#808080', 5, 
false, '[ADMIN_PROFILE_UUID]', '[ADMIN_PROFILE_UUID]'); -- Replace 
[ADMIN_PROFILE_UUID] with an actual admin user's profile_id ``` 14. Next-Action 
Checklist - ðŸ”´ Ensure `public.profiles` table exists before running DDL for FK 
constraints. - ðŸ”´ Ensure RLS helper `public.has_role_on_profile(UUID, TEXT)` 
exists and is SECURITY DEFINER hardened if necessary. - ðŸ”´ Ensure 
`public.set_current_timestamp_updated_at()` function exists. - ðŸ”´ Implement 
DDL: Execute `CREATE TABLE` for `public.warning_severities_master`. - ðŸ”´ Apply 
`updated_at` Trigger. - ðŸ”´ Create Indexes as defined. - ðŸ”´ Implement Orphaned 
Translation Cleanup Trigger: After `public.translations` table exists, create 
and apply `trigger_cleanup_warning_severities_translations` using 
`public.cleanup_related_translations()` on this table. - ðŸ”´ Populate Initial 
Seed Data, replacing `[ADMIN_PROFILE_UUID]` with a valid `profiles.id`. - ðŸŸ¢ 
Review `ui_color_hex` values for accessibility and `sort_order` for logical 
flow. - ðŸŸ¢ Plan administrative interface for managing these severities. 
