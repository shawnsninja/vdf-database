# 5.3 warning_source_types_master

  
https://gemini.google.com/u/1/app/f406710aca31cc25?is_sa=1&android-min-version=3
01356232&ios-min-version=322.0&campaign_id=bkws&utm_source=google&utm_medium=cpc
&utm_campaign=2024enUS_gemfeb&pt=9008&mt=8&ct=p-growth-sem-bkws 
https://gemini.google.com/u/1/app/e9ad14765a46eb05 
https://gemini.google.com/u/1/app/951c86a3d09aaadb ### 3\. Updated 
Production-Ready Specification Target Table Name: 
public.warning_source_types_master Version: 2.1 (Checklist REV 05-18-25-A 
Applied) Date: May 18, 2025 1. Purpose & Primary Use-Cases - Mission Statement: 
Defines and categorizes the sources of warning information (e.g., 'Official 
Authority', 'User Report'), providing a standardized, extensible, translatable, 
sortable, and lifecycle-managed list. This helps assess credibility and manage 
warning inputs. Audit trails track administrative changes. - Key User-Story 
Touchpoints: - Regional Content Manager (Sofia): May select or see the source 
type when creating/reviewing a `segment_warning`. - Platform Administrator 
(Admin Team): Manages the list of warning source types, their default trust 
levels, active status, and audits changes. Uses this information in moderation 
workflows. 2. Schema | Column | Data Type | Constraints | Description | | 
:------------------------ | :------------ | 
:-------------------------------------------------------------------------------
-------------------------- | 
:-------------------------------------------------------------------------------
--------------------------------------------------------- | | id | integer | 
Primary Key, Generated always as identity | Unique identifier for the warning 
source type. | | code | text | Not Null, Unique, CHECK (length(code) <= 100 AND 
code ~ '^[a-z0-9_]+$') | Short, unique, machine-readable code (e.g., 
'official_authority'). Max 100 chars. | | display_name | text | Not Null, CHECK 
(length(display_name) <= 255) | Default display name in the primary reference 
language (English). (Translatable via public.translations). Max 255 chars. | | 
description | text | Nullable | Optional longer description (English). 
(Translatable via public.translations). | | default_trust_level | integer | 
Nullable, CHECK (default_trust_level BETWEEN 1 AND 5) | Optional default trust 
level (1-5 scale, 5 being highest) associated with this source type. | | 
sort_order | integer | Not Null, Default 0 | Defines display order in UIs. | | 
is_active | boolean | Not Null, Default true | If true, source type is active 
and selectable. Set to false to retire. | | notes | text | Nullable | Internal 
administrative notes. | | created_at | timestamptz | Not Null, Default now() | 
Timestamp of record creation. | | updated_at | timestamptz | Not Null, Default 
now() | Timestamp of last record update (auto-updated). | | 
created_by_profile_id | uuid | Nullable, Foreign Key to public.profiles(id) ON 
DELETE SET NULL | Profile ID of the admin who created the record. | | 
updated_by_profile_id | uuid | Nullable, Foreign Key to public.profiles(id) ON 
DELETE SET NULL | Profile ID of the admin who last updated the record. | 3. 
PostgreSQL DDL SQL ``` CREATE TABLE public.warning_source_types_master ( id 
integer GENERATED ALWAYS AS IDENTITY PRIMARY KEY, code text NOT NULL UNIQUE 
CHECK (length(code) <= 100 AND code ~ '^[a-z0-9_]+$'), display_name text NOT 
NULL CHECK (length(display_name) <= 255), description text NULL, 
default_trust_level integer NULL CHECK (default_trust_level BETWEEN 1 AND 5), 
sort_order integer NOT NULL DEFAULT 0, is_active boolean NOT NULL DEFAULT true, 
notes text NULL, created_at timestamptz NOT NULL DEFAULT now(), updated_at 
timestamptz NOT NULL DEFAULT now(), created_by_profile_id UUID REFERENCES 
public.profiles(id) ON DELETE SET NULL, updated_by_profile_id UUID REFERENCES 
public.profiles(id) ON DELETE SET NULL ); COMMENT ON TABLE 
public.warning_source_types_master IS 'Master list of warning source types 
(e.g., Official Authority, User Report), including active status, sort order, 
and audit fields. Replaces segment_warning_source_type_enum. Version 2.1.'; 
COMMENT ON COLUMN public.warning_source_types_master.code IS 'PK (Informal). 
Short, unique, machine-readable code for the source type. Recommended: 
snake_case, lowercase.'; COMMENT ON COLUMN 
public.warning_source_types_master.display_name IS 'Default display name in the 
primary reference language (English). (Translatable via public.translations).'; 
COMMENT ON COLUMN public.warning_source_types_master.description IS 'Optional 
longer description in the primary reference language (English). (Translatable 
via public.translations).'; COMMENT ON COLUMN 
public.warning_source_types_master.default_trust_level IS 'Optional default 
trust level (1-5 scale, 5 being highest) associated with this source type.'; 
COMMENT ON COLUMN public.warning_source_types_master.sort_order IS 'Defines the 
order in which source types should be displayed or prioritized in UIs.'; 
COMMENT ON COLUMN public.warning_source_types_master.is_active IS 'Indicates if 
the source type is active and available for selection (default true). Set to 
false to retire a source type.'; COMMENT ON COLUMN 
public.warning_source_types_master.notes IS 'Internal administrative notes 
about this source type.'; COMMENT ON COLUMN 
public.warning_source_types_master.created_at IS 'Timestamp of when this record 
was created.'; COMMENT ON COLUMN public.warning_source_types_master.updated_at 
IS 'Timestamp of when this record was last updated (auto-updated by trigger).'; 
COMMENT ON COLUMN public.warning_source_types_master.created_by_profile_id IS 
'Profile ID of the administrator who created this source type. FK to 
public.profiles(id).'; COMMENT ON COLUMN 
public.warning_source_types_master.updated_by_profile_id IS 'Profile ID of the 
administrator who last updated this source type. FK to public.profiles(id).'; 
-- Indexes CREATE INDEX ix_warning_source_types_master_active_sort_order ON 
public.warning_source_types_master (is_active, sort_order); CREATE INDEX 
ix_warning_source_types_master_created_by_profile_id ON 
public.warning_source_types_master (created_by_profile_id) WHERE 
created_by_profile_id IS NOT NULL; CREATE INDEX 
ix_warning_source_types_master_updated_by_profile_id ON 
public.warning_source_types_master (updated_by_profile_id) WHERE 
updated_by_profile_id IS NOT NULL; ``` 4. Triggers/Functions - `updated_at` 
Trigger: SQL ``` -- Assumes public.set_current_timestamp_updated_at() function 
is created globally. CREATE TRIGGER set_warning_source_types_master_updated_at 
BEFORE UPDATE ON public.warning_source_types_master FOR EACH ROW EXECUTE 
FUNCTION public.set_current_timestamp_updated_at(); ``` - Orphaned Translation 
Cleanup Trigger Function (Conceptual definition, to be created globally): SQL 
``` -- CREATE OR REPLACE FUNCTION public.cleanup_related_translations() ... ``` 
*(Actual attachment in Next-Action Checklist)* 5. JSON Schema Mirror JSON ``` { 
"title": "warning_source_type_master", "description": "Defines a source type 
for segment warnings, with code, display name, trust level, sort order, active 
status, and audit fields. Version 2.1.", "type": "object", "properties": { 
"id": { "type": "integer", "description": "PK. Unique identifier.", "readOnly": 
true }, "code": { "type": "string", "description": "Unique machine-readable 
code (snake_case).", "maxLength": 100, "pattern": "^[a-z0-9_]+$" }, 
"display_name": { "type": "string", "description": "Default display name 
(English). Translatable.", "maxLength": 255 }, "description": { "type": 
["string", "null"], "description": "Optional description (English). 
Translatable." }, "default_trust_level": { "type": ["integer", "null"], 
"description": "Optional default trust level (1-5).", "minimum": 1, "maximum": 
5 }, "sort_order": { "type": "integer", "description": "UI display order.", 
"default": 0 }, "is_active": { "type": "boolean", "description": "True if 
active and selectable.", "default": true }, "notes": { "type": ["string", 
"null"], "description": "Internal admin notes." }, "created_at": { "type": 
"string", "format": "date-time", "description": "Creation timestamp.", 
"readOnly": true }, "updated_at": { "type": "string", "format": "date-time", 
"description": "Last update timestamp.", "readOnly": true }, 
"created_by_profile_id": { "type": ["string", "null"], "format": "uuid", 
"description": "Profile ID of creator." }, "updated_by_profile_id": { "type": 
["string", "null"], "format": "uuid", "description": "Profile ID of last 
updater." } }, "required": [ "code", "display_name", "sort_order", "is_active" 
] } ``` 6. Relationships & Integrity - This is a master data table. - 
Referenced by `segment_warnings.warning_source_type_id` (FK). - `ON DELETE 
RESTRICT` is appropriate for FKs from `segment_warnings`. An active source type 
in use should not be deletable. Use `is_active = false` to retire. - Foreign 
keys `created_by_profile_id` and `updated_by_profile_id` reference 
`public.profiles(id) ON DELETE SET NULL`. 7. Multilingual Strategy - 
Translatable Fields: `display_name`, `description`. These store primary 
reference language text (English). - Translation Mechanism: Uses 
`public.translations`. `AFTER DELETE` trigger needed for cleanup. 8. Role-Based 
Workflow & RLS Notes - Management: Primarily by Platform Administrators. - RLS 
Policies: - ðŸŸ¢ Authenticated users can read active source types: SQL ``` CREATE 
POLICY "select_active_warning_source_types_for_authenticated" ON 
public.warning_source_types_master FOR SELECT TO authenticated USING (is_active 
= true); ``` - ðŸŸ¢ Platform Administrators have full control: SQL ``` CREATE 
POLICY "admin_all_access_on_warning_source_types_master" ON 
public.warning_source_types_master FOR ALL USING 
(public.has_role_on_profile(auth.uid(), 'admin_platform')) -- Example admin 
role WITH CHECK (public.has_role_on_profile(auth.uid(), 'admin_platform')); ``` 
*(Assumes `public.has_role_on_profile(UUID, TEXT)` helper function exists)* 9. 
ENUM vs Lookup Discussion - ðŸŸ¢ This table correctly replaces 
`segment_warning_source_type_enum`. Benefits: extensibility, i18n, data 
management. 10. UI/UX Enablement - Admin UI: Dropdowns populated by 
`display_name` (translated), filtered by `is_active = true`, ordered by 
`sort_order`. - Performance: Small table, standard indexing sufficient. 11. 
Auditing & Lifecycle Management - Audit Columns: `created_at`, `updated_at`, 
`created_by_profile_id`, `updated_by_profile_id`. - Lifecycle: Managed by 
`is_active` flag. 12. Scalability & Future-Proofing - Scalability: Table 
expected to remain small. - Future-Proofing: Structure allows adding new 
attributes. 13. Seed Data (V1 Example) SQL ``` INSERT INTO 
public.warning_source_types_master (code, display_name, description, 
default_trust_level, sort_order, is_active, created_by_profile_id, 
updated_by_profile_id) VALUES ('official_authority', 'Official Authority', 
'Warnings from CAI, Park Authorities, Municipalities, Law Enforcement, etc.', 
5, 10, true, '[ADMIN_PROFILE_UUID]', '[ADMIN_PROFILE_UUID]'), 
('regional_manager', 'Regional Content Manager', 'Warnings reported by an 
official regional content manager of the platform.', 4, 20, true, 
'[ADMIN_PROFILE_UUID]', '[ADMIN_PROFILE_UUID]'), ('verified_pilgrim', 'Verified 
Pilgrim User Report', 'Warnings reported by a trusted or verified pilgrim 
user.', 3, 30, true, '[ADMIN_PROFILE_UUID]', '[ADMIN_PROFILE_UUID]'), 
('anonymous_pilgrim_report', 'Anonymous Pilgrim User Report', 'Warnings 
reported by an unverified or anonymous user.', 2, 40, true, 
'[ADMIN_PROFILE_UUID]', '[ADMIN_PROFILE_UUID]'), ('other_unverified', 'Other 
Unverified Source', 'Warnings from other unverified online sources, social 
media, etc.', 1, 50, true, '[ADMIN_PROFILE_UUID]', '[ADMIN_PROFILE_UUID]'), 
('system_generated', 'System Generated', 'Warnings generated automatically by 
the system (e.g., based on weather alerts - future).', 4, 60, false, 
'[ADMIN_PROFILE_UUID]', '[ADMIN_PROFILE_UUID]'); -- Replace 
[ADMIN_PROFILE_UUID] with an actual admin user's profile_id ``` 14. Next-Action 
Checklist - ðŸ”´ Ensure `public.profiles` table exists before running DDL for FK 
constraints. - ðŸ”´ Ensure RLS helper `public.has_role_on_profile(UUID, TEXT)` 
exists and is SECURITY DEFINER hardened if necessary. - ðŸ”´ Ensure 
`public.set_current_timestamp_updated_at()` function exists. - ðŸ”´ Implement 
DDL: Execute `CREATE TABLE` for `public.warning_source_types_master`. - ðŸ”´ 
Apply `updated_at` Trigger. - ðŸ”´ Create Indexes as defined. - ðŸ”´ Implement 
Orphaned Translation Cleanup Trigger: After `public.translations` table exists, 
create and apply `trigger_cleanup_warning_source_types_translations` using 
`public.cleanup_related_translations()` on this table. - ðŸ”´ Populate Initial 
Seed Data, replacing `[ADMIN_PROFILE_UUID]` with a valid `profiles.id`. - ðŸŸ¢ 
Define clear criteria for `default_trust_level` if used programmatically. - ðŸŸ¢ 
Plan administrative interface for managing these source types. 
