# 3.0.4 - OpenAPI 3.1 Spec (Geographical Context)

  https://gemini.google.com/u/1/app/bc262419c46fd657 ### OpenAPI 3.1 Spec (for 
Module 3 Geographical Context) YAML ``` openapi: 3.1.0 info: title: Via di 
Francesco - Module 3: Geographical Context API version: v1.0.0 description: |- 
API endpoints for managing and accessing geographical context data, including 
regions, provinces, towns, and related taxonomies. For READ operations (GET): - 
Translatable fields in responses are resolved based on the `lang` query 
parameter. - An `other_available_translations` object may be provided as a 
hint. For WRITE operations (POST, PATCH): - Main textual fields (e.g., `name`, 
`description`) should contain the content in the primary reference language 
(English, or as specified by a `lang` query parameter or `X-Content-Language` 
header on the request). - Additional translations for other languages can be 
provided in an `additional_translations` array. Each object in this array 
specifies the `language_code`, `column_identifier` (field name), and 
`translated_text`. servers: - url: https://api.viadifrancesco.example.com/v1 # 
Placeholder description: Main API Server tags: - name: Regions description: 
Operations related to geographical regions. - name: Provinces description: 
Operations related to administrative provinces or states. - name: Towns 
description: Operations related to towns, cities, and villages. - name: 
Geographical Taxonomies description: Access to master classification data like 
town types, service tags, and characteristic tags. components: schemas: # 
Shared Schemas (Conceptually from a global definition) ErrorResponse: type: 
object properties: code: type: string description: An application-specific 
error code or a PostgREST error code. example: "PGRST116" message: type: string 
description: A human-readable summary of the error. example: "Failed to parse 
query parameter 'limit'. Expected a positive integer." details: type: string 
nullable: true description: More specific details about the error (optional). 
hint: type: string nullable: true description: Suggestions for how to resolve 
the error (optional). required: - code - message Pagination: type: object 
properties: current_page: type: integer example: 1 page_size: type: integer 
example: 20 total_items: type: integer example: 153 total_pages: type: integer 
example: 8 next_page_url: type: string format: uri-relative nullable: true 
example: "/towns?page=2&page_size=20" prev_page_url: type: string format: 
uri-relative nullable: true example: null required: - current_page - page_size 
- total_items - total_pages MediaItemSummary: type: object description: 
Summarized media item information. properties: id: type: string format: uuid 
description: Unique identifier for the media item. alt_text: type: string 
nullable: true description: Resolved alternative text in the requested 
language. image_variants: type: object properties: thumbnail_s: type: string 
format: uri-relative display_l: type: string format: uri-relative 
additionalProperties: type: string format: uri-relative example: thumbnail_s: 
"media/variants/image_id_thumb_s.webp" display_l: 
"media/variants/image_id_display_l.jpg" required: - id # Module 3 Specific 
Schemas # --- Master Data Schemas (for GET responses) --- 
CharacteristicTagMaster: type: object description: A characteristic tag for 
regions. properties: code: type: string example: "mountainous" name: type: 
string example: "Mountainous" description: type: string nullable: true 
icon_identifier: type: string nullable: true example: "icon-mountain" 
display_order: type: integer example: 10 is_active: type: boolean example: true 
other_available_translations: type: object additionalProperties: type: object 
properties: name: { type: string } description: { type: string, nullable: true 
} example: it: { name: "Montuoso" } required: - code - name - is_active 
ServiceTagMaster: type: object description: A service tag for towns. 
properties: code: type: string example: "pharmacy" name: type: string example: 
"Pharmacy" description: type: string nullable: true icon_identifier: type: 
string nullable: true example: "icon-rx" category: type: string nullable: true 
example: "health" display_order: type: integer example: 1 is_active: type: 
boolean example: true other_available_translations: type: object 
additionalProperties: type: object properties: name: { type: string } 
description: { type: string, nullable: true } example: it: { name: "Farmacia" } 
required: - code - name - is_active TownTypeMaster: type: object description: A 
type or classification for towns. properties: code: type: string example: 
"village_paese" name: type: string example: "Village (Paese)" description: 
type: string nullable: true icon_identifier: type: string nullable: true 
example: "icon-village" display_order: type: integer example: 5 is_active: 
type: boolean example: true other_available_translations: type: object 
additionalProperties: type: object properties: name: { type: string } 
description: { type: string, nullable: true } example: it: { name: "Villaggio 
(Paese)" } required: - code - name - is_active # --- Entity Schemas (for GET 
responses) --- Region: type: object description: Detailed information about a 
geographical region. properties: id: { type: integer, readOnly: true, example: 
1 } slug: { type: string, example: "tuscany" } name: { type: string, example: 
"Tuscany" } # Resolved description: { type: string, nullable: true, example: "A 
region in central Italy..." } # Resolved cultural_highlights: { type: string, 
nullable: true } # Resolved regional_contact_info: { type: string, nullable: 
true } # Resolved best_time_to_visit: { type: string, nullable: true } # 
Resolved iso_3166_2_code: { type: string, nullable: true, example: "IT-52" } 
characteristics: type: array items: { $ref: 
'#/components/schemas/CharacteristicTagMaster' } primary_image: { $ref: 
'#/components/schemas/MediaItemSummary', nullable: true } official_tourism_url: 
{ type: string, format: url, nullable: true, example: 
"https://www.visittuscany.com" } map_default_latitude: { type: number, format: 
double, nullable: true, example: 43.7714 } map_default_longitude: { type: 
number, format: double, nullable: true, example: 11.2546 } map_default_zoom: { 
type: integer, nullable: true, example: 7 } geo_boundary: { type: object, 
nullable: true, description: "GeoJSON object" } is_featured: { type: boolean, 
example: true } content_visibility_status: { type: string, enum: ["draft", 
"pending_review", "published", "archived", "rejected"], example: "published" } 
other_available_translations: type: object additionalProperties: type: object 
properties: name: { type: string } description: { type: string, nullable: true 
} # ... other translatable fields example: { it: { name: "Toscana", 
description: "Una regione dell'Italia centrale..." } } created_at: { type: 
string, format: "date-time", readOnly: true } updated_at: { type: string, 
format: "date-time", readOnly: true } required: [id, slug, name, is_featured, 
content_visibility_status] RegionListItem: type: object properties: id: { type: 
integer, example: 1 } slug: { type: string, example: "tuscany" } name: { type: 
string, example: "Tuscany" } # Resolved description: { type: string, nullable: 
true, example: "A region in central Italy..." } # Resolved (short) is_featured: 
{ type: boolean, example: true } primary_image_thumbnail_url: { type: string, 
format: uri-relative, nullable: true, example: 
"media/variants/region_1_thumb_s.webp" } required: [id, slug, name, 
is_featured] RegionListResponse: type: object properties: data: { type: array, 
items: { $ref: '#/components/schemas/RegionListItem' } } pagination: { $ref: 
'#/components/schemas/Pagination' } required: [data, pagination] Province: 
type: object properties: id: { type: integer, readOnly: true, example: 25 } 
region_id: { type: integer, example: 1 } code: { type: string, nullable: true, 
example: "FI" } name: { type: string, example: "Province of Florence" } # 
Resolved description: { type: string, nullable: true } # Resolved wikidata_id: 
{ type: string, nullable: true, example: "Q3820" } geonames_id: { type: 
integer, nullable: true, example: 3176959 } is_active: { type: boolean, 
example: true } other_available_translations: type: object 
additionalProperties: { type: object, properties: { name: { type: string }, 
description: { type: string, nullable: true } } } example: { it: { name: 
"Provincia di Firenze" } } created_at: { type: string, format: "date-time", 
readOnly: true } updated_at: { type: string, format: "date-time", readOnly: 
true } required: [id, region_id, name, is_active] ProvinceListItem: type: 
object properties: id: { type: integer, example: 25 } code: { type: string, 
nullable: true, example: "FI" } name: { type: string, example: "Province of 
Florence" } # Resolved region_id: { type: integer, example: 1 } is_active: { 
type: boolean, example: true } required: [id, name, region_id, is_active] 
ProvinceListResponse: type: object properties: data: { type: array, items: { 
$ref: '#/components/schemas/ProvinceListItem' } } pagination: { $ref: 
'#/components/schemas/Pagination' } required: [data, pagination] Town: type: 
object properties: id: { type: integer, readOnly: true, example: 123 } slug: { 
type: string, example: "assisi" } name: { type: string, example: "Assisi" } # 
Resolved alternate_names: { type: array, items: { type: string }, nullable: 
true, example: ["Asisium"] } # Resolved short_description: { type: string, 
nullable: true, example: "A historic and spiritual town..." } # Resolved 
full_description: { type: string, nullable: true } # Resolved 
latitude_centroid: { type: number, format: double, example: 43.0700 } 
longitude_centroid: { type: number, format: double, example: 12.6170 } 
geom_centroid: { type: object, nullable: true, description: "GeoJSON Point" } 
geom_boundary: { type: object, nullable: true, description: "GeoJSON 
MultiPolygon" } elevation_meters: { type: integer, nullable: true, example: 405 
} population: { type: integer, nullable: true, example: 28000 } town_type: { 
$ref: '#/components/schemas/TownTypeMaster', nullable: true } # Resolved 
region: # Embedded summary type: object properties: { id: {type: integer}, 
slug: {type: string}, name: {type: string} } required: [id, slug, name] 
nullable: true province: # Embedded summary type: object properties: { id: 
{type: integer}, code: {type: string, nullable: true}, name: {type: string} } 
required: [id, name] nullable: true key_services: { type: array, items: { $ref: 
'#/components/schemas/ServiceTagMaster' }, nullable: true } # Resolved 
town_transport_information_urls: type: array items: type: object properties: 
operator_name: { type: string, nullable: true } # Resolved url: { type: string, 
format: "url" } notes: { type: string, nullable: true } # Resolved required: 
[url] nullable: true has_train_station: { type: boolean, example: true } 
has_bus_services: { type: boolean, example: true } primary_image: { $ref: 
'#/components/schemas/MediaItemSummary', nullable: true } 
website_url_official_town: { type: string, format: url, nullable: true } 
is_major_stage_town: { type: boolean, example: true } 
content_visibility_status: { type: string, enum: ["draft", "pending_review", 
"published", "archived", "rejected"], example: "published" } 
data_last_verified_at: { type: string, format: "date-time", nullable: true } 
other_available_translations: type: object additionalProperties: { type: 
object, properties: { name: { type: string }, short_description: { type: 
string, nullable: true } } } example: { it: { name: "Assisi", 
short_description: "Una città storica e spirituale..." } } created_at: { type: 
string, format: "date-time", readOnly: true } updated_at: { type: string, 
format: "date-time", readOnly: true } required: [id, slug, name, 
latitude_centroid, longitude_centroid, is_major_stage_town, 
content_visibility_status] TownListItem: type: object properties: id: { type: 
integer, example: 123 } slug: { type: string, example: "assisi" } name: { type: 
string, example: "Assisi" } # Resolved short_description: { type: string, 
nullable: true, example: "A historic town..." } # Resolved latitude_centroid: { 
type: number, format: double, example: 43.0700 } longitude_centroid: { type: 
number, format: double, example: 12.6170 } is_major_stage_town: { type: 
boolean, example: true } region_name: { type: string, nullable: true, example: 
"Umbria" } # Resolved primary_image_thumbnail_url: { type: string, format: 
uri-relative, nullable: true, example: "media/variants/town_123_thumb_s.webp" } 
required: [id, slug, name, latitude_centroid, longitude_centroid, 
is_major_stage_town] TownListResponse: type: object properties: data: { type: 
array, items: { $ref: '#/components/schemas/TownListItem' } } pagination: { 
$ref: '#/components/schemas/Pagination' } required: [data, pagination] # --- 
Schemas for WRITE operations (POST/PATCH bodies) --- 
AdditionalTranslationInput: type: object properties: language_code: type: 
string description: Target language code (e.g., 'it', 'de'). example: "it" 
column_identifier: type: string description: The field name being translated 
(e.g., 'name', 'description'). example: "name" translated_text: type: string 
description: The translated text. example: "Testo Tradotto" required: - 
language_code - column_identifier - translated_text RegionCreate: type: object 
description: Data for creating a new region. Main textual fields (name, 
description, etc.) are for the primary reference language (e.g., English, or 
language specified by 'lang' param/header of the request). properties: slug: { 
type: string, description: "URL-friendly identifier. Must be unique.", example: 
"new-umbria-sud" } name: { type: string, description: "Name in primary 
reference language.", example: "New South Umbria" } description: { type: 
string, nullable: true, description: "Description in primary reference 
language." } cultural_highlights: { type: string, nullable: true, description: 
"Cultural highlights in primary reference language." } regional_contact_info: { 
type: string, nullable: true, description: "Contact info in primary reference 
language." } best_time_to_visit: { type: string, nullable: true, description: 
"Best time to visit in primary reference language." } country_code: { type: 
string, default: "IT", example: "IT" } iso_3166_2_code: { type: string, 
nullable: true, example: "IT-XX" } characteristics_tags: { type: array, items: 
{ type: string }, nullable: true, example: ["hilly_terrain"] } # Codes 
primary_media_id: { type: string, format: uuid, nullable: true } 
official_tourism_url: { type: string, format: url, nullable: true } 
map_default_latitude: { type: number, format: double, nullable: true } 
map_default_longitude: { type: number, format: double, nullable: true } 
map_default_zoom: { type: integer, nullable: true } geo_boundary: { type: 
object, nullable: true, description: "GeoJSON object" } is_featured: { type: 
boolean, default: false } content_visibility_status: { type: string, enum: 
["draft", "pending_review", "published"], default: "draft" } 
additional_translations: type: array nullable: true items: { $ref: 
'#/components/schemas/AdditionalTranslationInput' } description: Provides 
translations for specified fields in other languages. required: [slug, name, 
country_code] TownPatch: type: object description: Data for partially updating 
a town. Main textual fields are for the primary reference language. All fields 
are optional. properties: slug: { type: string, nullable: true } name: { type: 
string, nullable: true } description: { type: string, nullable: true } 
short_description: { type: string, nullable: true } # ... other translatable 
fields like 'full_description', 'history_notes' latitude_centroid: { type: 
number, format: double, nullable: true } longitude_centroid: { type: number, 
format: double, nullable: true } elevation_meters: { type: integer, nullable: 
true } population: { type: integer, nullable: true } town_type_code: { type: 
string, nullable: true } key_services_summary_tags: { type: array, items: { 
type: string }, nullable: true } # Codes primary_media_id: { type: string, 
format: uuid, nullable: true } is_major_stage_town: { type: boolean, nullable: 
true } content_visibility_status: { type: string, enum: ["draft", 
"pending_review", "published", "archived", "rejected"], nullable: true } 
additional_translations: type: array nullable: true items: { $ref: 
'#/components/schemas/AdditionalTranslationInput' } description: Provides 
translations for specified fields in other languages. parameters: 
langQueryParam: name: lang in: query description: |- The desired language code 
for translatable fields in responses (e.g., `it`, `en`). For WRITE operations, 
this can indicate the language of the main textual fields if not English. 
Defaults to English. required: false schema: { type: string, example: "it" } 
idOrSlugPath: name: id_or_slug in: path required: true description: The unique 
ID (integer) or URL-friendly slug (string) of the resource. schema: { type: 
string, example: "assisi" } pageQueryParam: name: page in: query description: 
Page number for pagination. required: false schema: { type: integer, minimum: 
1, default: 1 } pageSizeQueryParam: name: page_size in: query description: 
Number of items per page. required: false schema: { type: integer, minimum: 1, 
maximum: 100, default: 20 } sortByQueryParam: name: sort_by in: query 
description: Field to sort results by. required: false schema: { type: string } 
sortOrderQueryParam: name: sort_order in: query description: Sort order. 
required: false schema: { type: string, enum: [asc, desc], default: asc } 
securitySchemes: bearerAuth: type: http scheme: bearer bearerFormat: JWT 
description: "Supabase JWT token. Example: `Bearer 
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`" security: [{ bearerAuth: [] }] # 
Default security paths: # --- Regions --- /regions: get: # Needs 
v_regions_list_localized view tags: [Regions] summary: List regions 
operationId: listRegions parameters: - $ref: 
'#/components/parameters/langQueryParam' - $ref: 
'#/components/parameters/pageQueryParam' - $ref: 
'#/components/parameters/pageSizeQueryParam' - $ref: 
'#/components/parameters/sortByQueryParam' - $ref: 
'#/components/parameters/sortOrderQueryParam' - name: is_featured in: query 
schema: { type: boolean } required: false responses: '200': { description: "A 
list of regions.", content: { application/json: { schema: { $ref: 
'#/components/schemas/RegionListResponse' } } } } '400': { $ref: 
'#/components/responses/BadRequest' } security: [] post: tags: [Regions] 
summary: Create a new region operationId: createRegion parameters: - $ref: 
'#/components/parameters/langQueryParam' # To indicate language of main fields 
if not 'en' requestBody: required: true content: { application/json: { schema: 
{ $ref: '#/components/schemas/RegionCreate' } } } responses: '201': { 
description: "Region created.", content: { application/json: { schema: { $ref: 
'#/components/schemas/Region' } } } } '400': { $ref: 
'#/components/responses/BadRequest' } '401': { $ref: 
'#/components/responses/Unauthorized' } '403': { $ref: 
'#/components/responses/Forbidden' } '422': { $ref: 
'#/components/responses/UnprocessableEntity' } security: [{ bearerAuth: [] }] 
/regions/{id_or_slug}: get: tags: [Regions] summary: Get region details 
operationId: getRegionDetails parameters: - $ref: 
'#/components/parameters/idOrSlugPath' - $ref: 
'#/components/parameters/langQueryParam' - name: include_towns_limit in: query 
description: Max number of towns to embed. schema: { type: integer, minimum: 0, 
default: 0 } required: false responses: '200': { description: "Region 
details.", content: { application/json: { schema: { $ref: 
'#/components/schemas/Region' } } } } '404': { $ref: 
'#/components/responses/NotFound' } security: [] # --- Provinces --- 
/provinces: get: # May need v_provinces_list_localized view for translated name 
sorting tags: [Provinces] summary: List provinces operationId: listProvinces 
parameters: - $ref: '#/components/parameters/langQueryParam' - $ref: 
'#/components/parameters/pageQueryParam' - $ref: 
'#/components/parameters/pageSizeQueryParam' - $ref: 
'#/components/parameters/sortByQueryParam' - $ref: 
'#/components/parameters/sortOrderQueryParam' - name: region_id in: query 
schema: { type: integer } required: false - name: is_active in: query schema: { 
type: boolean, default: true } required: false responses: '200': { description: 
"A list of provinces.", content: { application/json: { schema: { $ref: 
'#/components/schemas/ProvinceListResponse' } } } } '400': { $ref: 
'#/components/responses/BadRequest' } security: [] /provinces/{id}: get: tags: 
[Provinces] summary: Get province details operationId: getProvinceDetails 
parameters: - name: id in: path required: true schema: { type: integer } - 
$ref: '#/components/parameters/langQueryParam' responses: '200': { description: 
"Province details.", content: { application/json: { schema: { $ref: 
'#/components/schemas/Province' } } } } '404': { $ref: 
'#/components/responses/NotFound' } security: [] # --- Towns --- /towns: get: # 
Needs v_towns_list_localized view and FTS index on translations.translated_text 
for search_term tags: [Towns] summary: List towns operationId: listTowns 
parameters: - $ref: '#/components/parameters/langQueryParam' - $ref: 
'#/components/parameters/pageQueryParam' - $ref: 
'#/components/parameters/pageSizeQueryParam' - $ref: 
'#/components/parameters/sortByQueryParam' - $ref: 
'#/components/parameters/sortOrderQueryParam' - name: region_id in: query 
schema: { type: integer } required: false - name: province_id in: query schema: 
{ type: integer } required: false - name: services in: query schema: { type: 
array, items: { type: string } } style: form explode: true required: false - 
name: town_type_code in: query schema: { type: string } required: false - name: 
is_major_stage_town in: query schema: { type: boolean } required: false - name: 
search_term in: query schema: { type: string } required: false responses: 
'200': { description: "A list of towns.", content: { application/json: { 
schema: { $ref: '#/components/schemas/TownListResponse' } } } } '400': { $ref: 
'#/components/responses/BadRequest' } security: [] /towns/{id_or_slug}: get: 
tags: [Towns] summary: Get town details operationId: getTownDetails parameters: 
- $ref: '#/components/parameters/idOrSlugPath' - $ref: 
'#/components/parameters/langQueryParam' responses: '200': { description: "Town 
details.", content: { application/json: { schema: { $ref: 
'#/components/schemas/Town' } } } } '404': { $ref: 
'#/components/responses/NotFound' } security: [] patch: tags: [Towns] summary: 
Partially update a town operationId: patchTown parameters: - $ref: 
'#/components/parameters/idOrSlugPath' - $ref: 
'#/components/parameters/langQueryParam' # To indicate language of main fields 
if not 'en' requestBody: required: true content: { application/json: { schema: 
{ $ref: '#/components/schemas/TownPatch' } } } responses: '200': { description: 
"Town updated.", content: { application/json: { schema: { $ref: 
'#/components/schemas/Town' } } } } '400': { $ref: 
'#/components/responses/BadRequest' } '401': { $ref: 
'#/components/responses/Unauthorized' } '403': { $ref: 
'#/components/responses/Forbidden' } '404': { $ref: 
'#/components/responses/NotFound' } '422': { $ref: 
'#/components/responses/UnprocessableEntity' } security: [{ bearerAuth: [] }] # 
--- Taxonomies --- /characteristic-tags: get: tags: [Geographical Taxonomies] 
summary: List characteristic tags operationId: listCharacteristicTags 
parameters: - $ref: '#/components/parameters/langQueryParam' - name: is_active 
{in: query, schema: {type: boolean, default: true}, required: false} - $ref: 
'#/components/parameters/sortByQueryParam' - $ref: 
'#/components/parameters/sortOrderQueryParam' responses: '200': { description: 
"A list of characteristic tags.", content: { application/json: { schema: { 
type: array, items: { $ref: '#/components/schemas/CharacteristicTagMaster' } } 
} } } security: [] /service-tags: get: tags: [Geographical Taxonomies] summary: 
List service tags operationId: listServiceTags parameters: - $ref: 
'#/components/parameters/langQueryParam' - name: is_active {in: query, schema: 
{type: boolean, default: true}, required: false} - name: category {in: query, 
schema: {type: string}, required: false} - $ref: 
'#/components/parameters/sortByQueryParam' - $ref: 
'#/components/parameters/sortOrderQueryParam' responses: '200': { description: 
"A list of service tags.", content: { application/json: { schema: { type: 
array, items: { $ref: '#/components/schemas/ServiceTagMaster' } } } } } 
security: [] /town-types: get: tags: [Geographical Taxonomies] summary: List 
town types operationId: listTownTypes parameters: - $ref: 
'#/components/parameters/langQueryParam' - name: is_active {in: query, schema: 
{type: boolean, default: true}, required: false} - $ref: 
'#/components/parameters/sortByQueryParam' - $ref: 
'#/components/parameters/sortOrderQueryParam' responses: '200': { description: 
"A list of town types.", content: { application/json: { schema: { type: array, 
items: { $ref: '#/components/schemas/TownTypeMaster' } } } } } security: [] # 
Shared responses responses: BadRequest: { description: "Bad Request.", content: 
{ application/json: { schema: { $ref: '#/components/schemas/ErrorResponse' } } 
} } Unauthorized: { description: "Unauthorized.", content: { application/json: 
{ schema: { $ref: '#/components/schemas/ErrorResponse' } } } } Forbidden: { 
description: "Forbidden.", content: { application/json: { schema: { $ref: 
'#/components/schemas/ErrorResponse' } } } } NotFound: { description: "Not 
Found.", content: { application/json: { schema: { $ref: 
'#/components/schemas/ErrorResponse' } } } } UnprocessableEntity: { 
description: "Unprocessable Entity.", content: { application/json: { schema: { 
$ref: '#/components/schemas/ErrorResponse' } } } } ``` ### Quick-Start Examples 
1\. List the first page of towns in Italian, filtered by 
`is_major_stage_town=true`: Bash ``` # Replace YOUR_API_BASE_URL and 
YOUR_SUPABASE_ANON_KEY curl -X GET 
"YOUR_API_BASE_URL/towns?lang=it&is_major_stage_town=true&page_size=5" -H 
"apikey: YOUR_SUPABASE_ANON_KEY" ``` Sample JSON Response: JSON ``` { "data": [ 
{ "id": 123, "slug": "assisi", "name": "Assisi", "short_description": "Una 
città storica e spirituale in Umbria, città natale di San Francesco.", 
"latitude_centroid": 43.0700, "longitude_centroid": 12.6170, 
"is_major_stage_town": true, "region_name": "Umbria", 
"primary_image_thumbnail_url": "media/variants/town_123_thumb_s.webp" } ], 
"pagination": { "current_page": 1, "page_size": 5, "total_items": 12, 
"total_pages": 3, "next_page_url": 
"/towns?lang=it&is_major_stage_town=true&page_size=5&page=2", "prev_page_url": 
null } } ``` 2\. Get details for the region with slug "umbria" in English: Bash 
``` curl -X GET "YOUR_API_BASE_URL/regions/umbria?lang=en" -H "apikey: 
YOUR_SUPABASE_ANON_KEY" ``` Sample JSON Response: JSON ``` { "id": 5, "slug": 
"umbria", "name": "Umbria", "description": "The green heart of Italy, rich in 
history and nature.", "iso_3166_2_code": "IT-UM", "characteristics": [ { 
"code": "hilly_terrain", "name": "Hilly Terrain", "icon_identifier": 
"icon-hills", "is_active": true, "display_order": 1 } ], "primary_image": { 
"id": "media-uuid-for-umbria-primary", "alt_text": "Rolling hills of Umbria", 
"image_variants": {"thumbnail_s": "media/variants/umbria_thumb.webp"} }, 
"official_tourism_url": "https://www.umbriatourism.it/", "is_featured": true, 
"content_visibility_status": "published", "created_at": "2023-01-10T10:00:00Z", 
"updated_at": "2023-01-10T10:00:00Z" } ``` 3\. Create a new region (requires 
authentication and admin role), specifying English as the primary language for 
main fields and providing an Italian translation: Bash ``` # Replace 
YOUR_JWT_TOKEN with a valid JWT for an admin user # Main fields are in English 
(default or via ?lang=en) curl -X POST "YOUR_API_BASE_URL/regions" -H "apikey: 
YOUR_SUPABASE_ANON_KEY" -H "Authorization: Bearer YOUR_JWT_TOKEN" -H 
"Content-Type: application/json" -d '{ "slug": "lazio-nord-new", "name": 
"Northern Lazio New", "description": "The northern part of the Lazio region, 
newly defined.", "country_code": "IT", "is_featured": false, 
"content_visibility_status": "draft", "additional_translations": [ { 
"language_code": "it", "column_identifier": "name", "translated_text": "Lazio 
Nord Nuovo" }, { "language_code": "it", "column_identifier": "description", 
"translated_text": "La parte settentrionale della regione Lazio, recentemente 
definita." } ] }' ``` Sample JSON Response (201 Created, assuming `lang=en` for 
the response): JSON ``` { "id": 16, "slug": "lazio-nord-new", "name": "Northern 
Lazio New", "description": "The northern part of the Lazio region, newly 
defined.", "iso_3166_2_code": null, "characteristics": null, "primary_image": 
null, "official_tourism_url": null, "is_featured": false, 
"content_visibility_status": "draft", "other_available_translations": { "it": 
{"name": "Lazio Nord Nuovo", "description": "La parte settentrionale della 
regione Lazio, recentemente definita."} }, "created_at": 
"2025-05-18T20:00:00Z", "updated_at": "2025-05-18T20:00:00Z" } ``` ### 
Implementation Notes - SQL Views: - `public.v_towns_list_localized`: Essential 
for `GET /towns`. - `public.v_regions_list_localized`: Essential for `GET 
/regions`. - Consider `public.v_provinces_list_localized` if complex localized 
filtering/sorting is needed for `GET /provinces`. - SQL Indexes: - 
`public.translations` Table: Critically important. Composite index on 
`(table_identifier, column_identifier, row_foreign_key, language_code, 
translation_status)` for lookups. Full-Text Search (FTS) GIN index on a 
`tsvector` column from `translated_text` for `search_term` functionality. - 
Array/JSONB Columns: GIN indexes on `regions.characteristics_tags` and 
`towns.key_services_summary_tags`. Also, 
`towns.town_transport_information_urls` if queried. - Geospatial Columns: GIST 
indexes on `regions.geo_boundary`, `towns.geom_centroid`, 
`towns.geom_boundary`. - Standard indexes on Foreign Keys, `slug`, status flags 
(e.g., `is_featured`, `content_visibility_status` ), and `is_active` on master 
tables are necessary. - Materialized Views: - If performance of 
`v_towns_list_localized` or `v_regions_list_localized` becomes an issue, 
consider converting them to materialized views. - Schema Assessment: - 🟢 
Schema OK: The Module 3 database schemas (V2.1+ specs for `regions`, 
`provinces`, `towns`, `characteristic_tags_master`, `service_tags_master`, 
`town_types_master`) are well-suited. - Other Considerations: - Database 
Functions for Detail Endpoints: For complex `GET` detail endpoints, consider 
PostgreSQL functions returning JSON to encapsulate data aggregation and 
translation logic. - Write Operations & Translations: The backend for 
`POST`/`PATCH` operations must correctly interpret the main fields as the 
primary reference language text (e.g., English, or language from `lang` 
param/header) and process the `additional_translations` array to create 
corresponding entries in `public.translations`. - Transaction Management: Write 
operations that affect both an entity table and the `translations` table should 
be performed within a single transaction to ensure data consistency. 
