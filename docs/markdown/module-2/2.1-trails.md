# 2.1 Trails

  
https://gemini.google.com/u/1/app/9ed6b32c76b55d3a?is_sa=1&android-min-version=3
01356232&ios-min-version=322.0&campaign_id=bkws&utm_source=google&utm_medium=cpc
&utm_campaign=2024enUS_gemfeb&pt=9008&mt=8&ct=p-growth-sem-bkws 
https://gemini.google.com/u/1/app/8d62cfd96b565ac8 
https://gemini.google.com/u/1/app/2d30425fc8a5984a * * * * * ### Updated 
Production-Ready Specification Table Name: `public.trails` 1\. Purpose & 
Primary Use-Cases This table defines the main, overarching pilgrimage trails, 
such as "Via di Francesco". It provides a comprehensive, translatable overview 
of each trail's identity, characteristics, operational status, and key 
information. This data is essential for high-level pilgrim planning, discovery 
features on the platform, and overall platform administration. Key User-Story 
Touchpoints: - Pilgrim (Anna) - Story A1 (Route Exploration & Selection): 
Enables Anna to browse available trails, understanding their general nature, 
indicative distances, typical durations, overall difficulty, and geographic 
scope. - Pilgrim (Anna) - Story A5 (Checking Trail Conditions): Provides the 
top-level `operational_status` and `content_visibility_status` for an entire 
trail. - Pilgrim (Anna) - Story A6 (Accessing Information in My Language): Core 
descriptive fields like name and descriptions are designed to be translatable 
via the central `public.translations` table. - Regional Content Manager (Sofia) 
- Story C2 (Updating Information): Allows authorized managers to update trail 
descriptions, statuses, and other details for trails within their geographical 
purview. - Platform Administrator (Admin Team) - Story D1 (Managing All 
Content) & D2 (Curating Featured Content): Enables administrators to create, 
update, manage all aspects of trail entities, and highlight specific trails 
using the `is_featured` flag. 2\. Schema | Column Name | Data Type | 
Constraints | Description (Translatable fields marked) | | `id` | `bigint` | 
PRIMARY KEY, GENERATED ALWAYS AS IDENTITY | Unique identifier for each trail. | 
| `name` | `text` | NOT NULL, CHECK (char_length(`name`) &lt;= 255) | Primary, 
official name of the trail in English. (Translatable via `public.translations`) 
| | `slug` | `text` | NOT NULL, UNIQUE, CHECK (`slug` ~ 
'^[a-z0-9]+(?:-[a-z0-9]+)*$' AND char_length(`slug`) &lt;= 255) | URL-friendly 
identifier (e.g., "via-di-francesco"). | | `trail_short_code` | `text` | 
UNIQUE, CHECK (`trail_short_code` IS NULL OR (`trail_short_code` ~ 
'^[A-Z0-9_-]+$' AND char_length(`trail_short_code`) &lt;= 50)) | Optional 
short, stable code for internal referencing (e.g., "VDF"). | | 
`alternate_names` | `text[]` | | Array of other known names in English. (Each 
element Translatable via `public.translations`) | | `short_description` | 
`text` | CHECK (`short_description` IS NULL OR char_length(`short_description`) 
&lt;= 250) | Brief summary in English (approx. 160-250 chars). (Translatable 
via `public.translations`) | | `full_description` | `text` | | Detailed 
description in English. (Translatable via `public.translations`) | | 
`historical_significance` | `text` | | Historical background in English. 
(Translatable via `public.translations`) | | `cultural_significance` | `text` | 
| Cultural impact and relevance in English. (Translatable via 
`public.translations`) | | `pilgrimage_focus` | `text` | | Main 
spiritual/thematic focus in English. (Translatable via `public.translations`) | 
| `primary_start_point_name` | `text` | | Textual description of main start 
point(s) in English. (Translatable via `public.translations`) | | 
`primary_end_point_name` | `text` | | Textual description of main end point(s) 
in English. (Translatable via `public.translations`) | | 
`typical_direction_of_travel` | `text` | | Common travel direction(s) in 
English. (Translatable via `public.translations`) | | 
`estimated_total_distance_km` | `real` | | Indicative overall distance (km) for 
the trail. | | `estimated_total_duration_days` | `text` | | Estimated typical 
completion duration (e.g., "20-30 days"). | | `overall_difficulty` | 
`public.trail_difficulty_enum` | | Overall subjective difficulty rating. | | 
`waymarking_description` | `text` | | Description of waymarking system in 
English. (Translatable via `public.translations`) | | 
`overall_safety_considerations` | `text` | | General safety advice in English. 
(Translatable via `public.translations`) | | `best_seasons_to_walk` | `text[]` 
| | Recommended seasons/months (e.g., `{"Spring (April-June)"}`). (Each element 
Translatable via `public.translations`) | | `operational_status` | 
`public.trail_operational_status_enum` | NOT NULL DEFAULT 
'information_unavailable' | General operational status of the trail. | | 
`content_visibility_status` | `public.content_visibility_status_enum` | NOT 
NULL DEFAULT 'draft' | Editorial status for public view. | | 
`official_website_url` | `text` | CHECK (`official_website_url` IS NULL OR 
`official_website_url` ~* '^https?://.+') | Link to the official trail website. 
| | `logo_media_id` | `bigint` | REFERENCES `public.media(id)` ON DELETE SET 
NULL | FK to `media` table for the trail's logo. | | `banner_media_id` | 
`bigint` | REFERENCES `public.media(id)` ON DELETE SET NULL | FK to `media` 
table for a representative banner image. | | `key_attractions_summary` | `text` 
| | Summary of key attractions in English. (Translatable via 
`public.translations`) | | `pilgrim_credential_info` | `text` | | Info on 
pilgrim credentials in English. (Translatable via `public.translations`) | | 
`contact_organization_name` | `text` | | Primary contact organization name in 
English. (Translatable via `public.translations`) | | 
`contact_organization_url` | `text` | CHECK (`contact_organization_url` IS NULL 
OR `contact_organization_url` ~* '^https?://.+') | Website of the primary 
contact organization. | | `primary_data_source_credit` | `text` | | 
Acknowledgement of primary data source(s) in English. (Translatable via 
`public.translations`) | | `data_licence_info` | `text` | | Trail data 
licensing information in English. (Translatable via `public.translations`) | | 
`general_notes_for_pilgrims` | `text` | | General advice for pilgrims in 
English. (Translatable via `public.translations`) | | `meta_description_seo` | 
`text` | CHECK (`meta_description_seo` IS NULL OR 
char_length(`meta_description_seo`) &lt;= 160) | Optimized SEO meta description 
in English. (Translatable via `public.translations`) | | `wordpress_excerpt` | 
`text` | | Short summary for WordPress excerpts in English. (Translatable via 
`public.translations`) | | `is_featured` | `boolean` | NOT NULL DEFAULT `false` 
| Flag to indicate if the trail should be prominently featured. | | 
`created_at` | `timestamptz` | NOT NULL DEFAULT `now()` | Timestamp of record 
creation. | | `created_by_profile_id` | `uuid` | REFERENCES 
`public.profiles(id)` ON DELETE SET NULL | Profile ID of the user who created 
this record. | | `updated_at` | `timestamptz` | NOT NULL DEFAULT `now()` | 
Timestamp of last update (auto-updated by trigger). | | `updated_by_profile_id` 
| `uuid` | REFERENCES `public.profiles(id)` ON DELETE SET NULL | Profile ID of 
the user who last updated this record. | | `deleted_at` | `timestamptz` | | 
Timestamp for soft deletion. If NOT NULL, trail is considered inactive. | 3\. 
PostgreSQL DDL SQL ``` -- Ensure ENUM types are created if not already present 
(typically in a global types script) DO $$ BEGIN IF NOT EXISTS (SELECT 1 FROM 
pg_type WHERE typname = 'trail_difficulty_enum') THEN CREATE TYPE 
public.trail_difficulty_enum AS ENUM ('easy', 'moderate', 'challenging', 
'strenuous', 'variable'); -- [cite: 1464] END IF; IF NOT EXISTS (SELECT 1 FROM 
pg_type WHERE typname = 'trail_operational_status_enum') THEN CREATE TYPE 
public.trail_operational_status_enum AS ENUM ('fully_operational', 
'partially_closed_detours_in_place', 'seasonal_access_only', 
'under_development', 'closed', 'information_unavailable'); -- [cite: 1466] END 
IF; IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 
'content_visibility_status_enum') THEN CREATE TYPE 
public.content_visibility_status_enum AS ENUM ('draft', 'pending_review', 
'published', 'archived'); -- [cite: 1467] END IF; END$$; -- Assuming 
'public.media' (BIGINT PK) and 'public.profiles' (UUID PK) tables exist. [cite: 
1469] CREATE TABLE public.trails ( id BIGINT GENERATED ALWAYS AS IDENTITY 
PRIMARY KEY, -- [cite: 1409] name TEXT NOT NULL CHECK (char_length(name) <= 
255), -- [cite: 1410] slug TEXT NOT NULL UNIQUE CHECK (slug ~ 
'^[a-z0-9]+(?:-[a-z0-9]+)*$' AND char_length(slug) <= 255), -- [cite: 1412] 
trail_short_code TEXT UNIQUE CHECK (trail_short_code IS NULL OR 
(trail_short_code ~ '^[A-Z0-9_-]+$' AND char_length(trail_short_code) <= 50)), 
-- [cite: 1414] alternate_names TEXT[], -- [cite: 1415] short_description TEXT 
CHECK (short_description IS NULL OR char_length(short_description) <= 250), -- 
[cite: 1417] full_description TEXT, -- [cite: 1419] historical_significance 
TEXT, -- [cite: 1420] cultural_significance TEXT, -- [cite: 1421] 
pilgrimage_focus TEXT, -- [cite: 1422] primary_start_point_name TEXT, -- [cite: 
1424] primary_end_point_name TEXT, -- [cite: 1426] typical_direction_of_travel 
TEXT, -- [cite: 1427] estimated_total_distance_km REAL, -- [cite: 1429] 
estimated_total_duration_days TEXT, -- [cite: 1430] overall_difficulty 
public.trail_difficulty_enum, -- [cite: 1431] waymarking_description TEXT, -- 
[cite: 1432] overall_safety_considerations TEXT, -- [cite: 1433] 
best_seasons_to_walk TEXT[], -- [cite: 1435] operational_status 
public.trail_operational_status_enum NOT NULL DEFAULT 
'information_unavailable', -- [cite: 1436] content_visibility_status 
public.content_visibility_status_enum NOT NULL DEFAULT 'draft', -- [cite: 1438] 
official_website_url TEXT CHECK (official_website_url IS NULL OR 
official_website_url ~* '^https?://.+'), -- [cite: 1439] logo_media_id BIGINT 
REFERENCES public.media(id) ON DELETE SET NULL, -- [cite: 1441] banner_media_id 
BIGINT REFERENCES public.media(id) ON DELETE SET NULL, -- [cite: 1442] 
key_attractions_summary TEXT, -- [cite: 1444] pilgrim_credential_info TEXT, -- 
[cite: 1445] contact_organization_name TEXT, -- [cite: 1447] 
contact_organization_url TEXT CHECK (contact_organization_url IS NULL OR 
contact_organization_url ~* '^https?://.+'), -- [cite: 1448] 
primary_data_source_credit TEXT, -- [cite: 1449] data_licence_info TEXT, -- 
[cite: 1450] general_notes_for_pilgrims TEXT, -- [cite: 1452] 
meta_description_seo TEXT CHECK (meta_description_seo IS NULL OR 
char_length(meta_description_seo) <= 160), -- [cite: 1453] wordpress_excerpt 
TEXT, -- [cite: 1455] is_featured BOOLEAN NOT NULL DEFAULT FALSE, -- [cite: 
1456] created_at TIMESTAMPTZ NOT NULL DEFAULT now(), -- [cite: 1458] 
created_by_profile_id UUID REFERENCES public.profiles(id) ON DELETE SET NULL, 
-- [cite: 1459] updated_at TIMESTAMPTZ NOT NULL DEFAULT now(), -- [cite: 1460] 
updated_by_profile_id UUID REFERENCES public.profiles(id) ON DELETE SET NULL, 
-- [cite: 1461] deleted_at TIMESTAMPTZ -- [cite: 1463] ); -- Indexes CREATE 
INDEX IF NOT EXISTS idx_trails_slug ON public.trails(slug); -- [cite: 1472] 
CREATE INDEX IF NOT EXISTS idx_trails_trail_short_code ON 
public.trails(trail_short_code); -- [cite: 1473] CREATE INDEX IF NOT EXISTS 
idx_trails_operational_status ON public.trails(operational_status); -- [cite: 
1473] CREATE INDEX IF NOT EXISTS idx_trails_content_visibility_status ON 
public.trails(content_visibility_status); -- [cite: 1474] CREATE INDEX IF NOT 
EXISTS idx_trails_is_featured ON public.trails(is_featured); -- [cite: 1474] 
CREATE INDEX IF NOT EXISTS idx_trails_deleted_at ON public.trails(deleted_at) 
WHERE deleted_at IS NULL; -- For querying active trails [cite: 1475] -- Trigger 
for audit columns (created_by_profile_id, updated_at, updated_by_profile_id) -- 
It's recommended to use a generic audit trigger function if available (e.g., 
public.handle_generic_audit_meta()). -- The specific trigger from the original 
document is functional: CREATE OR REPLACE FUNCTION 
public.set_trail_modification_meta() RETURNS TRIGGER AS $$ BEGIN NEW.updated_at 
= NOW(); -- [cite: 1475] IF (TG_OP = 'INSERT') THEN NEW.created_by_profile_id = 
auth.uid(); -- [cite: 1476] NEW.updated_by_profile_id = auth.uid(); -- Also set 
updated_by on insert [cite: 1476] ELSIF (TG_OP = 'UPDATE') THEN 
NEW.updated_by_profile_id = auth.uid(); -- [cite: 1477] -- Preserve original 
creation audit fields if they are not meant to be changed on update 
NEW.created_at = OLD.created_at; -- [cite: 1478] NEW.created_by_profile_id = 
OLD.created_by_profile_id; -- [cite: 1479] END IF; RETURN NEW; END; $$ LANGUAGE 
plpgsql SECURITY DEFINER; -- [cite: 1480] CREATE TRIGGER 
trigger_trails_modification_meta BEFORE INSERT OR UPDATE ON public.trails FOR 
EACH ROW EXECUTE FUNCTION public.set_trail_modification_meta(); -- [cite: 1481] 
-- Comments COMMENT ON TABLE public.trails IS 'Defines overarching pilgrimage 
trails, providing comprehensive, translatable overviews of identity, 
characteristics, status, and key information. Version: V2.'; -- [cite: 1482] 
COMMENT ON COLUMN public.trails.name IS 'The primary, official, or most common 
name of the trail in English (e.g., "Via di Francesco"). Max 255 chars. 
(Translatable via public.translations)'; -- [cite: 1483] COMMENT ON COLUMN 
public.trails.slug IS 'URL-friendly identifier for the trail (e.g., 
"via-di-francesco"). Max 255 chars, pattern: ^[a-z0-9]+(?:-[a-z0-9]+)*$. Must 
be unique.'; -- [cite: 1484] COMMENT ON COLUMN public.trails.trail_short_code 
IS 'A short, stable, unique code for the trail (e.g., "VDF"), useful for 
internal referencing or concise display. Max 50 chars, pattern: 
^[A-Z0-9_-]+$.'; -- [cite: 1485] COMMENT ON COLUMN 
public.trails.alternate_names IS 'Array of other known names for the trail in 
English. Each element is translatable via public.translations.'; COMMENT ON 
COLUMN public.trails.short_description IS 'A brief, concise summary of the 
trail in English (approx. 160-250 characters). (Translatable via 
public.translations)'; COMMENT ON COLUMN 
public.trails.estimated_total_distance_km IS 'Indicative overall distance for 
the entire trail or its most common primary configuration (in kilometers). 
Precise distances are at route/segment levels.'; -- [cite: 1487] COMMENT ON 
COLUMN public.trails.deleted_at IS 'Timestamp for soft deletion. Records with 
deleted_at IS NOT NULL are considered deleted/inactive and should typically be 
excluded from public queries.'; -- [cite: 1488] COMMENT ON COLUMN 
public.trails.logo_media_id IS 'Foreign key to the public.media table for the 
trail''s official logo image.'; -- [cite: 1489] COMMENT ON COLUMN 
public.trails.banner_media_id IS 'Foreign key to the public.media table for a 
representative banner image for the trail.'; -- [cite: 1490] COMMENT ON COLUMN 
public.trails.created_at IS 'Timestamp of when the trail record was created.'; 
COMMENT ON COLUMN public.trails.created_by_profile_id IS 'Profile ID 
(public.profiles.id) of the user who created this trail record.'; COMMENT ON 
COLUMN public.trails.updated_at IS 'Timestamp of when the trail record was last 
updated. Auto-updated by a trigger.'; COMMENT ON COLUMN 
public.trails.updated_by_profile_id IS 'Profile ID (public.profiles.id) of the 
user who last updated this trail record.'; -- (Add comments for other 
translatable fields as per original spec and current schema) ``` 4\. JSON 
Schema Mirror JSON ``` { "title": "trail", "description": "Defines an 
overarching pilgrimage trail, providing a comprehensive overview of its 
identity, characteristics, status, and key information. Version: V2.", "type": 
"object", "properties": { "id": { "type": "integer", "format": "int64", 
"description": "Unique identifier for the trail.", "readOnly": true }, "name": 
{ "type": "string", "maxLength": 255, "description": "The primary, official, or 
most common name of the trail in English. (Translatable via 
public.translations)" }, "slug": { "type": "string", "maxLength": 255, 
"pattern": "^[a-z0-9]+(?:-[a-z0-9]+)*$", "description": "URL-friendly 
identifier for the trail. Must be unique." }, "trail_short_code": { "type": 
["string", "null"], "maxLength": 50, "pattern": "^[A-Z0-9_-]+$", "description": 
"A short, stable code for the trail (e.g., VDF). Must be unique if provided." 
}, "alternate_names": { "type": ["array", "null"], "items": { "type": "string" 
}, "description": "Array of other known names for the trail in English. (Each 
element Translatable via public.translations)" }, "short_description": { 
"type": ["string", "null"], "maxLength": 250, "description": "Brief summary of 
the trail in English (approx. 160-250 characters). (Translatable via 
public.translations)" }, "full_description": { "type": ["string", "null"], 
"description": "Detailed description of the trail in English. (Translatable via 
public.translations)" }, "historical_significance": { "type": ["string", 
"null"], "description": "Information about the trail's historical background in 
English. (Translatable via public.translations)" }, "cultural_significance": { 
"type": ["string", "null"], "description": "Details on the cultural impact and 
relevance of the trail in English. (Translatable via public.translations)" }, 
"pilgrimage_focus": { "type": ["string", "null"], "description": "The main 
spiritual, religious, or thematic focus of the pilgrimage in English. 
(Translatable via public.translations)" }, "primary_start_point_name": { 
"type": ["string", "null"], "description": "Textual description of the trail's 
main starting point(s) in English. (Translatable via public.translations)" }, 
"primary_end_point_name": { "type": ["string", "null"], "description": "Textual 
description of the trail's main ending point(s) in English. (Translatable via 
public.translations)" }, "typical_direction_of_travel": { "type": ["string", 
"null"], "description": "Describes common direction(s) of walking in English. 
(Translatable via public.translations)" }, "estimated_total_distance_km": { 
"type": ["number", "null"], "format": "float", "description": "Indicative 
overall distance for the trail (km)." }, "estimated_total_duration_days": { 
"type": ["string", "null"], "description": "Estimated range for typical 
completion duration (e.g., '20-30 days')." }, "overall_difficulty": { "type": 
["string", "null"], "enum": ["easy", "moderate", "challenging", "strenuous", 
"variable", null], "description": "Overall subjective difficulty rating for the 
trail." }, "waymarking_description": { "type": ["string", "null"], 
"description": "Description of the trail's waymarking system in English. 
(Translatable via public.translations)" }, "overall_safety_considerations": { 
"type": ["string", "null"], "description": "General safety advice for the trail 
in English. (Translatable via public.translations)" }, "best_seasons_to_walk": 
{ "type": ["array", "null"], "items": { "type": "string" }, "description": 
"Array listing recommended seasons/months. (Each element Translatable via 
public.translations)" }, "operational_status": { "type": "string", "enum": 
["fully_operational", "partially_closed_detours_in_place", 
"seasonal_access_only", "under_development", "closed", 
"information_unavailable"], "default": "information_unavailable", 
"description": "General operational status of the entire trail." }, 
"content_visibility_status": { "type": "string", "enum": ["draft", 
"pending_review", "published", "archived"], "default": "draft", "description": 
"Editorial status indicating if the content is ready for public view." }, 
"official_website_url": { "type": ["string", "null"], "format": "url", 
"pattern": "^https?://.+", "description": "Link to the official website for 
this trail." }, "logo_media_id": { "type": ["integer", "null"], "format": 
"int64", "description": "Foreign key to the public.media table for the trail's 
logo." }, "banner_media_id": { "type": ["integer", "null"], "format": "int64", 
"description": "Foreign key to the public.media table for the trail's banner 
image." }, "key_attractions_summary": { "type": ["string", "null"], 
"description": "Brief narrative summary of key attractions in English. 
(Translatable via public.translations)" }, "pilgrim_credential_info": { "type": 
["string", "null"], "description": "Information on pilgrim credentials in 
English. (Translatable via public.translations)" }, 
"contact_organization_name": { "type": ["string", "null"], "description": "Name 
of the primary contact organization in English. (Translatable via 
public.translations)" }, "contact_organization_url": { "type": ["string", 
"null"], "format": "url", "pattern": "^https?://.+", "description": "Website of 
the primary contact organization." }, "primary_data_source_credit": { "type": 
["string", "null"], "description": "Acknowledgement of primary data source(s) 
in English. (Translatable via public.translations)" }, "data_licence_info": { 
"type": ["string", "null"], "description": "Licensing of the trail data in 
English. (Translatable via public.translations)" }, 
"general_notes_for_pilgrims": { "type": ["string", "null"], "description": 
"General advice for pilgrims in English. (Translatable via 
public.translations)" }, "meta_description_seo": { "type": ["string", "null"], 
"maxLength": 160, "description": "Optimized meta description for SEO in English 
(approx. 150-160 characters). (Translatable via public.translations)" }, 
"wordpress_excerpt": { "type": ["string", "null"], "description": "Short 
summary for WordPress excerpt in English. (Translatable via 
public.translations)" }, "is_featured": { "type": "boolean", "default": false, 
"description": "Flag to indicate if this trail should be prominently featured." 
}, "created_at": { "type": "string", "format": "date-time", "description": 
"Timestamp of record creation.", "readOnly": true }, "created_by_profile_id": { 
"type": ["string", "null"], "format": "uuid", "description": "Profile ID 
(public.profiles.id) of the user who created this trail record.", "readOnly": 
true }, "updated_at": { "type": "string", "format": "date-time", "description": 
"Timestamp of last update.", "readOnly": true }, "updated_by_profile_id": { 
"type": ["string", "null"], "format": "uuid", "description": "Profile ID 
(public.profiles.id) of the user who last updated this trail record.", 
"readOnly": true }, "deleted_at": { "type": ["string", "null"], "format": 
"date-time", "description": "Timestamp for soft deletion. If present, the trail 
is considered inactive.", "readOnly": true } }, "required": [ "name", "slug", 
"operational_status", "content_visibility_status", "is_featured", "created_at", 
"updated_at" ], "primary_key": ["id"], "unique_constraints": [ {"columns": 
["slug"], "name": "trails_slug_key"}, {"columns": ["trail_short_code"], "name": 
"trails_trail_short_code_key"} ] } ``` 5\. Relationships & Integrity - Foreign 
Key Targets & `ON DELETE` Actions: - `logo_media_id` references 
`public.media(id)`: `ON DELETE SET NULL`. - `banner_media_id` references 
`public.media(id)`: `ON DELETE SET NULL`. - `created_by_profile_id` references 
`public.profiles(id)`: `ON DELETE SET NULL`. - `updated_by_profile_id` 
references `public.profiles(id)`: `ON DELETE SET NULL`. - Child Tables (Strong 
Relationships): - `public.routes`: Linked via `routes.trail_id`. `ON DELETE 
CASCADE` on `routes.trail_id` means deleting a trail deletes its routes. - 
`public.trail_regions`: Linked via `trail_regions.trail_id`. `ON DELETE 
CASCADE` on `trail_regions.trail_id` deletes region links. - Junction Tables 
for Characteristics: - `public.trail_terrain_types`: Links `trails` to 
`terrain_types_master`. `ON DELETE CASCADE` on its `trail_id` FK ensures links 
are removed if the trail is deleted. - `public.trail_usage_types`: Links 
`trails` to `usage_types_master`. `ON DELETE CASCADE` on its `trail_id` FK 
ensures links are removed if the trail is deleted. - Mermaid ER Diagram 
Snippet: Code snippet ``` erDiagram trails { bigint id PK text name text slug 
UK text trail_short_code UK bigint logo_media_id FK bigint banner_media_id FK 
uuid created_by_profile_id FK uuid updated_by_profile_id FK timestamptz 
deleted_at trail_operational_status_enum operational_status 
content_visibility_status_enum content_visibility_status boolean is_featured } 
media { bigint id PK text storage_object_path_original -- Example column from 
media spec } profiles { uuid id PK text email -- Example column from profiles 
spec } routes { bigint id PK bigint trail_id FK } trail_regions { bigint id PK 
bigint trail_id FK } trail_terrain_types { bigint trail_id PK FK integer 
terrain_type_id PK FK } trail_usage_types { bigint trail_id PK FK integer 
usage_type_id PK FK } terrain_types_master { integer id PK } usage_types_master 
{ integer id PK } trails ||--o| media : "has_logo (SET NULL)" trails ||--o| 
media : "has_banner (SET NULL)" trails ||--o| profiles : "created_by (SET 
NULL)" trails ||--o| profiles : "updated_by (SET NULL)" trails ||--|{ routes : 
"defines (CASCADE)" trails ||--|{ trail_regions : "traverses (CASCADE)" trails 
||--|{ trail_terrain_types : "characterized_by (CASCADE from trail)" 
trail_terrain_types ||--|| terrain_types_master : "uses_type (RESTRICT from 
master)" trails ||--|{ trail_usage_types : "permits_use (CASCADE from trail)" 
trail_usage_types ||--|| usage_types_master : "uses_type (RESTRICT from 
master)" ``` 6\. Multilingual Strategy - User-facing textual content intended 
for multiple languages stores its primary English version directly in the 
`trails` table. The `public.translations` table holds translations, linked by 
`table_name='trails'`, `column_name`, and `row_id=trails.id`. - Translatable 
Fields: `name`, `alternate_names` (each element), `short_description`, 
`full_description`, `historical_significance`, `cultural_significance`, 
`pilgrimage_focus`, `primary_start_point_name`, `primary_end_point_name`, 
`typical_direction_of_travel`, `waymarking_description`, 
`overall_safety_considerations`, `best_seasons_to_walk` (each element), 
`key_attractions_summary`, `pilgrim_credential_info`, 
`contact_organization_name`, `primary_data_source_credit`, `data_licence_info`, 
`general_notes_for_pilgrims`, `meta_description_seo`, `wordpress_excerpt`. 7\. 
Role-Based Workflow & RLS Notes - Workflow Fields: - 
`content_visibility_status` (`public.content_visibility_status_enum`): Manages 
the editorial lifecycle ('draft', 'pending_review', 'published', 'archived'). - 
Audit and soft-delete fields (`created_at`, `created_by_profile_id`, 
`updated_at`, `updated_by_profile_id`, `deleted_at`) track changes and 
lifecycle. - Note: The RLS policies outlined above rely on the existence and 
correct implementation of global RLS helper functions (e.g., 
public.has_role(TEXT) , public.is_platform_admin() , specific regional/trail 
management checks) that authenticate users and verify their roles stored in the 
public.profiles table." This reinforces that the table-specific RLS is part of 
a larger auth system. - Row-Level Security (RLS) Policies (Conceptual Stubs): - 
Public Read Access: SQL ``` CREATE POLICY "Allow public read access to 
published trails" ON public.trails FOR SELECT USING (content_visibility_status 
= 'published' AND deleted_at IS NULL); -- [cite: 1556] ``` - Admin Full Access: 
SQL ``` CREATE POLICY "Allow admin full access on trails" ON public.trails FOR 
ALL USING (public.is_platform_admin()) -- Assumes is_platform_admin() helper 
function WITH CHECK (public.is_platform_admin()); -- [cite: 1557] ``` - 
Regional Content Manager Access (Update - requires helper functions): SQL ``` 
CREATE POLICY "Allow regional managers to update their trails" ON public.trails 
FOR UPDATE USING ( EXISTS ( -- [cite: 1558] SELECT 1 FROM public.trail_regions 
tr JOIN public.profile_region_permissions prp ON tr.region_id = prp.region_id 
-- Assumed table [cite: 1558] WHERE tr.trail_id = trails.id AND prp.profile_id 
= auth.uid() -- AND prp.can_edit_trail_content = TRUE -- Assumed permission 
flag [cite: 1559] ) ) WITH CHECK ( EXISTS ( -- [cite: 1559] SELECT 1 FROM 
public.trail_regions tr JOIN public.profile_region_permissions prp ON 
tr.region_id = prp.region_id -- WHERE tr.trail_id = trails.id AND 
prp.profile_id = auth.uid() -- AND prp.can_edit_trail_content = TRUE -- [cite: 
1560] ) ); ``` - Regional Content Manager Access (Insert - requires helper 
functions): SQL ``` CREATE POLICY "Allow regional managers to insert trails if 
permitted" ON public.trails FOR INSERT WITH CHECK 
(public.can_user_create_trails(auth.uid())); -- Assumes helper function [cite: 
1562] ``` - Audit Trigger: The `set_trail_modification_meta()` trigger handles 
audit fields using `auth.uid()` and is `SECURITY DEFINER`. 8\. ENUM vs. Lookup 
Discussion - `trail_difficulty_enum`, `trail_operational_status_enum`, 
`content_visibility_status_enum`: Retained as ENUMs; values are subjective or 
represent fixed states unlikely to need rich metadata. - 
`predominant_terrain_types` (Original `TEXT[]`): Correctly promoted to 
`public.terrain_types_master` (lookup) and `public.trail_terrain_types` 
(junction). - `permitted_uses` (Original `TEXT[]`): Correctly promoted to 
`public.usage_types_master` (lookup) and `public.trail_usage_types` (junction). 
- `alternate_names` (`TEXT[]`): Retained as `TEXT[]`; each element 
translatable. - `best_seasons_to_walk` (`TEXT[]`): Retained as `TEXT[]`; each 
element translatable. 9\. UI/UX Enablement - Filters: `overall_difficulty`, 
`operational_status`, `is_featured`. Users can also filter by linked terrain 
and usage types via their respective junction tables. - Icons: Driven by 
`overall_difficulty`, `operational_status`. Icons for terrain/usage from their 
master tables. - Displays: `name`, `short_description`, `slug` for 
titles/links. `logo_media_id`, `banner_media_id` for images. 
`estimated_total_distance_km`, `estimated_total_duration_days` for summaries. - 
Performance: Indexes on key filterable and lookup columns improve query 
performance. 10\. Key Considerations & Definitions - Uniqueness: `slug` and 
`trail_short_code` (if provided) must be unique. - Formatting: `slug` 
(lowercase, hyphenated), `trail_short_code` (uppercase alphanumeric, 
underscore/hyphen). - URL Validation: `CHECK` constraints for URL fields are 
case-insensitive for `http(s)`. - Soft Deletes: `deleted_at IS NOT NULL` 
indicates an inactive trail. - Base Language: Primary text is English; other 
languages via `public.translations`. - Trail-Level Estimates: 
`estimated_total_distance_km` and `estimated_total_duration_days` are 
indicative; precise figures are at the `routes` level. 11\. Scalability & 
Future-Proofing - `id` as `BIGINT` supports many trails. - Soft deletes and 
audit columns provide traceability. - Centralized media management via 
`public.media`. - Lookup tables for attributes (`terrain_types_master`, 
`usage_types_master`) allow extensible characterization. - V2+ Consideration: 
Structured start/end points (`primary_start_point_name`, 
`primary_end_point_name`) could link to `waypoints` or `towns` in the future 
for more structured data. - Future Enhancement: Full-Text Search (FTS) on key 
text fields (e.g., `name`, `short_description`, `full_description`) could be 
considered as a future (Post-V2) enhancement for improved search capabilities, 
as noted in the project overview. 12\. Next-Action Checklist 1. ðŸ”´ Implement 
DDL: Ensure all ENUM types (`trail_difficulty_enum`, 
`trail_operational_status_enum`, `content_visibility_status_enum`) are created. 
Create/Update the `public.trails` table using the provided DDL, verifying all 
columns, constraints (including URL checks with `~*`), and indexes (including 
`idx_trails_deleted_at ON public.trails(deleted_at) WHERE deleted_at IS NULL`). 
Ensure the `set_trail_modification_meta` trigger is correctly implemented and 
attached. 2. ðŸ”´ Implement Orphaned Translation Cleanup Trigger: Add an `AFTER 
DELETE` trigger on `public.trails` that calls a generic function (e.g., 
`public.cleanup_related_translations('trails', OLD.id)`) to remove orphaned 
entries from `public.translations` when a trail record is deleted. 3. ðŸŸ  
Confirm Dependent Table Structure: Verify that `public.media` (PK `BIGINT`), 
`public.profiles` (PK `UUID`), `public.terrain_types_master`, 
`public.usage_types_master` (and their respective PK types and audit/lifecycle 
columns) are implemented as `trails` references them. 4. ðŸŸ  Implement RLS 
Policies & Helper Functions: Define, implement, and thoroughly test the 
Row-Level Security policies for `trails`. This includes creating and testing 
any necessary helper functions like `public.is_platform_admin()`, 
`public.can_user_create_trails(UUID)`, and logic for regional manager 
permissions (e.g., involving a `public.profile_region_permissions` table and 
related checks). 5. ðŸŸ  Data Migration (if applicable): - Map data from old 
`predominant_terrain_types` and `permitted_uses` text arrays to the new 
`public.trail_terrain_types` and `public.trail_usage_types` junction tables 
respectively. - Migrate old image URLs to `logo_media_id` and `banner_media_id` 
by first populating `public.media`. - Populate audit columns for existing 
records where possible. 6. ðŸŸ¢ Review Application Logic: Update backend/frontend 
code to reflect the new schema for `trails`, especially for querying 
terrain/usage characteristics via junction tables and fetching media. 
